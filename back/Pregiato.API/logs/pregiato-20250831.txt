2025-08-31 00:00:48.991 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 00:00:50.167 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 00:00:50.171 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 00:00:52.117 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 00:00:54.238 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 00:00:54.433 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 00:00:54.946 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 00:00:56.000 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 00:00:56.166 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 00:00:56.190 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 00:00:56.191 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 00:00:56.200 -03:00 [INF] Processamento de batch iniciado
2025-08-31 00:01:04.657 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 00:01:04.657 -03:00 [INF] Request starting GET /api/chats
2025-08-31 00:01:04.657 -03:00 [INF] Request starting GET /api/health
2025-08-31 00:01:04.657 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:01:04.663 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:01:04.663 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:01:04.724 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 60.9860ms
2025-08-31 00:01:04.725 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 61.5490ms
2025-08-31 00:01:04.738 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:01:04.792 -03:00 [INF] Request finished GET /api/health - 200 in 134.7570ms
2025-08-31 00:01:04.792 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:01:04.798 -03:00 [INF] Request starting GET /api/health
2025-08-31 00:01:04.800 -03:00 [INF] Request finished GET /api/health - 200 in 1.9100ms
2025-08-31 00:01:04.814 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:01:04.811 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:01:04.841 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 26.7950ms
2025-08-31 00:01:04.841 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 29.4000ms
2025-08-31 00:01:04.847 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:01:04.865 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:01:04.917 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 259.7850ms
2025-08-31 00:01:04.922 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 00:01:04.934 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 11.7140ms
2025-08-31 00:01:06.533 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1876.9030ms
2025-08-31 00:01:06.550 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:01:06.624 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 73.9100ms
2025-08-31 00:01:06.625 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:01:06.640 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 15.0630ms
2025-08-31 00:01:06.644 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:01:06.673 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 28.2420ms
2025-08-31 00:01:06.675 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:01:06.700 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 25.6400ms
2025-08-31 00:01:06.704 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:01:06.706 -03:00 [INF] Request starting GET /api/chats
2025-08-31 00:01:06.715 -03:00 [INF] Request finished GET /api/chats - 200 in 2059.2540ms
2025-08-31 00:01:06.734 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 30.6330ms
2025-08-31 00:01:06.749 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756609170806.mp3
2025-08-31 00:01:06.773 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 00:01:06.773 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 00:01:06.774 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: fd5f3ba3-e461-40b8-a725-1038a718764c
2025-08-31 00:01:06.889 -03:00 [INF] Request finished GET /api/chats - 200 in 182.9500ms
2025-08-31 00:01:07.636 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:01:07.640 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:01:07.732 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 00:01:07.738 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83C\uDF00-\uD83D\uDDFF]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 00:01:07.781 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756609170806.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 00:01:08.104 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 00:01:08.173 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 00:01:08.327 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 00:01:08.334 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:01:08.365 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 9
2025-08-31 00:01:08.370 -03:00 [INF] ✅ Retornando 9 mensagens convertidas
2025-08-31 00:01:08.441 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 00:01:08.457 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 00:01:08.508 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 403.6280ms
2025-08-31 00:01:08.588 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 00:01:08.589 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:01:08.668 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 9
2025-08-31 00:01:08.683 -03:00 [INF] ✅ Retornando 9 mensagens convertidas
2025-08-31 00:01:09.487 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 1031.6740ms
2025-08-31 00:01:09.867 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 00:01:10.086 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 00:01:10.154 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:01:10.521 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:01:10.521 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:01:10.541 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 9
2025-08-31 00:01:10.542 -03:00 [INF] ✅ Retornando 9 mensagens convertidas
2025-08-31 00:01:10.551 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 684.0630ms
2025-08-31 00:01:10.557 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 00:01:10.559 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 00:01:10.567 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:01:10.600 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:01:10.600 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:01:10.608 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 9
2025-08-31 00:01:10.608 -03:00 [INF] ✅ Retornando 9 mensagens convertidas
2025-08-31 00:01:10.611 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 53.5590ms
2025-08-31 00:01:11.666 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 00:01:11.951 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 00:01:11.970 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 00:01:12.010 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:01:12.014 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:01:12.014 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 00:01:12.015 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 00:01:12.015 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 00:01:12.017 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 66.0170ms
2025-08-31 00:01:12.032 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 00:01:12.033 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 00:01:12.048 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:01:12.053 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:01:12.054 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 00:01:12.054 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 00:01:12.059 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 00:01:12.060 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 28.5280ms
2025-08-31 00:02:04.286 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 00:02:04.314 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 00:02:04.480 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:02:04.498 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:02:04.499 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 00:02:04.501 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 00:02:04.501 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 00:02:04.508 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 222.8480ms
2025-08-31 00:02:04.510 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 00:02:04.512 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 00:02:04.521 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:02:04.540 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:02:04.541 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 00:02:04.542 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 00:02:04.543 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 00:02:04.549 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 39.0430ms
2025-08-31 00:02:07.856 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 00:02:07.866 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 00:02:07.883 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:02:07.885 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:02:07.885 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 00:02:07.886 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 00:02:07.886 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 00:02:07.886 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 29.7480ms
2025-08-31 00:02:07.889 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 00:02:07.891 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 00:02:07.894 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:02:07.898 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:02:07.899 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 00:02:07.899 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 00:02:07.899 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 00:02:07.900 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 10.9930ms
2025-08-31 00:02:10.646 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 00:02:11.025 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 00:02:11.934 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:02:11.949 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:02:11.951 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 00:02:11.956 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 00:02:11.957 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 00:02:11.959 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 1312.3770ms
2025-08-31 00:02:11.969 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 00:02:11.981 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 00:02:11.991 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:02:12.002 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:02:12.002 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 00:02:12.002 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 00:02:12.002 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 00:02:12.003 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 33.4720ms
2025-08-31 00:03:17.596 -03:00 [INF] Request finished GET /whatsappHub - 101 in 132744.3690ms
2025-08-31 00:03:17.596 -03:00 [INF] Request finished GET /whatsappHub - 101 in 132726.1570ms
2025-08-31 00:03:17.596 -03:00 [INF] Request finished GET /whatsappHub - 101 in 132798.6020ms
2025-08-31 00:03:17.596 -03:00 [INF] Request finished GET /whatsappHub - 101 in 132853.5410ms
2025-08-31 00:03:19.049 -03:00 [INF] Request starting GET /api/chats
2025-08-31 00:03:19.049 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 00:03:19.049 -03:00 [INF] Request starting GET /api/health
2025-08-31 00:03:19.049 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:03:19.060 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:03:19.060 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:03:19.094 -03:00 [INF] Request starting GET /api/health
2025-08-31 00:03:19.098 -03:00 [INF] Request finished GET /api/health - 200 in 49.7600ms
2025-08-31 00:03:19.100 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 39.2900ms
2025-08-31 00:03:19.101 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 41.0620ms
2025-08-31 00:03:19.102 -03:00 [INF] Request finished GET /api/health - 200 in 7.8040ms
2025-08-31 00:03:19.110 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:03:19.113 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:03:19.114 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.3670ms
2025-08-31 00:03:19.123 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:03:19.126 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 2.5050ms
2025-08-31 00:03:19.169 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:03:19.183 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:03:19.198 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:03:19.207 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 158.2830ms
2025-08-31 00:03:19.209 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 00:03:19.224 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 14.4420ms
2025-08-31 00:03:19.469 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 420.0840ms
2025-08-31 00:03:19.470 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:03:19.509 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 38.6980ms
2025-08-31 00:03:19.512 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:03:19.530 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 18.8500ms
2025-08-31 00:03:19.533 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:03:19.542 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 8.4670ms
2025-08-31 00:03:19.543 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:03:19.557 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 14.2470ms
2025-08-31 00:03:19.565 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:03:19.571 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 5.9630ms
2025-08-31 00:03:19.685 -03:00 [INF] Request finished GET /api/chats - 200 in 635.9910ms
2025-08-31 00:03:21.033 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 00:03:21.042 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 00:03:21.713 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:03:22.088 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:03:22.089 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:03:22.121 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 9
2025-08-31 00:03:22.121 -03:00 [INF] ✅ Retornando 9 mensagens convertidas
2025-08-31 00:03:22.132 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 1099.8850ms
2025-08-31 00:03:22.132 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 00:03:22.138 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 00:03:22.142 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:03:22.156 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:03:22.157 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:03:22.200 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 9
2025-08-31 00:03:22.201 -03:00 [INF] ✅ Retornando 9 mensagens convertidas
2025-08-31 00:03:22.211 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 00:03:22.216 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 00:03:22.220 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 87.9100ms
2025-08-31 00:03:22.223 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:03:22.235 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:03:22.235 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:03:22.262 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 9
2025-08-31 00:03:22.262 -03:00 [INF] ✅ Retornando 9 mensagens convertidas
2025-08-31 00:03:22.272 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 00:03:22.298 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 00:03:22.299 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 87.9680ms
2025-08-31 00:03:22.301 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:03:22.321 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:03:22.321 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:03:22.369 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 9
2025-08-31 00:03:22.369 -03:00 [INF] ✅ Retornando 9 mensagens convertidas
2025-08-31 00:03:22.372 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 100.2440ms
2025-08-31 00:03:23.352 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 00:03:23.441 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 00:03:23.506 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:03:23.575 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:03:23.575 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 00:03:23.577 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 00:03:23.578 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 00:03:23.589 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 236.7080ms
2025-08-31 00:03:23.611 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 00:03:23.612 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 00:03:23.645 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:03:23.656 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:03:23.656 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 00:03:23.657 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 00:03:23.657 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 00:03:23.658 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 47.2820ms
2025-08-31 00:03:45.670 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 00:03:46.784 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756609412850.mp3
2025-08-31 00:03:46.802 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 00:03:46.802 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 00:03:46.802 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: 7d52468a-e864-4218-bd56-6c07fbdd6f7e
2025-08-31 00:03:48.325 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:03:48.334 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:03:48.447 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 00:03:48.456 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83C\uDF00-\uD83D\uDDFF]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 00:03:48.510 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756609412850.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 00:03:50.563 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 00:10:56.818 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 00:10:56.890 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 00:10:57.822 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 00:10:57.822 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:10:57.934 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 10
2025-08-31 00:10:57.936 -03:00 [INF] ✅ Retornando 10 mensagens convertidas
2025-08-31 00:10:57.958 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 00:10:57.963 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 1145.2770ms
2025-08-31 00:10:57.970 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 00:10:58.223 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 00:10:58.223 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:10:58.293 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 10
2025-08-31 00:10:58.294 -03:00 [INF] ✅ Retornando 10 mensagens convertidas
2025-08-31 00:10:58.371 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 412.0800ms
2025-08-31 00:13:25.077 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 00:13:25.417 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756609992203.mp3
2025-08-31 00:13:25.423 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 00:13:25.423 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 00:13:25.424 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: 73660715-5ca3-4257-95ab-f2329c1dc7be
2025-08-31 00:13:26.305 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:13:26.308 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:13:26.333 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 00:13:26.339 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83C\uDF00-\uD83D\uDDFF]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 00:13:26.390 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756609992203.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 00:13:27.607 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 00:13:38.525 -03:00 [INF] Request finished GET /whatsappHub - 101 in 619355.0040ms
2025-08-31 00:13:38.524 -03:00 [INF] Request finished GET /whatsappHub - 101 in 619340.7090ms
2025-08-31 00:13:38.526 -03:00 [INF] Request finished GET /whatsappHub - 101 in 619416.7710ms
2025-08-31 00:13:38.529 -03:00 [INF] Request finished GET /whatsappHub - 101 in 619330.8540ms
2025-08-31 00:13:40.776 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 00:13:40.776 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:13:40.776 -03:00 [INF] Request starting GET /api/health
2025-08-31 00:13:40.776 -03:00 [INF] Request starting GET /api/chats
2025-08-31 00:13:40.815 -03:00 [INF] Request finished GET /api/health - 200 in 39.3940ms
2025-08-31 00:13:40.822 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:13:40.827 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:13:40.828 -03:00 [INF] Request starting GET /api/health
2025-08-31 00:13:40.829 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:13:40.829 -03:00 [INF] Request finished GET /api/health - 200 in 1.6760ms
2025-08-31 00:13:40.838 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:13:40.844 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 16.8220ms
2025-08-31 00:13:40.844 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 15.5320ms
2025-08-31 00:13:40.846 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 23.1880ms
2025-08-31 00:13:40.844 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 6.7280ms
2025-08-31 00:13:40.854 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:13:40.886 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:13:40.900 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:13:40.916 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 140.1930ms
2025-08-31 00:13:40.918 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:13:40.923 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 00:13:40.936 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 12.6640ms
2025-08-31 00:13:41.584 -03:00 [INF] Request finished GET /api/chats - 200 in 808.3740ms
2025-08-31 00:13:41.845 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1069.6640ms
2025-08-31 00:13:41.848 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:13:42.168 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 316.2820ms
2025-08-31 00:13:42.256 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:13:42.328 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 71.4490ms
2025-08-31 00:13:42.332 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:13:42.372 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 40.1860ms
2025-08-31 00:13:42.383 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:13:42.421 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 37.5680ms
2025-08-31 00:13:42.424 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:13:42.455 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 31.0010ms
2025-08-31 00:13:42.672 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 00:13:42.686 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 00:13:42.846 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:13:43.022 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:13:43.024 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:13:43.121 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 11
2025-08-31 00:13:43.121 -03:00 [INF] ✅ Retornando 11 mensagens convertidas
2025-08-31 00:13:43.136 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 00:13:43.138 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 00:13:43.147 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:13:43.164 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 491.8140ms
2025-08-31 00:13:43.224 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:13:43.224 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 00:13:43.315 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 11
2025-08-31 00:13:43.316 -03:00 [INF] ✅ Retornando 11 mensagens convertidas
2025-08-31 00:13:43.334 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 197.4900ms
2025-08-31 00:13:44.220 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 00:13:44.238 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 00:13:44.259 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:13:44.268 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:13:44.268 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 00:13:44.270 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 00:13:44.270 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 00:13:44.272 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 51.5590ms
2025-08-31 00:13:44.278 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 00:13:44.279 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 00:13:44.296 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:13:44.305 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:13:44.306 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 00:13:44.310 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 00:13:44.310 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 00:13:44.310 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 32.0400ms
2025-08-31 00:13:45.170 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 00:13:45.214 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 00:13:45.246 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:13:45.265 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:13:45.266 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 00:13:45.267 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 00:13:45.268 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 00:13:45.270 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 100.3530ms
2025-08-31 00:13:45.285 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 00:13:45.287 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 00:13:45.297 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:13:45.317 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:13:45.320 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 00:13:45.329 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 00:13:45.329 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 00:13:45.329 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 43.6510ms
2025-08-31 00:13:46.249 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 00:13:46.251 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 00:13:46.264 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:13:46.266 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:13:46.266 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 00:13:46.267 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 00:13:46.267 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 00:13:46.267 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 18.0680ms
2025-08-31 00:13:46.269 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 00:13:46.269 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 00:13:46.272 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:13:46.273 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:13:46.273 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 00:13:46.273 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 00:13:46.273 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 00:13:46.274 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 4.6020ms
2025-08-31 00:16:31.228 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 00:16:31.271 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 00:16:31.611 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:16:32.495 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:16:32.504 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 00:16:32.523 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 00:16:32.528 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 00:16:32.548 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 1319.8450ms
2025-08-31 00:16:32.580 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 00:16:32.642 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 00:16:32.775 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 00:16:32.802 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 00:16:32.806 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 00:16:32.825 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 00:16:32.829 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 00:16:32.840 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 260.1550ms
2025-08-31 00:27:00.451 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:27:00.451 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:27:00.451 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:27:00.459 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:27:00.482 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 30.6700ms
2025-08-31 00:27:00.486 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.3460ms
2025-08-31 00:27:00.484 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 32.3190ms
2025-08-31 00:27:00.484 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 29.8550ms
2025-08-31 00:27:00.519 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:27:00.566 -03:00 [INF] Request finished GET /whatsappHub - 101 in 799665.9580ms
2025-08-31 00:27:00.567 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:27:00.578 -03:00 [INF] Request finished GET /whatsappHub - 101 in 799692.4150ms
2025-08-31 00:27:00.579 -03:00 [INF] Request finished GET /whatsappHub - 101 in 799661.1300ms
2025-08-31 00:27:00.578 -03:00 [INF] Request finished GET /whatsappHub - 101 in 799724.0780ms
2025-08-31 00:27:00.584 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:27:00.600 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:27:01.141 -03:00 [INF] Request finished GET /whatsappHub - 101 in 622.6810ms
2025-08-31 00:27:01.141 -03:00 [INF] Request finished GET /whatsappHub - 101 in 557.4490ms
2025-08-31 00:27:01.146 -03:00 [INF] Request finished GET /whatsappHub - 101 in 545.5970ms
2025-08-31 00:27:01.142 -03:00 [INF] Request finished GET /whatsappHub - 101 in 574.2150ms
2025-08-31 00:27:16.920 -03:00 [INF] Request starting GET /api/health
2025-08-31 00:27:16.920 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:27:16.920 -03:00 [INF] Request starting GET /api/chats
2025-08-31 00:27:16.920 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 00:27:16.922 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:27:16.922 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:27:16.938 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 15.9270ms
2025-08-31 00:27:16.938 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 15.2560ms
2025-08-31 00:27:16.943 -03:00 [INF] Request finished GET /api/health - 200 in 23.6340ms
2025-08-31 00:27:16.947 -03:00 [INF] Request starting GET /api/health
2025-08-31 00:27:16.947 -03:00 [INF] Request finished GET /api/health - 200 in 0.3140ms
2025-08-31 00:27:16.953 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:27:16.954 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 00:27:16.955 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 2.1100ms
2025-08-31 00:27:16.955 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.5030ms
2025-08-31 00:27:17.060 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 140.2620ms
2025-08-31 00:27:17.061 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 00:27:17.067 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 5.7730ms
2025-08-31 00:27:17.112 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:27:17.130 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:27:17.143 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:27:17.158 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 00:27:18.722 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1802.5630ms
2025-08-31 00:27:18.736 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:27:18.963 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 226.6530ms
2025-08-31 00:27:18.976 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:27:18.990 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 14.0710ms
2025-08-31 00:27:18.991 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:27:18.999 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 7.3020ms
2025-08-31 00:27:19.005 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:27:19.023 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 18.6910ms
2025-08-31 00:27:19.026 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 00:27:19.044 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 17.6860ms
2025-08-31 00:27:19.418 -03:00 [INF] Request starting GET /api/chats
2025-08-31 00:27:19.541 -03:00 [INF] Request finished GET /api/chats - 200 in 2621.9170ms
2025-08-31 00:27:19.790 -03:00 [INF] Request finished GET /api/chats - 200 in 371.9290ms
2025-08-31 00:33:10.640 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 00:33:11.503 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756611172421.mp3
2025-08-31 00:33:11.525 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 00:33:11.525 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 00:33:11.525 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: 8796a05c-fa3c-456b-a0fc-b30f4b3567ac
2025-08-31 00:33:13.000 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:33:13.068 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:33:13.340 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 00:33:13.384 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83C\uDF00-\uD83D\uDDFF]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 00:33:13.545 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756611172421.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 00:33:14.414 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 00:42:12.868 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 00:42:13.037 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 00:42:13.039 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 00:42:15.272 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 00:42:17.005 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 00:42:17.745 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 00:42:18.131 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 00:42:20.214 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 00:42:20.268 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 00:42:20.403 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 00:42:20.405 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 00:42:20.406 -03:00 [INF] Processamento de batch iniciado
2025-08-31 00:42:24.919 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756611631386.mp3
2025-08-31 00:42:24.923 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 00:42:24.923 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 00:42:24.924 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 00:42:24.924 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: b4b92f92-0a28-4fa2-b432-56f35eb3009a
2025-08-31 00:42:27.044 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:42:27.049 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 00:42:27.142 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 00:42:27.153 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83C\uDF00-\uD83D\uDDFF]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 00:42:27.204 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756611631386.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 00:42:29.030 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 01:16:52.498 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 01:16:52.498 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:16:52.498 -03:00 [INF] Request starting GET /api/health
2025-08-31 01:16:52.497 -03:00 [INF] Request starting GET /api/chats
2025-08-31 01:16:52.530 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:16:52.545 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:16:52.815 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 285.3710ms
2025-08-31 01:16:52.814 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 269.5030ms
2025-08-31 01:16:52.951 -03:00 [INF] Request finished GET /api/health - 200 in 456.7020ms
2025-08-31 01:16:52.962 -03:00 [INF] Request starting GET /api/health
2025-08-31 01:16:52.971 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:16:52.973 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:16:52.974 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.0440ms
2025-08-31 01:16:52.975 -03:00 [INF] Request finished GET /api/health - 200 in 13.9840ms
2025-08-31 01:16:52.983 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:16:52.984 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.7680ms
2025-08-31 01:16:53.020 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:16:53.043 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:16:53.060 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:16:53.087 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 592.8040ms
2025-08-31 01:16:53.091 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 01:16:53.104 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 13.0400ms
2025-08-31 01:16:55.416 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2921.9530ms
2025-08-31 01:16:55.439 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:16:55.451 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 12.2230ms
2025-08-31 01:16:55.453 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:16:55.459 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 6.0010ms
2025-08-31 01:16:55.460 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:16:55.463 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3.2430ms
2025-08-31 01:16:55.465 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:16:55.470 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 5.6360ms
2025-08-31 01:16:55.473 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:16:55.476 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2.9920ms
2025-08-31 01:16:57.956 -03:00 [INF] Request starting GET /api/chats
2025-08-31 01:16:57.988 -03:00 [INF] Request finished GET /api/chats - 200 in 5494.1490ms
2025-08-31 01:16:58.339 -03:00 [INF] Request finished GET /api/chats - 200 in 382.7310ms
2025-08-31 01:18:26.345 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:18:26.345 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:18:26.345 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:18:26.345 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:18:26.370 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.1970ms
2025-08-31 01:18:26.370 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.5540ms
2025-08-31 01:18:26.370 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.2820ms
2025-08-31 01:18:26.370 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.2920ms
2025-08-31 01:18:26.397 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:18:26.418 -03:00 [INF] Request finished GET /whatsappHub - 101 in 93447.0930ms
2025-08-31 01:18:26.419 -03:00 [INF] Request finished GET /whatsappHub - 101 in 93358.8010ms
2025-08-31 01:18:26.419 -03:00 [INF] Request finished GET /whatsappHub - 101 in 93398.5400ms
2025-08-31 01:18:26.419 -03:00 [INF] Request finished GET /whatsappHub - 101 in 93375.5040ms
2025-08-31 01:18:26.426 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:18:26.441 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:18:26.456 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:18:27.156 -03:00 [INF] Request finished GET /whatsappHub - 101 in 758.6560ms
2025-08-31 01:18:27.156 -03:00 [INF] Request finished GET /whatsappHub - 101 in 714.5740ms
2025-08-31 01:18:27.156 -03:00 [INF] Request finished GET /whatsappHub - 101 in 729.5700ms
2025-08-31 01:18:27.156 -03:00 [INF] Request finished GET /whatsappHub - 101 in 700.2420ms
2025-08-31 01:18:30.188 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 01:18:30.188 -03:00 [INF] Request starting GET /api/health
2025-08-31 01:18:30.188 -03:00 [INF] Request starting GET /api/chats
2025-08-31 01:18:30.188 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:18:30.193 -03:00 [INF] Request finished GET /api/health - 200 in 5.0310ms
2025-08-31 01:18:30.198 -03:00 [INF] Request starting GET /api/health
2025-08-31 01:18:30.200 -03:00 [INF] Request finished GET /api/health - 200 in 2.6360ms
2025-08-31 01:18:30.222 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:18:30.222 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:18:30.223 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:18:30.223 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:18:30.224 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.8110ms
2025-08-31 01:18:30.224 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.6510ms
2025-08-31 01:18:30.224 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.4840ms
2025-08-31 01:18:30.224 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.8670ms
2025-08-31 01:18:30.231 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 43.3010ms
2025-08-31 01:18:30.233 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 01:18:30.238 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 5.4450ms
2025-08-31 01:18:30.246 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:18:30.262 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:18:30.276 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:18:30.289 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:18:30.353 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 165.2420ms
2025-08-31 01:18:30.354 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:18:30.362 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 8.1160ms
2025-08-31 01:18:30.364 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:18:30.368 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3.9920ms
2025-08-31 01:18:30.372 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:18:30.409 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 37.0220ms
2025-08-31 01:18:30.411 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:18:30.417 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 6.4490ms
2025-08-31 01:18:30.419 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:18:30.446 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 27.1610ms
2025-08-31 01:18:30.561 -03:00 [INF] Request finished GET /api/chats - 200 in 372.6760ms
2025-08-31 01:26:17.066 -03:00 [INF] Request starting GET /health
2025-08-31 01:26:17.238 -03:00 [INF] Request finished GET /health - 200 in 172.2800ms
2025-08-31 01:27:11.889 -03:00 [WRN] As of ""2025-08-31T04:27:11.8271060+00:00"", the heartbeat has been running for ""00:00:01.0934632"" which is longer than ""00:00:01"". This could be caused by thread pool starvation.
2025-08-31 01:30:12.883 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 01:30:13.014 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 01:30:13.015 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 01:30:14.917 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 01:30:17.081 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 01:30:17.380 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 01:30:17.567 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 01:30:17.756 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 01:30:17.957 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 01:30:18.006 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 01:30:18.016 -03:00 [INF] Processamento de batch iniciado
2025-08-31 01:33:31.811 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 01:33:37.719 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756614799961.mp3
2025-08-31 01:33:37.778 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 01:33:37.778 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 01:33:37.800 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 01:33:37.801 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756614799961.mp3, MimeType=audio/mpeg
2025-08-31 01:33:37.802 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 01:33:37.802 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: 184f7282-a28b-4b64-b151-c7ab8cc949c5
2025-08-31 01:33:39.186 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 01:33:39.195 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 01:33:39.265 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 01:33:39.389 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83C\uDF00-\uD83D\uDDFF]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 01:33:39.762 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756614799961.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 01:33:40.362 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 01:34:48.862 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 01:34:48.961 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 01:34:49.123 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 01:34:49.431 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 01:34:49.432 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 01:34:49.603 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 14
2025-08-31 01:34:49.606 -03:00 [INF] ✅ Retornando 14 mensagens convertidas
2025-08-31 01:34:49.799 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 01:34:49.848 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 01:34:49.852 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 989.7230ms
2025-08-31 01:34:49.976 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 01:34:50.407 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 01:34:50.416 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 01:34:50.517 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 14
2025-08-31 01:34:50.519 -03:00 [INF] ✅ Retornando 14 mensagens convertidas
2025-08-31 01:34:50.591 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 795.9170ms
2025-08-31 01:34:51.299 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 01:34:51.303 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 01:34:51.325 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 01:34:51.333 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 01:34:51.334 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 01:34:51.336 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 01:34:51.339 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 01:34:51.342 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 43.2760ms
2025-08-31 01:34:51.346 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 01:34:51.351 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 01:34:51.359 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 01:34:51.383 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 01:34:51.384 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 01:34:51.385 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 01:34:51.389 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 01:34:51.390 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 44.0530ms
2025-08-31 01:35:17.687 -03:00 [INF] Request starting GET /api/chats
2025-08-31 01:35:18.659 -03:00 [INF] Request finished GET /api/chats - 200 in 972.7700ms
2025-08-31 01:35:19.659 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 01:35:19.998 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756614907494.mp3
2025-08-31 01:35:20.005 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 01:35:20.005 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 01:35:20.006 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 01:35:20.006 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756614907494.mp3, MimeType=audio/mpeg
2025-08-31 01:35:20.006 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 01:35:20.007 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: 8484e647-26f4-4671-af08-bf6726c57e71
2025-08-31 01:35:21.373 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 01:35:21.384 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 01:35:21.405 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 01:35:21.410 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83C\uDF00-\uD83D\uDDFF]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 01:35:21.426 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756614907494.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 01:35:21.566 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 01:35:55.676 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 01:35:58.011 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756614941439.mp3
2025-08-31 01:35:58.021 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 01:35:58.021 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 01:35:58.021 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 01:35:58.022 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756614941439.mp3, MimeType=audio/mpeg
2025-08-31 01:35:58.022 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 01:35:58.024 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: ac645775-8984-4c92-beb6-a7757dc56fa7
2025-08-31 01:35:59.077 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 01:35:59.082 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 01:35:59.103 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 01:35:59.107 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83C\uDF00-\uD83D\uDDFF]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 01:35:59.154 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756614941439.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 01:36:01.420 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 01:36:03.579 -03:00 [INF] Request starting GET /api/health
2025-08-31 01:36:03.579 -03:00 [INF] Request starting GET /api/chats
2025-08-31 01:36:03.580 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:36:03.579 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 01:36:03.643 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:36:03.643 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:36:03.653 -03:00 [INF] Request finished GET /api/health - 200 in 73.9280ms
2025-08-31 01:36:03.657 -03:00 [INF] Request starting GET /api/health
2025-08-31 01:36:03.658 -03:00 [INF] Request finished GET /api/health - 200 in 1.3330ms
2025-08-31 01:36:03.682 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:36:03.688 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:36:03.731 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 87.8150ms
2025-08-31 01:36:03.733 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 44.8790ms
2025-08-31 01:36:03.734 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 91.0910ms
2025-08-31 01:36:03.740 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 57.3760ms
2025-08-31 01:36:03.744 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:36:03.807 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:36:03.823 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:36:03.832 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 253.0640ms
2025-08-31 01:36:03.840 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:36:03.842 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 01:36:03.848 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 5.7530ms
2025-08-31 01:36:04.138 -03:00 [INF] Request finished GET /api/chats - 200 in 558.8870ms
2025-08-31 01:36:06.119 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2532.0110ms
2025-08-31 01:36:07.109 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:36:07.109 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 01:36:07.126 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 01:36:07.379 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 01:36:07.499 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 389.5990ms
2025-08-31 01:36:07.501 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:36:07.510 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 8.9580ms
2025-08-31 01:36:07.512 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:36:07.525 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 12.3580ms
2025-08-31 01:36:07.527 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:36:07.549 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 21.6320ms
2025-08-31 01:36:07.550 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:36:07.558 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 7.4630ms
2025-08-31 01:36:07.822 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 01:36:07.822 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 01:36:07.899 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 01:36:07.900 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 01:36:07.910 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 01:36:07.912 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 01:36:07.921 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 01:36:07.960 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 850.7020ms
2025-08-31 01:36:07.985 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 01:36:07.986 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 01:36:08.059 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 01:36:08.059 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 01:36:08.180 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 270.5110ms
2025-08-31 01:37:31.477 -03:00 [INF] Request finished GET /whatsappHub - 101 in 87618.1090ms
2025-08-31 01:37:31.477 -03:00 [INF] Request finished GET /whatsappHub - 101 in 87645.0410ms
2025-08-31 01:37:31.477 -03:00 [INF] Request finished GET /whatsappHub - 101 in 87635.5850ms
2025-08-31 01:37:31.472 -03:00 [INF] Request finished GET /whatsappHub - 101 in 87700.3950ms
2025-08-31 01:37:33.887 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:37:33.887 -03:00 [INF] Request starting GET /api/chats
2025-08-31 01:37:33.888 -03:00 [INF] Request starting GET /api/health
2025-08-31 01:37:33.888 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 01:37:33.996 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:37:34.001 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:37:34.036 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 35.1540ms
2025-08-31 01:37:34.035 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 38.9250ms
2025-08-31 01:37:34.053 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:37:34.054 -03:00 [INF] Request finished GET /api/health - 200 in 166.0920ms
2025-08-31 01:37:34.061 -03:00 [INF] Request starting GET /api/health
2025-08-31 01:37:34.062 -03:00 [INF] Request finished GET /api/health - 200 in 1.5070ms
2025-08-31 01:37:34.092 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:37:34.095 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 01:37:34.099 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 6.8500ms
2025-08-31 01:37:34.101 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 5.8340ms
2025-08-31 01:37:34.113 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:37:34.133 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:37:34.158 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 01:37:34.230 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 341.9310ms
2025-08-31 01:37:34.281 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 01:37:34.315 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 33.6540ms
2025-08-31 01:37:34.979 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1091.9380ms
2025-08-31 01:37:34.998 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:37:35.072 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 73.9890ms
2025-08-31 01:37:35.076 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:37:35.156 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 80.4950ms
2025-08-31 01:37:35.219 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:37:35.339 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 119.4230ms
2025-08-31 01:37:35.437 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:37:35.536 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 99.2260ms
2025-08-31 01:37:35.539 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 01:37:35.552 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 12.9780ms
2025-08-31 01:37:35.795 -03:00 [INF] Request starting GET /api/chats
2025-08-31 01:37:36.025 -03:00 [INF] Request finished GET /api/chats - 200 in 2137.1750ms
2025-08-31 01:37:36.668 -03:00 [INF] Request finished GET /api/chats - 200 in 872.8620ms
2025-08-31 01:37:37.938 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 01:37:37.976 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 01:37:38.068 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 01:37:38.800 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 01:37:38.801 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 01:37:38.950 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 01:37:38.951 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 01:37:38.985 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 01:37:38.996 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 01:37:39.015 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 01:37:39.155 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 1217.2420ms
2025-08-31 01:37:39.390 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 01:37:39.392 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 01:37:39.581 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 01:37:39.581 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 01:37:39.766 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 780.7320ms
2025-08-31 12:40:15.306 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 12:40:15.666 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 12:40:15.672 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 12:40:17.575 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 12:40:18.912 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 12:40:19.102 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 12:40:19.285 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 12:40:19.468 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 12:40:19.649 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 12:40:19.650 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 12:40:19.651 -03:00 [INF] Processamento de batch iniciado
2025-08-31 12:40:39.298 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 12:40:44.534 -03:00 [INF] Request starting GET /api/health
2025-08-31 12:40:44.534 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:40:44.534 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:40:44.534 -03:00 [INF] Request starting GET /api/chats
2025-08-31 12:40:44.534 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:40:44.534 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:40:44.555 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 18.2060ms
2025-08-31 12:40:44.555 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 18.1960ms
2025-08-31 12:40:44.557 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:40:44.569 -03:00 [INF] Request finished GET /api/health - 200 in 35.6850ms
2025-08-31 12:40:44.574 -03:00 [INF] Request starting GET /api/health
2025-08-31 12:40:44.574 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:40:44.579 -03:00 [INF] Request finished GET /api/health - 200 in 5.5910ms
2025-08-31 12:40:44.581 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:40:44.583 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 8.0730ms
2025-08-31 12:40:44.588 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:40:44.589 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.5340ms
2025-08-31 12:40:44.601 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:40:44.618 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:40:44.730 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 196.3020ms
2025-08-31 12:40:44.732 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:40:44.740 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 7.9560ms
2025-08-31 12:40:44.788 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 255.0560ms
2025-08-31 12:40:44.798 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:40:44.812 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 13.0820ms
2025-08-31 12:40:44.817 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:40:44.844 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 26.9320ms
2025-08-31 12:40:44.847 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:40:44.855 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 7.3620ms
2025-08-31 12:40:44.858 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:40:44.869 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 10.2990ms
2025-08-31 12:40:44.874 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:40:44.885 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 10.9320ms
2025-08-31 12:40:45.401 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756654827082.mp3
2025-08-31 12:40:45.427 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 12:40:45.428 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 12:40:45.432 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 12:40:45.435 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756654827082.mp3, MimeType=audio/mpeg
2025-08-31 12:40:45.435 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 12:40:45.436 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: b50ec444-a729-44b7-889d-8104394af63f
2025-08-31 12:40:45.446 -03:00 [INF] Request finished GET /api/chats - 200 in 912.7910ms
2025-08-31 12:40:46.848 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 12:40:46.899 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 12:40:46.969 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 12:40:47.124 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 12:40:47.124 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 12:40:47.214 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 22
2025-08-31 12:40:47.216 -03:00 [INF] ✅ Retornando 22 mensagens convertidas
2025-08-31 12:40:47.237 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 12:40:47.238 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 12:40:47.262 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 12:40:47.386 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 538.2330ms
2025-08-31 12:40:47.484 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 12:40:47.484 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 12:40:47.555 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 22
2025-08-31 12:40:47.555 -03:00 [INF] ✅ Retornando 22 mensagens convertidas
2025-08-31 12:40:47.886 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 649.2230ms
2025-08-31 12:40:48.973 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 12:40:49.000 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 12:40:49.007 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 12:40:49.062 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 12:40:49.070 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 12:40:49.076 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 12:40:49.077 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 12:40:49.079 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 12:40:49.082 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 12:40:49.096 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 122.0900ms
2025-08-31 12:40:49.108 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 12:40:49.110 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 12:40:49.124 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 12:40:49.135 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 12:40:49.135 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 12:40:49.135 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 12:40:49.135 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 12:40:49.136 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 28.1930ms
2025-08-31 12:40:49.301 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 12:40:49.315 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 12:40:49.358 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756654827082.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 12:40:49.999 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 12:40:50.824 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 12:40:50.834 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 12:40:51.091 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 12:40:51.091 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 12:40:51.241 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 23
2025-08-31 12:40:51.247 -03:00 [INF] ✅ Retornando 23 mensagens convertidas
2025-08-31 12:40:51.265 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 12:40:51.267 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 12:40:51.419 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 594.4470ms
2025-08-31 12:40:51.542 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 12:40:51.543 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 12:40:51.638 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 23
2025-08-31 12:40:51.639 -03:00 [INF] ✅ Retornando 23 mensagens convertidas
2025-08-31 12:40:51.798 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 533.0950ms
2025-08-31 12:41:15.265 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 12:41:16.416 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756654859906.mp3
2025-08-31 12:41:16.447 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 12:41:16.453 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 12:41:16.472 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 12:41:16.481 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756654859906.mp3, MimeType=audio/mpeg
2025-08-31 12:41:16.481 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 12:41:16.484 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: 2c694a5f-ca73-4c8e-9cbf-c0250fd45f7b
2025-08-31 12:41:19.247 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 12:41:19.251 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 12:41:19.281 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 12:41:19.283 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 12:41:19.293 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756654859906.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 12:41:20.832 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 12:49:06.762 -03:00 [INF] Request finished GET /whatsappHub - 101 in 502125.7850ms
2025-08-31 12:49:06.763 -03:00 [INF] Request finished GET /whatsappHub - 101 in 502143.2130ms
2025-08-31 12:49:06.763 -03:00 [INF] Request finished GET /whatsappHub - 101 in 502186.9400ms
2025-08-31 12:49:06.760 -03:00 [INF] Request finished GET /whatsappHub - 101 in 502163.0880ms
2025-08-31 12:49:10.422 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:49:10.422 -03:00 [INF] Request starting GET /api/health
2025-08-31 12:49:10.422 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:49:10.422 -03:00 [INF] Request starting GET /api/chats
2025-08-31 12:49:10.503 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:49:10.511 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:49:10.546 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 40.7630ms
2025-08-31 12:49:10.545 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 33.4590ms
2025-08-31 12:49:10.552 -03:00 [INF] Request finished GET /api/health - 200 in 134.3150ms
2025-08-31 12:49:10.554 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:49:10.558 -03:00 [INF] Request starting GET /api/health
2025-08-31 12:49:10.560 -03:00 [INF] Request finished GET /api/health - 200 in 2.5310ms
2025-08-31 12:49:10.565 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:49:10.567 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.3970ms
2025-08-31 12:49:10.597 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:49:10.599 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:49:10.602 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 3.1980ms
2025-08-31 12:49:10.613 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:49:10.628 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:49:11.329 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 910.5320ms
2025-08-31 12:49:11.342 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:49:11.419 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 76.6120ms
2025-08-31 12:49:14.255 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3837.2970ms
2025-08-31 12:49:14.261 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:49:14.282 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 21.0690ms
2025-08-31 12:49:14.284 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:49:14.296 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 12.5050ms
2025-08-31 12:49:14.299 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:49:14.336 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 36.8260ms
2025-08-31 12:49:14.349 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:49:14.369 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 20.2380ms
2025-08-31 12:49:14.372 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:49:14.379 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 6.7160ms
2025-08-31 12:49:15.754 -03:00 [INF] Request starting GET /api/chats
2025-08-31 12:49:15.894 -03:00 [INF] Request finished GET /api/chats - 200 in 5476.7090ms
2025-08-31 12:49:16.517 -03:00 [INF] Request finished GET /api/chats - 200 in 763.3780ms
2025-08-31 12:53:18.767 -03:00 [INF] Request finished GET /whatsappHub - 101 in 248212.6380ms
2025-08-31 12:53:18.770 -03:00 [INF] Request finished GET /whatsappHub - 101 in 248157.4490ms
2025-08-31 12:53:18.770 -03:00 [INF] Request finished GET /whatsappHub - 101 in 248141.7780ms
2025-08-31 12:53:18.771 -03:00 [INF] Request finished GET /whatsappHub - 101 in 248173.6550ms
2025-08-31 12:53:21.687 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:53:21.695 -03:00 [INF] Request starting GET /api/chats
2025-08-31 12:53:21.687 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:53:21.698 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:53:21.695 -03:00 [INF] Request starting GET /api/health
2025-08-31 12:53:21.699 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:53:21.716 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 18.3520ms
2025-08-31 12:53:21.718 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 18.2620ms
2025-08-31 12:53:21.733 -03:00 [INF] Request finished GET /api/health - 200 in 38.3950ms
2025-08-31 12:53:21.735 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:53:21.739 -03:00 [INF] Request starting GET /api/health
2025-08-31 12:53:21.741 -03:00 [INF] Request finished GET /api/health - 200 in 1.8080ms
2025-08-31 12:53:21.741 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:53:21.748 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 6.5650ms
2025-08-31 12:53:21.754 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:53:21.755 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.3760ms
2025-08-31 12:53:21.783 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:53:21.804 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:53:21.822 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:53:21.966 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 278.8770ms
2025-08-31 12:53:21.972 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:53:22.045 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 73.0770ms
2025-08-31 12:53:24.599 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2911.5540ms
2025-08-31 12:53:24.609 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:53:24.639 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 30.1480ms
2025-08-31 12:53:24.641 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:53:24.645 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 4.1700ms
2025-08-31 12:53:24.648 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:53:24.653 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 4.9250ms
2025-08-31 12:53:24.654 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:53:24.658 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3.7730ms
2025-08-31 12:53:24.660 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 12:53:24.671 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 11.1430ms
2025-08-31 12:53:25.828 -03:00 [INF] Request starting GET /api/chats
2025-08-31 12:53:25.941 -03:00 [INF] Request finished GET /api/chats - 200 in 4246.1380ms
2025-08-31 12:53:26.232 -03:00 [INF] Request finished GET /api/chats - 200 in 404.2930ms
2025-08-31 12:55:56.495 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:55:56.978 -03:00 [INF] Request finished GET /whatsappHub - 101 in 155242.8660ms
2025-08-31 12:55:57.078 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 582.4410ms
2025-08-31 12:56:05.518 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:56:05.531 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 12:56:05.544 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 13.0360ms
2025-08-31 12:56:05.555 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 12:56:05.572 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 53.8340ms
2025-08-31 12:56:25.823 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 12:56:25.833 -03:00 [INF] Request finished GET /whatsappHub - 101 in 20277.9710ms
2025-08-31 12:56:25.847 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 24.7660ms
2025-08-31 13:03:53.228 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 13:03:53.324 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 13:03:54.094 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 13:03:54.808 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 13:03:54.809 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:03:55.864 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 13:03:55.865 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 24
2025-08-31 13:03:55.867 -03:00 [INF] ✅ Retornando 24 mensagens convertidas
2025-08-31 13:03:55.878 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 13:03:55.880 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 13:03:55.880 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 13:03:55.911 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 13:03:55.916 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 13:03:55.916 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 13:03:55.916 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 13:03:55.916 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 13:03:55.917 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 54.0180ms
2025-08-31 13:03:55.920 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 13:03:55.920 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 13:03:55.926 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 13:03:55.930 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 13:03:55.930 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 13:03:55.931 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 13:03:55.932 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 13:03:55.933 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 12.8530ms
2025-08-31 13:03:56.624 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 13:03:56.776 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 3548.7460ms
2025-08-31 13:03:57.760 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 13:03:57.762 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:03:57.806 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 24
2025-08-31 13:03:57.807 -03:00 [INF] ✅ Retornando 24 mensagens convertidas
2025-08-31 13:03:57.821 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 13:03:57.831 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 13:03:57.852 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 13:03:58.551 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 13:03:58.554 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:03:58.750 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 2871.9960ms
2025-08-31 13:03:59.316 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 24
2025-08-31 13:03:59.345 -03:00 [INF] ✅ Retornando 24 mensagens convertidas
2025-08-31 13:03:59.389 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 13:03:59.408 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 13:03:59.457 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 13:03:59.850 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 13:03:59.851 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:03:59.958 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 2135.9960ms
2025-08-31 13:03:59.994 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 24
2025-08-31 13:03:59.995 -03:00 [INF] ✅ Retornando 24 mensagens convertidas
2025-08-31 13:04:00.240 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 851.0320ms
2025-08-31 13:05:43.159 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 13:05:44.589 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756656329538.mp3
2025-08-31 13:05:44.606 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 13:05:44.606 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 13:05:44.607 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 13:05:44.608 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756656329538.mp3, MimeType=audio/mpeg
2025-08-31 13:05:44.608 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 13:05:44.609 -03:00 [INF] 📝 ✅ Nova mensagem adicionada: 15b5ef08-29c8-4820-bd7e-d3c296824eac
2025-08-31 13:05:49.470 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 13:05:49.476 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 13:05:49.586 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 13:05:49.594 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 13:05:49.657 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756656329538.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 13:05:50.959 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 13:42:37.482 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 13:42:37.599 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 13:42:37.600 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 13:42:46.882 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 13:42:48.250 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 13:42:48.467 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 13:42:48.651 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 13:42:48.831 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 13:42:49.012 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 13:42:49.013 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 13:42:49.014 -03:00 [INF] Processamento de batch iniciado
2025-08-31 13:42:49.439 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 13:42:49.439 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 13:42:49.439 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 13:42:49.446 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.9820ms
2025-08-31 13:42:49.446 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.9650ms
2025-08-31 13:42:49.446 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.9690ms
2025-08-31 13:42:49.470 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 13:42:49.493 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 13:42:49.506 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 13:43:40.343 -03:00 [INF] Aplicação está sendo finalizada...
2025-08-31 13:43:40.389 -03:00 [INF] Request finished GET /whatsappHub - 101 in 50894.7310ms
2025-08-31 13:43:40.389 -03:00 [INF] Request finished GET /whatsappHub - 101 in 50918.4020ms
2025-08-31 13:43:40.389 -03:00 [INF] Request finished GET /whatsappHub - 101 in 50882.3310ms
2025-08-31 13:43:40.471 -03:00 [INF] Desconectando do RabbitMQ...
2025-08-31 13:43:40.880 -03:00 [INF] Processamento de batch cancelado graciosamente
2025-08-31 13:43:40.880 -03:00 [INF] RabbitMQ Background Service cancelado graciosamente
2025-08-31 13:43:40.881 -03:00 [INF] Processamento de batch finalizado
2025-08-31 13:43:40.881 -03:00 [INF] RabbitMQ Background Service finalizado
2025-08-31 13:43:40.882 -03:00 [INF] Aplicação foi finalizada
2025-08-31 13:44:06.111 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 13:44:06.221 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 13:44:06.223 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 13:44:08.992 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 13:44:10.329 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 13:44:10.519 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 13:44:10.705 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 13:44:10.890 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 13:44:11.077 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 13:44:11.079 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 13:44:11.082 -03:00 [INF] Processamento de batch iniciado
2025-08-31 13:44:25.403 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 13:44:25.403 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 13:44:25.403 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 13:44:25.412 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 9.7150ms
2025-08-31 13:44:25.412 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 9.7080ms
2025-08-31 13:44:25.412 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 9.7100ms
2025-08-31 13:44:25.432 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 13:44:25.450 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 13:44:25.462 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 13:45:21.185 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 13:45:22.606 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 13:45:31.350 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 13:45:31.350 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 13:45:31.358 -03:00 [INF] Request starting GET /api/chats/5511988776655/messages
2025-08-31 13:45:31.373 -03:00 [INF] Request finished GET /api/chats/5511988776655/messages - 404 in 15.2430ms
2025-08-31 13:45:31.391 -03:00 [INF] Request starting GET /api/chats/5511988776655/messages
2025-08-31 13:45:31.392 -03:00 [INF] Request finished GET /api/chats/5511988776655/messages - 404 in 1.0920ms
2025-08-31 13:45:31.404 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 13:45:31.404 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 13:45:33.925 -03:00 [INF] Request starting GET /api/chats/5511988776655/messages
2025-08-31 13:45:33.924 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 13:45:33.932 -03:00 [INF] Request finished GET /api/chats/5511988776655/messages - 404 in 8.1670ms
2025-08-31 13:45:33.935 -03:00 [INF] Request starting GET /api/chats/5511988776655/messages
2025-08-31 13:45:33.936 -03:00 [INF] Request finished GET /api/chats/5511988776655/messages - 404 in 1.4060ms
2025-08-31 13:45:33.945 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 13:45:36.273 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 13:45:36.273 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 13:45:36.273 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 13:45:36.273 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 13:45:36.275 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:45:36.275 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:45:36.275 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:45:36.275 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:45:36.722 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 25
2025-08-31 13:45:36.787 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 25
2025-08-31 13:45:36.794 -03:00 [INF] ✅ Retornando 25 mensagens convertidas
2025-08-31 13:45:36.795 -03:00 [INF] ✅ Retornando 25 mensagens convertidas
2025-08-31 13:45:36.797 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 25
2025-08-31 13:45:36.798 -03:00 [INF] ✅ Retornando 25 mensagens convertidas
2025-08-31 13:45:36.801 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 25
2025-08-31 13:45:36.802 -03:00 [INF] ✅ Retornando 25 mensagens convertidas
2025-08-31 13:45:36.891 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 15706.1080ms
2025-08-31 13:45:36.891 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 5540.8700ms
2025-08-31 13:45:36.896 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 5546.5120ms
2025-08-31 13:45:36.941 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 13:45:36.946 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 13:45:37.377 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 3452.4910ms
2025-08-31 13:45:37.403 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 13:45:37.406 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:45:37.499 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 25
2025-08-31 13:45:37.500 -03:00 [INF] ✅ Retornando 25 mensagens convertidas
2025-08-31 13:45:37.559 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 13:45:37.564 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 13:45:37.668 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 13:45:37.668 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:45:37.747 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 25
2025-08-31 13:45:37.748 -03:00 [INF] ✅ Retornando 25 mensagens convertidas
2025-08-31 13:45:37.782 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 13:45:37.783 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 13:45:37.883 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 13:45:37.883 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 13:45:37.947 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 25
2025-08-31 13:45:37.947 -03:00 [INF] ✅ Retornando 25 mensagens convertidas
2025-08-31 13:45:39.587 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 2646.2050ms
2025-08-31 13:45:39.654 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 1871.6780ms
2025-08-31 13:45:39.710 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 2151.3930ms
2025-08-31 13:45:59.192 -03:00 [INF] Aplicação está sendo finalizada...
2025-08-31 13:45:59.256 -03:00 [INF] Request finished GET /whatsappHub - 101 in 93823.3090ms
2025-08-31 13:45:59.256 -03:00 [INF] Request finished GET /whatsappHub - 101 in 93805.8500ms
2025-08-31 13:45:59.256 -03:00 [INF] Request finished GET /whatsappHub - 101 in 93792.8870ms
2025-08-31 13:45:59.284 -03:00 [INF] Desconectando do RabbitMQ...
2025-08-31 13:45:59.758 -03:00 [INF] Processamento de batch cancelado graciosamente
2025-08-31 13:45:59.758 -03:00 [INF] RabbitMQ Background Service cancelado graciosamente
2025-08-31 13:45:59.758 -03:00 [INF] Processamento de batch finalizado
2025-08-31 13:45:59.758 -03:00 [INF] RabbitMQ Background Service finalizado
2025-08-31 13:45:59.759 -03:00 [INF] Aplicação foi finalizada
2025-08-31 13:46:45.845 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 13:46:45.985 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 13:46:45.986 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 13:46:49.472 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 13:46:50.908 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 13:46:51.108 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 13:46:51.295 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 13:46:51.481 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 13:46:51.670 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 13:46:51.671 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 13:46:51.675 -03:00 [INF] Processamento de batch iniciado
2025-08-31 13:47:02.185 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 13:47:06.190 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 13:47:07.800 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T13:05:30.0000000")
2025-08-31 13:47:07.873 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 13:47:07.882 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 15070493 chars)
2025-08-31 13:47:08.064 -03:00 [INF] 📊 PayloadJson carregado: 25 mensagens existentes
2025-08-31 13:47:08.066 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756658806378.mp3
2025-08-31 13:47:08.077 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 13:47:08.077 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 13:47:08.078 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 13:47:08.080 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756658806378.mp3, MimeType=audio/mpeg
2025-08-31 13:47:08.080 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 13:47:08.080 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 8c28ed87-3963-49e6-9bb2-ce9de932a627
2025-08-31 13:47:08.081 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: 8c28ed87-3963-49e6-9bb2-ce9de932a627 (Total: 26 mensagens)
2025-08-31 13:47:08.249 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 15070493 chars, depois: 15907537 chars)
2025-08-31 13:47:11.414 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 26 mensagens no PayloadJson
2025-08-31 13:47:11.414 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 13:47:11.414 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 13:47:11.470 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 13:47:11.479 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 13:47:11.551 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756658806378.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 13:47:14.365 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 13:48:17.844 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 13:48:17.935 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 13:48:18.822 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T13:46:46.0000000")
2025-08-31 13:48:18.896 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 13:48:18.897 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 15907537 chars)
2025-08-31 13:48:19.065 -03:00 [INF] 📊 PayloadJson carregado: 26 mensagens existentes
2025-08-31 13:48:19.065 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756658882032.mp3
2025-08-31 13:48:19.074 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 13:48:19.074 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 13:48:19.074 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 13:48:19.078 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756658882032.mp3, MimeType=audio/mpeg
2025-08-31 13:48:19.079 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 13:48:19.079 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 16f97d18-fb51-4731-a88a-afeb106349fd
2025-08-31 13:48:19.079 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: 16f97d18-fb51-4731-a88a-afeb106349fd (Total: 27 mensagens)
2025-08-31 13:48:19.320 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 15907537 chars, depois: 16744581 chars)
2025-08-31 13:48:21.017 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 27 mensagens no PayloadJson
2025-08-31 13:48:21.018 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 13:48:21.018 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 13:48:21.032 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 13:48:21.035 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 13:48:21.064 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756658882032.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 13:48:21.360 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 15:33:13.067 -03:00 [WRN] As of ""2025-08-31T18:33:12.3655600+00:00"", the heartbeat has been running for ""00:00:01.1508495"" which is longer than ""00:00:01"". This could be caused by thread pool starvation.
2025-08-31 15:43:22.086 -03:00 [INF] Aplicação está sendo finalizada...
2025-08-31 15:43:22.268 -03:00 [INF] Desconectando do RabbitMQ...
2025-08-31 15:43:22.755 -03:00 [INF] Processamento de batch cancelado graciosamente
2025-08-31 15:43:22.755 -03:00 [INF] RabbitMQ Background Service cancelado graciosamente
2025-08-31 15:43:22.755 -03:00 [INF] Processamento de batch finalizado
2025-08-31 15:43:22.755 -03:00 [INF] RabbitMQ Background Service finalizado
2025-08-31 15:43:22.756 -03:00 [INF] Aplicação foi finalizada
2025-08-31 16:49:19.347 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 16:49:20.407 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 16:49:20.410 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 16:49:23.435 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 16:49:24.767 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 16:49:24.972 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 16:49:25.158 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 16:49:25.339 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 16:49:25.527 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 16:49:25.528 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 16:49:25.532 -03:00 [INF] Processamento de batch iniciado
2025-08-31 16:49:26.804 -03:00 [INF] Request starting GET /api/chats
2025-08-31 16:49:28.824 -03:00 [INF] Request finished GET /api/chats - 200 in 2021.1340ms
2025-08-31 16:49:36.205 -03:00 [INF] Request starting GET /api/chats
2025-08-31 16:49:36.205 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 16:49:36.205 -03:00 [INF] Request starting GET /api/health
2025-08-31 16:49:36.207 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 16:49:36.222 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 16:49:36.223 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 16:49:36.232 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 8.6690ms
2025-08-31 16:49:36.234 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 11.3340ms
2025-08-31 16:49:36.242 -03:00 [INF] Request finished GET /api/health - 200 in 36.2470ms
2025-08-31 16:49:36.242 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 16:49:36.243 -03:00 [INF] Request starting GET /api/health
2025-08-31 16:49:36.243 -03:00 [INF] Request finished GET /api/health - 200 in 0.3830ms
2025-08-31 16:49:36.258 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 16:49:36.259 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.4780ms
2025-08-31 16:49:36.259 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 16:49:36.261 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.4630ms
2025-08-31 16:49:36.263 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 16:49:36.279 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 16:49:36.292 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 16:49:36.295 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 88.5880ms
2025-08-31 16:49:36.297 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 16:49:36.303 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 5.8500ms
2025-08-31 16:49:36.552 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 347.4590ms
2025-08-31 16:49:36.560 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 16:49:36.573 -03:00 [INF] Request finished GET /api/chats - 200 in 368.4650ms
2025-08-31 16:49:36.587 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 26.4910ms
2025-08-31 16:49:36.589 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 16:49:36.605 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 15.7530ms
2025-08-31 16:49:36.606 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 16:49:36.611 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 4.5400ms
2025-08-31 16:49:36.612 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 16:49:36.616 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 4.1950ms
2025-08-31 16:49:36.618 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 16:49:36.620 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2.4040ms
2025-08-31 16:49:37.558 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 16:49:37.592 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 16:49:37.611 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:37.709 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:37.710 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 16:49:37.810 -03:00 [INF] PayloadJson no formato NOVO detectado: 27 mensagens
2025-08-31 16:49:37.810 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 27
2025-08-31 16:49:37.811 -03:00 [INF] ✅ Retornando 27 mensagens convertidas
2025-08-31 16:49:37.820 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 16:49:37.821 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 16:49:37.823 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:37.881 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 323.0320ms
2025-08-31 16:49:37.989 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:37.990 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 16:49:38.074 -03:00 [INF] PayloadJson no formato NOVO detectado: 27 mensagens
2025-08-31 16:49:38.075 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 27
2025-08-31 16:49:38.075 -03:00 [INF] ✅ Retornando 27 mensagens convertidas
2025-08-31 16:49:38.140 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 320.6420ms
2025-08-31 16:49:39.407 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 16:49:39.410 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 16:49:39.425 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:39.427 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:39.427 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 16:49:39.436 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 16:49:39.437 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 16:49:39.437 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 16:49:39.439 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 31.7670ms
2025-08-31 16:49:39.440 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 16:49:39.441 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 16:49:39.510 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:39.513 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:39.513 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 16:49:39.513 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 16:49:39.513 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 16:49:39.514 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 16:49:39.515 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 74.0640ms
2025-08-31 16:49:40.229 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 16:49:40.230 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 16:49:40.233 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:40.235 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:40.235 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 16:49:40.236 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 16:49:40.237 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 16:49:40.238 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 16:49:40.240 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 11.0470ms
2025-08-31 16:49:40.243 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 16:49:40.245 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 16:49:40.251 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:40.252 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:40.252 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 16:49:40.253 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 16:49:40.253 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 16:49:40.253 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 16:49:40.254 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 10.6830ms
2025-08-31 16:49:41.312 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 16:49:41.319 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 16:49:41.358 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:41.360 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:41.360 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 16:49:41.361 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 16:49:41.361 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 16:49:41.361 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 16:49:41.362 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 50.7860ms
2025-08-31 16:49:41.363 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 16:49:41.364 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 16:49:41.375 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:41.378 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:41.378 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 16:49:41.378 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 16:49:41.378 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 16:49:41.379 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 16:49:41.379 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 16.1350ms
2025-08-31 16:49:43.097 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 16:49:43.099 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 16:49:43.101 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:43.102 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:43.102 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 16:49:43.102 -03:00 [INF] PayloadJson no formato NOVO detectado: 6 mensagens
2025-08-31 16:49:43.102 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 16:49:43.102 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 16:49:43.102 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 5.6270ms
2025-08-31 16:49:43.103 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 16:49:43.104 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 16:49:43.106 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 16:49:43.107 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 16:49:43.107 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 16:49:43.108 -03:00 [INF] PayloadJson no formato NOVO detectado: 6 mensagens
2025-08-31 16:49:43.108 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 16:49:43.108 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 16:49:43.108 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 5.0370ms
2025-08-31 16:51:23.343 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 16:51:23.649 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 16:51:23.819 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T13:48:02.0000000")
2025-08-31 16:51:23.853 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 16:51:23.854 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 16744581 chars)
2025-08-31 16:51:24.114 -03:00 [INF] PayloadJson no formato NOVO detectado: 27 mensagens
2025-08-31 16:51:24.115 -03:00 [INF] 📊 PayloadJson carregado: 27 mensagens existentes
2025-08-31 16:51:24.121 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756669870838.mp3
2025-08-31 16:51:24.131 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 16:51:24.131 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 16:51:24.133 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 16:51:24.135 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756669870838.mp3, MimeType=audio/mpeg
2025-08-31 16:51:24.135 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 16:51:24.135 -03:00 [INF] 🔍 Verificando duplicata para MessageId: df6aa87a-649d-445b-8b02-d5f623ffdb82
2025-08-31 16:51:24.136 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: df6aa87a-649d-445b-8b02-d5f623ffdb82 (Total: 28 mensagens)
2025-08-31 16:51:24.515 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 16744581 chars, depois: 17581625 chars)
2025-08-31 16:51:27.484 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 28 mensagens no PayloadJson
2025-08-31 16:51:27.485 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 16:51:27.490 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 16:51:27.586 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 16:51:27.600 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 16:51:27.653 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756669870838.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 16:51:28.108 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 16:51:29.268 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 16:51:29.281 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 16:51:29.561 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 16:51:29.564 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 16:51:29.686 -03:00 [INF] PayloadJson no formato NOVO detectado: 28 mensagens
2025-08-31 16:51:29.686 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 28
2025-08-31 16:51:29.686 -03:00 [INF] ✅ Retornando 28 mensagens convertidas
2025-08-31 16:51:29.690 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 16:51:29.690 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 16:51:29.822 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 554.3180ms
2025-08-31 16:51:29.839 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 16:51:29.839 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 16:51:30.014 -03:00 [INF] PayloadJson no formato NOVO detectado: 28 mensagens
2025-08-31 16:51:30.016 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 28
2025-08-31 16:51:30.017 -03:00 [INF] ✅ Retornando 28 mensagens convertidas
2025-08-31 16:51:30.149 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 459.4270ms
2025-08-31 16:54:07.869 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 16:54:08.941 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 16:54:10.017 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T16:51:11.0000000")
2025-08-31 16:54:10.132 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 16:54:10.132 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 17581625 chars)
2025-08-31 16:54:10.342 -03:00 [INF] PayloadJson no formato NOVO detectado: 28 mensagens
2025-08-31 16:54:10.342 -03:00 [INF] 📊 PayloadJson carregado: 28 mensagens existentes
2025-08-31 16:54:10.343 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756670035788.mp3
2025-08-31 16:54:10.363 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 16:54:10.363 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 16:54:10.363 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 16:54:10.368 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756670035788.mp3, MimeType=audio/mpeg
2025-08-31 16:54:10.368 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 16:54:10.368 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 35e19f51-06cb-4799-8bd3-e458a3037367
2025-08-31 16:54:10.368 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: 35e19f51-06cb-4799-8bd3-e458a3037367 (Total: 29 mensagens)
2025-08-31 16:54:10.586 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 17581625 chars, depois: 18418669 chars)
2025-08-31 16:54:12.193 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 29 mensagens no PayloadJson
2025-08-31 16:54:12.193 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 16:54:12.194 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 16:54:12.274 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 16:54:12.280 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 16:54:12.310 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756670035788.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 16:54:14.393 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 16:54:40.285 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655
2025-08-31 16:54:40.396 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 16:54:40.576 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T16:53:56.0000000")
2025-08-31 16:54:40.583 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 16:54:40.583 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 18418669 chars)
2025-08-31 16:54:40.841 -03:00 [INF] PayloadJson no formato NOVO detectado: 29 mensagens
2025-08-31 16:54:40.841 -03:00 [INF] 📊 PayloadJson carregado: 29 mensagens existentes
2025-08-31 16:54:40.841 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756670067670.mp3
2025-08-31 16:54:40.845 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 16:54:40.845 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 16:54:40.845 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 16:54:40.845 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756670067670.mp3, MimeType=audio/mpeg
2025-08-31 16:54:40.846 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 16:54:40.846 -03:00 [INF] 🔍 Verificando duplicata para MessageId: fdd684cc-b902-4bf7-94c9-7d5fa7f85c78
2025-08-31 16:54:40.846 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: fdd684cc-b902-4bf7-94c9-7d5fa7f85c78 (Total: 30 mensagens)
2025-08-31 16:54:40.940 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 18418669 chars, depois: 19255712 chars)
2025-08-31 16:54:42.781 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 30 mensagens no PayloadJson
2025-08-31 16:54:42.782 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 16:54:42.784 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 16:54:42.791 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 16:54:42.795 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 16:54:42.802 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756670067670.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 16:54:44.519 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 16:57:45.442 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655@c.us
2025-08-31 16:57:45.735 -03:00 [INF] 📞 ✅ Nova conversa WhatsApp criada para 5511988776655: "6b222413-fa9b-43b4-a2ba-8d1a17b2520f"
2025-08-31 16:57:45.735 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 16:57:46.440 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T16:54:28.0000000")
2025-08-31 16:57:46.477 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 16:57:46.478 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 19255712 chars)
2025-08-31 16:57:46.662 -03:00 [INF] PayloadJson no formato NOVO detectado: 30 mensagens
2025-08-31 16:57:46.663 -03:00 [INF] 📊 PayloadJson carregado: 30 mensagens existentes
2025-08-31 16:57:46.664 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=text, Body_Length=72, FileName=null, MimeType=null
2025-08-31 16:57:46.665 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=text, Body_Length=72, MediaUrl=null
2025-08-31 16:57:46.665 -03:00 [INF] 🔍 Verificando duplicata para MessageId: d4ea1abc-0016-4fd1-9cec-7397638eab67
2025-08-31 16:57:46.666 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: d4ea1abc-0016-4fd1-9cec-7397638eab67 (Total: 31 mensagens)
2025-08-31 16:57:46.970 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 19255712 chars, depois: 19256381 chars)
2025-08-31 16:57:47.860 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 31 mensagens no PayloadJson
2025-08-31 16:57:47.861 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 16:57:47.862 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 16:57:47.871 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 16:57:47.876 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 16:57:48.976 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 17:22:31.806 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:22:31.805 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:22:31.806 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:22:31.836 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1975556.3460ms
2025-08-31 17:22:31.886 -03:00 [INF] Request finished GET /api/health - 200 in 80.1530ms
2025-08-31 17:22:31.902 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:22:31.913 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 11.3030ms
2025-08-31 17:22:31.924 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:22:35.390 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3583.4000ms
2025-08-31 17:22:39.916 -03:00 [INF] Request finished GET /api/chats - 200 in 8110.9410ms
2025-08-31 17:22:48.704 -03:00 [INF] Request finished GET /whatsappHub - 101 in 16780.2330ms
2025-08-31 17:22:48.705 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1992412.1530ms
2025-08-31 17:22:48.704 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1992441.6490ms
2025-08-31 17:22:48.701 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1992458.4690ms
2025-08-31 17:22:50.929 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:22:50.929 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:22:50.930 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:22:50.929 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:22:50.934 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:22:50.937 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:22:50.951 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 16.7690ms
2025-08-31 17:22:50.951 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 14.2110ms
2025-08-31 17:22:50.956 -03:00 [INF] Request finished GET /api/health - 200 in 26.3430ms
2025-08-31 17:22:50.960 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:22:50.960 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:22:50.961 -03:00 [INF] Request finished GET /api/health - 200 in 1.5710ms
2025-08-31 17:22:50.969 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:22:50.970 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.6200ms
2025-08-31 17:22:50.982 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:22:50.983 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.4790ms
2025-08-31 17:22:50.985 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:22:51.009 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:22:51.027 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:22:51.046 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 116.0150ms
2025-08-31 17:22:51.047 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:22:51.067 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 19.5230ms
2025-08-31 17:22:51.681 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 751.9020ms
2025-08-31 17:22:51.723 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:22:51.774 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 50.3800ms
2025-08-31 17:22:51.776 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:22:51.780 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 4.4130ms
2025-08-31 17:22:51.784 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:22:51.791 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 6.9620ms
2025-08-31 17:22:51.797 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:22:51.825 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 27.9090ms
2025-08-31 17:22:51.835 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:22:51.840 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 5.4110ms
2025-08-31 17:22:58.232 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:22:58.430 -03:00 [INF] Request finished GET /api/chats - 200 in 7501.0730ms
2025-08-31 17:22:59.506 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655@c.us
2025-08-31 17:23:00.443 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 17:23:01.540 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T16:57:45.0000000")
2025-08-31 17:23:01.684 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 17:23:01.691 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 19256381 chars)
2025-08-31 17:23:01.919 -03:00 [INF] PayloadJson no formato NOVO detectado: 31 mensagens
2025-08-31 17:23:01.919 -03:00 [INF] 📊 PayloadJson carregado: 31 mensagens existentes
2025-08-31 17:23:01.920 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=text, Body_Length=72, FileName=null, MimeType=null
2025-08-31 17:23:01.920 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=text, Body_Length=72, MediaUrl=null
2025-08-31 17:23:01.920 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 07e09b2c-54bd-4819-9210-1fcbb004bfad
2025-08-31 17:23:01.920 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: 07e09b2c-54bd-4819-9210-1fcbb004bfad (Total: 32 mensagens)
2025-08-31 17:23:02.188 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 17:23:02.209 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 17:23:02.235 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:23:03.113 -03:00 [INF] Request finished GET /api/chats - 200 in 4880.6220ms
2025-08-31 17:23:03.517 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 19256381 chars, depois: 19257050 chars)
2025-08-31 17:23:04.283 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:23:04.283 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:23:04.590 -03:00 [INF] PayloadJson no formato NOVO detectado: 31 mensagens
2025-08-31 17:23:04.591 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 31
2025-08-31 17:23:04.591 -03:00 [INF] ✅ Retornando 31 mensagens convertidas
2025-08-31 17:23:04.610 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 17:23:04.624 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 17:23:04.685 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:23:05.219 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 3031.8090ms
2025-08-31 17:23:05.538 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:23:05.540 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:23:05.904 -03:00 [INF] PayloadJson no formato NOVO detectado: 31 mensagens
2025-08-31 17:23:05.904 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 31
2025-08-31 17:23:05.904 -03:00 [INF] ✅ Retornando 31 mensagens convertidas
2025-08-31 17:23:06.592 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 1981.1540ms
2025-08-31 17:23:10.715 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 32 mensagens no PayloadJson
2025-08-31 17:23:10.716 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 17:23:10.719 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 17:23:10.763 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 17:23:10.767 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 17:23:11.108 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 17:23:13.705 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 17:23:13.709 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 17:23:14.307 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 17:23:14.308 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:23:14.733 -03:00 [INF] PayloadJson no formato NOVO detectado: 32 mensagens
2025-08-31 17:23:14.737 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 32
2025-08-31 17:23:14.737 -03:00 [INF] ✅ Retornando 32 mensagens convertidas
2025-08-31 17:23:14.778 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 17:23:14.783 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 17:23:15.066 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:23:15.070 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:23:15.072 -03:00 [INF] Request finished GET /api/health - 200 in 5.9770ms
2025-08-31 17:23:15.073 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:23:15.087 -03:00 [INF] Request finished GET /whatsappHub - 101 in 24060.0780ms
2025-08-31 17:23:15.112 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:23:15.116 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 4.7370ms
2025-08-31 17:23:15.122 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:23:15.210 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 17:23:15.214 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:23:15.319 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 1614.1310ms
2025-08-31 17:23:15.778 -03:00 [INF] PayloadJson no formato NOVO detectado: 32 mensagens
2025-08-31 17:23:15.780 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 32
2025-08-31 17:23:15.780 -03:00 [INF] ✅ Retornando 32 mensagens convertidas
2025-08-31 17:23:16.120 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 1341.9600ms
2025-08-31 17:23:16.224 -03:00 [INF] Request finished GET /api/chats - 200 in 1144.5100ms
2025-08-31 17:23:16.416 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1346.8290ms
2025-08-31 17:25:51.515 -03:00 [INF] Request finished GET /whatsappHub - 101 in 156390.0390ms
2025-08-31 17:25:51.520 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:25:51.520 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:25:51.521 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:25:51.538 -03:00 [INF] Request finished GET /api/health - 200 in 18.5450ms
2025-08-31 17:25:51.547 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:25:51.552 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 4.3270ms
2025-08-31 17:25:51.557 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:25:51.636 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 116.4980ms
2025-08-31 17:25:52.822 -03:00 [INF] Request finished GET /api/chats - 200 in 1300.8380ms
2025-08-31 17:28:36.825 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:28:36.827 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:28:36.827 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:28:36.847 -03:00 [INF] Request finished GET /api/health - 200 in 22.3550ms
2025-08-31 17:28:36.849 -03:00 [INF] Request finished GET /whatsappHub - 101 in 165291.8870ms
2025-08-31 17:28:36.885 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:28:36.890 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 5.2180ms
2025-08-31 17:28:36.915 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:28:38.154 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1302.4580ms
2025-08-31 17:28:40.503 -03:00 [INF] Request finished GET /api/chats - 200 in 3675.7770ms
2025-08-31 17:31:46.865 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511888776655@c.us
2025-08-31 17:31:47.162 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 17:31:47.383 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T17:22:59.0000000")
2025-08-31 17:31:47.402 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 17:31:47.402 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 19257050 chars)
2025-08-31 17:31:48.153 -03:00 [INF] PayloadJson no formato NOVO detectado: 32 mensagens
2025-08-31 17:31:48.155 -03:00 [INF] 📊 PayloadJson carregado: 32 mensagens existentes
2025-08-31 17:31:48.155 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=text, Body_Length=72, FileName=null, MimeType=null
2025-08-31 17:31:48.156 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=text, Body_Length=72, MediaUrl=null
2025-08-31 17:31:48.156 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 9ca15b12-90f5-4e54-985b-9dc61b93b78e
2025-08-31 17:31:48.156 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: 9ca15b12-90f5-4e54-985b-9dc61b93b78e (Total: 33 mensagens)
2025-08-31 17:31:48.949 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 19257050 chars, depois: 19257718 chars)
2025-08-31 17:31:52.059 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 33 mensagens no PayloadJson
2025-08-31 17:31:52.060 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 17:31:52.062 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 17:31:52.093 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 17:31:52.097 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 17:31:52.607 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 17:35:06.207 -03:00 [INF] Aplicação está sendo finalizada...
2025-08-31 17:35:06.227 -03:00 [INF] Request finished GET /whatsappHub - 101 in 735241.8840ms
2025-08-31 17:35:06.229 -03:00 [INF] Request finished GET /whatsappHub - 101 in 735220.4820ms
2025-08-31 17:35:06.229 -03:00 [INF] Request finished GET /whatsappHub - 101 in 735269.4840ms
2025-08-31 17:35:06.231 -03:00 [INF] Request finished GET /whatsappHub - 101 in 389315.7950ms
2025-08-31 17:35:06.289 -03:00 [INF] Desconectando do RabbitMQ...
2025-08-31 17:35:06.673 -03:00 [INF] RabbitMQ Background Service cancelado graciosamente
2025-08-31 17:35:06.673 -03:00 [INF] Processamento de batch cancelado graciosamente
2025-08-31 17:35:06.673 -03:00 [INF] RabbitMQ Background Service finalizado
2025-08-31 17:35:06.673 -03:00 [INF] Processamento de batch finalizado
2025-08-31 17:35:06.674 -03:00 [INF] Aplicação foi finalizada
2025-08-31 17:35:37.530 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 17:35:37.663 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 17:35:37.664 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 17:35:39.996 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 17:35:41.327 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 17:35:41.518 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 17:35:41.705 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 17:35:41.906 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 17:35:42.137 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 17:35:42.148 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 17:35:42.189 -03:00 [INF] Processamento de batch iniciado
2025-08-31 17:35:51.342 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:35:51.343 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:35:51.345 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:35:51.345 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:35:51.409 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 64.2860ms
2025-08-31 17:35:51.410 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 64.3290ms
2025-08-31 17:35:51.410 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 70.4790ms
2025-08-31 17:35:51.410 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 66.4140ms
2025-08-31 17:35:51.439 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:35:51.457 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:35:51.471 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:35:51.485 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:37:16.723 -03:00 [INF] Request starting POST /api/whatsapp/session/updated
2025-08-31 17:37:17.011 -03:00 [INF] 📥 Webhook session/updated: connected=false number=null validated=false (mudança detectada)
2025-08-31 17:37:17.023 -03:00 [INF] Request finished POST /api/whatsapp/session/updated - 200 in 300.3300ms
2025-08-31 17:37:57.703 -03:00 [INF] Request starting POST /api/whatsapp/generate-qr
2025-08-31 17:37:57.720 -03:00 [INF] 📥 Requisição de geração de QR recebida
2025-08-31 17:37:57.721 -03:00 [INF] Iniciado pedido de QR Code. RequestId: d32b978b-ef09-4d1a-877f-ec363620ee82
2025-08-31 17:37:57.723 -03:00 [INF] 🔍 Tentando publicar comando no RabbitMQ...
2025-08-31 17:37:57.728 -03:00 [INF] 📤 Publicando comando: {"command":"generate_qr","requestId":"d32b978b-ef09-4d1a-877f-ec363620ee82","timestamp":"2025-08-31T20:37:57.7216220Z"}
2025-08-31 17:37:57.728 -03:00 [INF] 📤 Routing Key: whatsapp.outgoing
2025-08-31 17:37:57.728 -03:00 [INF] 📤 Body length: 119 bytes
2025-08-31 17:37:57.729 -03:00 [INF] 📤 Body as string: {"command":"generate_qr","requestId":"d32b978b-ef09-4d1a-877f-ec363620ee82","timestamp":"2025-08-31T20:37:57.7216220Z"}
2025-08-31 17:37:57.729 -03:00 [INF] 📤 Body hex: 7B-22-63-6F-6D-6D-61-6E-64-22-3A-22-67-65-6E-65-72-61-74-65-5F-71-72-22-2C-22-72-65-71-75-65-73-74-49-64-22-3A-22-64-33-32-62-39-37-38-62-2D-65-66-30-39-2D-34-64-31-61-2D-38-37-37-66-2D-65-63-33-36-33-36-32-30-65-65-38-32-22-2C-22-74-69-6D-65-73-74-61-6D-70-22-3A-22-32-30-32-35-2D-30-38-2D-33-31-54-32-30-3A-33-37-3A-35-37-2E-37-32-31-36-32-32-30-5A-22-7D
2025-08-31 17:37:57.733 -03:00 [INF] ✅ Comando enviado para RabbitMQ com sucesso: {"command":"generate_qr","requestId":"d32b978b-ef09-4d1a-877f-ec363620ee82","timestamp":"2025-08-31T20:37:57.7216220Z"}
2025-08-31 17:37:57.733 -03:00 [INF] ✅ Novo QR request criado com sucesso. RequestId: d32b978b-ef09-4d1a-877f-ec363620ee82
2025-08-31 17:37:57.735 -03:00 [INF] Request finished POST /api/whatsapp/generate-qr - 200 in 32.6380ms
2025-08-31 17:38:26.517 -03:00 [INF] Request starting POST /api/whatsapp/webhook/qr-code
2025-08-31 17:38:26.605 -03:00 [INF] 📤 QR Code emitido via SignalR (webhook) requestId=null
2025-08-31 17:38:26.607 -03:00 [INF] Request finished POST /api/whatsapp/webhook/qr-code - 200 in 90.1020ms
2025-08-31 17:38:26.731 -03:00 [INF] 📱 QR Code recebido via RabbitMQ
2025-08-31 17:39:06.086 -03:00 [INF] Request finished GET /whatsappHub - 101 in 194614.0080ms
2025-08-31 17:39:06.129 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:39:06.130 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:39:06.131 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:39:06.388 -03:00 [INF] Request finished GET /api/health - 200 in 257.2130ms
2025-08-31 17:39:06.418 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:39:06.421 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 3.0090ms
2025-08-31 17:39:06.466 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:39:19.107 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 12977.7200ms
2025-08-31 17:39:26.307 -03:00 [INF] Request finished GET /api/chats - 200 in 20175.2400ms
2025-08-31 17:39:41.169 -03:00 [INF] Request finished GET /whatsappHub - 101 in 34702.9120ms
2025-08-31 17:39:41.301 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:39:41.302 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:39:41.302 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:39:41.425 -03:00 [INF] Request finished GET /api/health - 200 in 123.1040ms
2025-08-31 17:39:41.544 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:39:41.560 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 16.2280ms
2025-08-31 17:39:41.592 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:39:42.457 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1155.5870ms
2025-08-31 17:39:44.663 -03:00 [INF] Request finished GET /api/chats - 200 in 3361.7510ms
2025-08-31 17:40:11.094 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:40:12.716 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 1622.1870ms
2025-08-31 17:40:12.760 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:40:12.815 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 55.5310ms
2025-08-31 17:40:14.323 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:40:14.510 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 187.0970ms
2025-08-31 17:40:27.554 -03:00 [INF] Request finished GET /whatsappHub - 101 in 45961.0680ms
2025-08-31 17:40:27.646 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:40:27.646 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:40:27.646 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:40:27.646 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:40:27.681 -03:00 [INF] Request finished GET /api/health - 200 in 34.9670ms
2025-08-31 17:40:27.684 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:40:27.684 -03:00 [INF] Request finished GET /api/health - 200 in 0.2970ms
2025-08-31 17:40:27.686 -03:00 [INF] Request finished GET /whatsappHub - 101 in 276201.3050ms
2025-08-31 17:40:27.712 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:40:27.713 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:40:27.730 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 16.4850ms
2025-08-31 17:40:27.731 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 18.7110ms
2025-08-31 17:40:27.760 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:40:27.787 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:40:27.888 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 242.8150ms
2025-08-31 17:40:27.901 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:40:27.922 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 20.5260ms
2025-08-31 17:40:29.834 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2188.0860ms
2025-08-31 17:40:29.845 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:40:29.895 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 50.1380ms
2025-08-31 17:40:29.897 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:40:29.908 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 11.2920ms
2025-08-31 17:40:29.911 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:40:29.946 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 35.5170ms
2025-08-31 17:40:29.961 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:40:30.010 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 49.2420ms
2025-08-31 17:40:30.012 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:40:30.138 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 126.6170ms
2025-08-31 17:40:31.964 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:40:32.330 -03:00 [INF] Request finished GET /api/chats - 200 in 4683.4200ms
2025-08-31 17:40:32.978 -03:00 [INF] Request finished GET /api/chats - 200 in 1013.1490ms
2025-08-31 17:40:51.187 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:40:51.187 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:40:51.187 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:40:51.234 -03:00 [INF] Request finished GET /api/health - 200 in 47.9710ms
2025-08-31 17:40:51.268 -03:00 [INF] Request finished GET /whatsappHub - 101 in 23508.2030ms
2025-08-31 17:40:51.307 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:40:51.314 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.1170ms
2025-08-31 17:40:51.364 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:40:56.344 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 5157.1400ms
2025-08-31 17:40:59.802 -03:00 [INF] Request finished GET /api/chats - 200 in 8615.3790ms
2025-08-31 17:41:08.671 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:41:09.337 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:41:09.345 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 674.0540ms
2025-08-31 17:41:09.369 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 31.8640ms
2025-08-31 17:41:09.374 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:41:09.379 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 4.5440ms
2025-08-31 17:41:09.976 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:41:10.002 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 26.1990ms
2025-08-31 17:41:23.520 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 17:41:23.806 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:41:23.808 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:41:23.808 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:41:23.813 -03:00 [INF] Request finished GET /api/health - 200 in 4.9880ms
2025-08-31 17:41:23.815 -03:00 [INF] Request finished GET /whatsappHub - 101 in 32450.9110ms
2025-08-31 17:41:23.838 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:41:23.841 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 2.5640ms
2025-08-31 17:41:23.840 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 17:41:23.866 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:41:25.183 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 17:41:25.205 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 17:41:27.074 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3267.2820ms
2025-08-31 17:41:27.328 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 17:41:27.357 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 17:41:27.497 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.398 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.393 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.402 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:41:29.414 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.417 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.417 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 17:41:29.426 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.427 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 17:41:29.532 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 17:41:29.564 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 17:41:29.575 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 17:41:29.576 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 17:41:29.579 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 17:41:29.579 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 17:41:29.586 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.602 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.602 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 17:41:29.602 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 17:41:29.602 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 17:41:29.613 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 17:41:29.615 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 17:41:29.617 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 17:41:29.645 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 112.2510ms
2025-08-31 17:41:29.647 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 4464.3050ms
2025-08-31 17:41:29.651 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 17:41:29.650 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 6129.7220ms
2025-08-31 17:41:29.656 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 17:41:29.658 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 17:41:29.659 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 17:41:29.659 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 17:41:29.662 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 17:41:29.668 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.670 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.676 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.681 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.681 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 17:41:29.683 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.683 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 17:41:29.683 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 17:41:29.683 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 17:41:29.683 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 17:41:29.684 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 33.1140ms
2025-08-31 17:41:29.686 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 17:41:29.691 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 17:41:29.691 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 17:41:29.687 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.692 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 17:41:29.692 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 17:41:29.693 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 17:41:29.693 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 17:41:29.698 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 42.0250ms
2025-08-31 17:41:29.698 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 38.5780ms
2025-08-31 17:41:29.701 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 17:41:29.702 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 17:41:29.703 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 17:41:29.707 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 17:41:29.717 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.726 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.731 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.731 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 17:41:29.733 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 17:41:29.733 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 17:41:29.733 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 17:41:29.734 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.734 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 17:41:29.734 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 17:41:29.734 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 17:41:29.734 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 17:41:29.734 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 33.0520ms
2025-08-31 17:41:29.735 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 32.1820ms
2025-08-31 17:41:29.741 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 17:41:29.743 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 17:41:29.751 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 17:41:29.752 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 17:41:29.769 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.771 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:29.776 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.776 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 17:41:29.777 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:29.777 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 17:41:29.776 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 17:41:29.778 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 17:41:29.778 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 17:41:29.778 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 36.8030ms
2025-08-31 17:41:29.778 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 17:41:29.782 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 17:41:29.782 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 17:41:29.784 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 41.3140ms
2025-08-31 17:41:30.580 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 17:41:30.581 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 33
2025-08-31 17:41:30.581 -03:00 [INF] ✅ Retornando 33 mensagens convertidas
2025-08-31 17:41:30.619 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 17:41:30.629 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 17:41:30.659 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:41:31.181 -03:00 [INF] Request finished GET /api/chats - 200 in 7372.7770ms
2025-08-31 17:41:31.732 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:41:31.734 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:41:33.506 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 17:41:33.507 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 33
2025-08-31 17:41:33.508 -03:00 [INF] ✅ Retornando 33 mensagens convertidas
2025-08-31 17:41:33.982 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 6654.1930ms
2025-08-31 17:41:35.145 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 4520.8240ms
2025-08-31 17:41:46.797 -03:00 [INF] Request finished GET /whatsappHub - 101 in 22928.6660ms
2025-08-31 17:41:46.826 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:41:46.826 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:41:46.827 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:41:46.845 -03:00 [INF] Request finished GET /api/health - 200 in 18.4220ms
2025-08-31 17:41:46.897 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:41:46.910 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 12.6590ms
2025-08-31 17:41:46.926 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:41:47.004 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 177.6360ms
2025-08-31 17:41:50.100 -03:00 [INF] Request finished GET /api/chats - 200 in 3263.6660ms
2025-08-31 17:42:09.450 -03:00 [INF] Request finished GET /whatsappHub - 101 in 22523.0710ms
2025-08-31 17:42:09.473 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:42:09.474 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:42:09.474 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:42:09.515 -03:00 [INF] Request finished GET /api/health - 200 in 40.9880ms
2025-08-31 17:42:09.547 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:42:09.553 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 5.6650ms
2025-08-31 17:42:09.570 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:42:09.963 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 489.2450ms
2025-08-31 17:42:12.872 -03:00 [INF] Request finished GET /api/chats - 200 in 3397.9460ms
2025-08-31 17:42:23.284 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 17:42:23.303 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 17:42:23.498 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:42:23.507 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:42:23.508 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 17:42:23.513 -03:00 [INF] PayloadJson no formato NOVO detectado: 6 mensagens
2025-08-31 17:42:23.513 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 17:42:23.515 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 17:42:23.517 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 232.5240ms
2025-08-31 17:42:23.519 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 17:42:23.522 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 17:42:23.525 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:42:23.545 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:42:23.545 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 17:42:23.546 -03:00 [INF] PayloadJson no formato NOVO detectado: 6 mensagens
2025-08-31 17:42:23.547 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 17:42:23.547 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 17:42:23.548 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 28.9260ms
2025-08-31 17:42:33.306 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:42:33.307 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:42:33.321 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:42:33.327 -03:00 [INF] Request finished GET /api/health - 200 in 19.5610ms
2025-08-31 17:42:33.327 -03:00 [INF] Request finished GET /whatsappHub - 101 in 23756.7590ms
2025-08-31 17:42:33.347 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:42:33.355 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.9990ms
2025-08-31 17:42:33.368 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:42:33.447 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 141.1210ms
2025-08-31 17:42:37.424 -03:00 [INF] Request finished GET /api/chats - 200 in 4101.8510ms
2025-08-31 17:43:05.809 -03:00 [INF] Request finished GET /whatsappHub - 101 in 434369.6650ms
2025-08-31 17:43:05.817 -03:00 [INF] Request finished GET /whatsappHub - 101 in 434359.4200ms
2025-08-31 17:43:05.817 -03:00 [INF] Request finished GET /whatsappHub - 101 in 32448.7590ms
2025-08-31 17:43:05.817 -03:00 [INF] Request finished GET /whatsappHub - 101 in 158030.7710ms
2025-08-31 17:43:08.010 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:43:08.010 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:43:08.010 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:43:08.010 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:43:08.026 -03:00 [INF] Request finished GET /api/health - 200 in 15.7420ms
2025-08-31 17:43:08.028 -03:00 [INF] Request starting GET /api/health
2025-08-31 17:43:08.028 -03:00 [INF] Request finished GET /api/health - 200 in 0.2300ms
2025-08-31 17:43:08.141 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:43:08.142 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:43:08.150 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 9.8150ms
2025-08-31 17:43:08.152 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:43:08.150 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 8.5230ms
2025-08-31 17:43:08.157 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 17:43:08.156 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 3.8040ms
2025-08-31 17:43:08.158 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.2540ms
2025-08-31 17:43:08.179 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:43:08.194 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:43:08.208 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:43:08.224 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 17:43:08.234 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 223.7160ms
2025-08-31 17:43:08.235 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:43:08.242 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 7.1200ms
2025-08-31 17:43:08.934 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 922.7560ms
2025-08-31 17:43:08.939 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:43:08.964 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 25.3930ms
2025-08-31 17:43:08.965 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:43:08.976 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 10.3120ms
2025-08-31 17:43:08.993 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:43:09.014 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 21.0410ms
2025-08-31 17:43:09.016 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:43:09.022 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 5.8880ms
2025-08-31 17:43:09.023 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 17:43:09.034 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 10.7390ms
2025-08-31 17:43:12.123 -03:00 [INF] Request starting GET /api/chats
2025-08-31 17:43:12.242 -03:00 [INF] Request finished GET /api/chats - 200 in 4232.2470ms
2025-08-31 17:43:13.814 -03:00 [INF] Request finished GET /api/chats - 200 in 1690.8410ms
2025-08-31 17:44:38.717 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:44:39.175 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 458.2940ms
2025-08-31 17:44:40.250 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:44:40.287 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 36.8300ms
2025-08-31 17:44:42.026 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:44:42.076 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 50.1340ms
2025-08-31 17:44:57.689 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:44:57.748 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 59.2550ms
2025-08-31 17:45:02.370 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 17:45:02.497 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 127.8470ms
2025-08-31 17:45:03.588 -03:00 [INF] Request starting GET /favicon.ico
2025-08-31 17:45:03.617 -03:00 [INF] Request finished GET /favicon.ico - 404 in 30.7330ms
2025-08-31 17:53:43.175 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 17:53:43.256 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 17:53:46.057 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:46.065 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 17:53:46.074 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 17:53:46.440 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:47.025 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:47.033 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 17:53:47.055 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 17:53:47.061 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 17:53:47.062 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 17:53:47.074 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 1008.2950ms
2025-08-31 17:53:47.083 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 17:53:47.092 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 17:53:47.127 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:47.152 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:47.152 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 17:53:47.153 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 17:53:47.153 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 17:53:47.153 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 17:53:47.154 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 71.3940ms
2025-08-31 17:53:47.411 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 17:53:47.481 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 17:53:47.797 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:47.818 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:47.818 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 17:53:47.821 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 17:53:47.821 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 17:53:47.823 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 17:53:47.829 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 418.2370ms
2025-08-31 17:53:47.870 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 17:53:47.893 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 17:53:47.929 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:48.168 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:48.328 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 17:53:48.357 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 17:53:48.360 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 17:53:48.362 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 17:53:48.382 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 512.0800ms
2025-08-31 17:53:51.227 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:51.230 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:53:51.511 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 17:53:51.512 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 33
2025-08-31 17:53:51.512 -03:00 [INF] ✅ Retornando 33 mensagens convertidas
2025-08-31 17:53:52.139 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 17:53:52.630 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 17:53:52.873 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:53.154 -03:00 [INF] Request starting GET /api/chats/5511988776655/messages
2025-08-31 17:53:53.158 -03:00 [INF] Request finished GET /api/chats/5511988776655/messages - 404 in 4.3840ms
2025-08-31 17:53:53.163 -03:00 [INF] Request starting GET /api/chats/5511988776655/messages
2025-08-31 17:53:53.164 -03:00 [INF] Request finished GET /api/chats/5511988776655/messages - 404 in 0.9680ms
2025-08-31 17:53:53.354 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 10181.1490ms
2025-08-31 17:53:54.507 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:54.509 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:53:54.853 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 17:53:54.853 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 33
2025-08-31 17:53:54.855 -03:00 [INF] ✅ Retornando 33 mensagens convertidas
2025-08-31 17:53:54.858 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 2719.4150ms
2025-08-31 17:53:55.342 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 17:53:55.347 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 17:53:55.384 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:55.392 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:55.392 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 17:53:55.393 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 17:53:55.393 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 17:53:55.393 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 17:53:55.394 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 52.1770ms
2025-08-31 17:53:55.398 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 17:53:55.399 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 17:53:55.402 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:55.408 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:55.408 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 17:53:55.408 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 17:53:55.408 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 17:53:55.408 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 17:53:55.409 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 11.7350ms
2025-08-31 17:53:57.112 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 17:53:57.127 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 17:53:57.142 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:57.145 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:57.146 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 17:53:57.147 -03:00 [INF] PayloadJson no formato NOVO detectado: 6 mensagens
2025-08-31 17:53:57.147 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 17:53:57.147 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 17:53:57.148 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 36.3920ms
2025-08-31 17:53:57.151 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 17:53:57.152 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 17:53:57.155 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:53:57.163 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:53:57.164 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 17:53:57.164 -03:00 [INF] PayloadJson no formato NOVO detectado: 6 mensagens
2025-08-31 17:53:57.164 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 17:53:57.164 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 17:53:57.164 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 12.8880ms
2025-08-31 17:54:00.445 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 17:54:00.452 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 17:54:00.480 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:54:00.755 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:54:00.756 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:54:01.007 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 17:54:01.008 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 33
2025-08-31 17:54:01.008 -03:00 [INF] ✅ Retornando 33 mensagens convertidas
2025-08-31 17:54:01.025 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 17:54:01.027 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 17:54:01.031 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 17:54:01.633 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 1189.7380ms
2025-08-31 17:54:02.672 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 17:54:02.803 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 17:54:03.057 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 17:54:03.059 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 33
2025-08-31 17:54:03.060 -03:00 [INF] ✅ Retornando 33 mensagens convertidas
2025-08-31 17:54:03.717 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 2689.4400ms
2025-08-31 18:01:36.814 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:01:36.814 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:01:36.814 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:01:36.820 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1108636.4400ms
2025-08-31 18:01:36.852 -03:00 [INF] Request finished GET /api/health - 200 in 39.5940ms
2025-08-31 18:01:36.886 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:01:36.911 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.1630ms
2025-08-31 18:01:36.930 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:01:38.970 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2158.0420ms
2025-08-31 18:01:40.889 -03:00 [INF] Request finished GET /api/chats - 200 in 4076.3860ms
2025-08-31 18:02:20.805 -03:00 [INF] Request finished GET /whatsappHub - 101 in 43874.9330ms
2025-08-31 18:02:20.830 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:02:20.830 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:02:20.830 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:02:21.270 -03:00 [INF] Request finished GET /api/health - 200 in 442.2820ms
2025-08-31 18:02:21.324 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:02:21.345 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 21.1620ms
2025-08-31 18:02:21.390 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:02:22.070 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1242.6320ms
2025-08-31 18:02:25.525 -03:00 [INF] Request finished GET /api/chats - 200 in 4697.0780ms
2025-08-31 18:02:48.808 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:02:48.806 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:02:48.808 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:02:48.816 -03:00 [INF] Request finished GET /whatsappHub - 101 in 27426.5010ms
2025-08-31 18:02:48.826 -03:00 [INF] Request finished GET /api/health - 200 in 20.0810ms
2025-08-31 18:02:48.861 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:02:48.862 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.7070ms
2025-08-31 18:02:48.871 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:02:48.971 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 163.2270ms
2025-08-31 18:02:50.101 -03:00 [INF] Request finished GET /api/chats - 200 in 1292.0330ms
2025-08-31 18:03:06.908 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:03:06.909 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:03:06.908 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:03:06.933 -03:00 [INF] Request finished GET /whatsappHub - 101 in 18061.3600ms
2025-08-31 18:03:08.061 -03:00 [INF] Request finished GET /api/health - 200 in 1152.8640ms
2025-08-31 18:03:08.329 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:03:08.337 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 8.1040ms
2025-08-31 18:03:08.346 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:03:08.405 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1496.9550ms
2025-08-31 18:03:10.437 -03:00 [INF] Request finished GET /api/chats - 200 in 3528.5320ms
2025-08-31 18:03:38.752 -03:00 [INF] Request finished GET /whatsappHub - 101 in 30405.8280ms
2025-08-31 18:03:38.755 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:03:38.755 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:03:38.755 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:03:38.762 -03:00 [INF] Request finished GET /api/health - 200 in 7.3630ms
2025-08-31 18:03:38.771 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:03:38.775 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 3.8620ms
2025-08-31 18:03:38.780 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:03:39.110 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 354.8900ms
2025-08-31 18:03:42.576 -03:00 [INF] Request finished GET /api/chats - 200 in 3818.6660ms
2025-08-31 18:04:55.510 -03:00 [INF] Request finished GET /whatsappHub - 101 in 76727.7670ms
2025-08-31 18:04:55.510 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1307300.0870ms
2025-08-31 18:04:55.510 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1307283.8140ms
2025-08-31 18:04:55.525 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1307330.9280ms
2025-08-31 18:05:01.258 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 18:05:01.258 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:05:01.258 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:05:01.258 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:05:01.326 -03:00 [INF] Request finished GET /api/health - 200 in 65.2760ms
2025-08-31 18:05:01.336 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:05:01.338 -03:00 [INF] Request finished GET /api/health - 200 in 2.0820ms
2025-08-31 18:05:01.364 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:05:01.365 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:05:01.373 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.9950ms
2025-08-31 18:05:01.373 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:05:01.373 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 8.7390ms
2025-08-31 18:05:01.373 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:05:01.374 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.0040ms
2025-08-31 18:05:01.483 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:05:01.558 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 185.2550ms
2025-08-31 18:05:01.581 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:05:01.595 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:05:01.611 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:05:01.619 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 360.5610ms
2025-08-31 18:05:01.621 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 18:05:01.626 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 5.0640ms
2025-08-31 18:05:02.514 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1255.5810ms
2025-08-31 18:05:02.527 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:05:02.537 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 10.1380ms
2025-08-31 18:05:02.541 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:05:02.550 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 9.1540ms
2025-08-31 18:05:02.552 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:05:02.568 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 16.0440ms
2025-08-31 18:05:02.570 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:05:02.605 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 35.4850ms
2025-08-31 18:05:02.608 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:05:02.622 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 14.1870ms
2025-08-31 18:05:03.447 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:05:03.591 -03:00 [INF] Request finished GET /api/chats - 200 in 2332.1280ms
2025-08-31 18:05:05.252 -03:00 [INF] Request finished GET /api/chats - 200 in 1804.7700ms
2025-08-31 18:05:06.918 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 18:05:07.023 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 18:05:07.511 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:08.304 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:08.305 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 18:05:09.520 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 18:05:09.544 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 18:05:09.674 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:09.690 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:09.691 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 18:05:09.700 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 18:05:09.703 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 18:05:09.703 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 18:05:09.710 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 190.2900ms
2025-08-31 18:05:09.714 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 18:05:09.714 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 18:05:09.726 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:09.729 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:09.730 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 18:05:09.736 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 18:05:09.736 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 18:05:09.739 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 18:05:09.741 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 26.9770ms
2025-08-31 18:05:10.216 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 18:05:10.240 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 33
2025-08-31 18:05:10.288 -03:00 [INF] ✅ Retornando 33 mensagens convertidas
2025-08-31 18:05:10.340 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 18:05:10.344 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 18:05:10.423 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:10.723 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 18:05:10.724 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 18:05:10.738 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:10.741 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:10.741 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 18:05:10.744 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 18:05:10.744 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 18:05:10.744 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 18:05:10.746 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 22.7750ms
2025-08-31 18:05:10.749 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 18:05:10.750 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 18:05:10.758 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:10.761 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:10.762 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 18:05:10.763 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 18:05:10.763 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 18:05:10.763 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 18:05:10.786 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 37.4620ms
2025-08-31 18:05:10.958 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 4048.5330ms
2025-08-31 18:05:12.611 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:12.615 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 18:05:13.612 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 18:05:13.615 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 33
2025-08-31 18:05:13.615 -03:00 [INF] ✅ Retornando 33 mensagens convertidas
2025-08-31 18:05:14.217 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 3876.0580ms
2025-08-31 18:05:15.487 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 18:05:15.879 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 18:05:16.680 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:16.698 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:16.699 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 18:05:16.701 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 18:05:16.702 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 18:05:16.702 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 18:05:16.710 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 1223.1300ms
2025-08-31 18:05:16.730 -03:00 [INF] Request starting GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages
2025-08-31 18:05:16.731 -03:00 [INF] 🔍 Buscando mensagens para ID: addfb86b-5f48-4d8f-af8f-3dd3d0bdba88
2025-08-31 18:05:16.742 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:16.743 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:16.745 -03:00 [INF] ✅ Chat encontrado: b64ae137-519f-42a8-b2e7-57b4571e410e, ContactPhoneE164: 5511974614271
2025-08-31 18:05:16.745 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 18:05:16.746 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 18:05:16.746 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 18:05:16.752 -03:00 [INF] Request finished GET /api/chats/addfb86b-5f48-4d8f-af8f-3dd3d0bdba88/messages - 200 in 21.8530ms
2025-08-31 18:05:20.431 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 18:05:20.438 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 18:05:20.556 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:20.601 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:20.601 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 18:05:20.616 -03:00 [INF] PayloadJson no formato NOVO detectado: 6 mensagens
2025-08-31 18:05:20.622 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 18:05:20.622 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 18:05:20.642 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 211.0690ms
2025-08-31 18:05:20.663 -03:00 [INF] Request starting GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages
2025-08-31 18:05:20.676 -03:00 [INF] 🔍 Buscando mensagens para ID: 3d47b694-2d21-4434-81ec-b797883c67d8
2025-08-31 18:05:20.737 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 18:05:20.761 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 18:05:20.761 -03:00 [INF] ✅ Chat encontrado: 78e34825-0822-4163-8885-f202dff04d60, ContactPhoneE164: 5511949908369
2025-08-31 18:05:20.761 -03:00 [INF] PayloadJson no formato NOVO detectado: 6 mensagens
2025-08-31 18:05:20.761 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 6
2025-08-31 18:05:20.761 -03:00 [INF] ✅ Retornando 6 mensagens convertidas
2025-08-31 18:05:20.761 -03:00 [INF] Request finished GET /api/chats/3d47b694-2d21-4434-81ec-b797883c67d8/messages - 200 in 98.1020ms
2025-08-31 18:08:12.257 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 5511949907658
2025-08-31 18:08:13.060 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 18:08:15.292 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T17:31:46.0000000")
2025-08-31 18:08:15.381 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 18:08:15.382 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 19257718 chars)
2025-08-31 18:08:15.626 -03:00 [INF] PayloadJson no formato NOVO detectado: 33 mensagens
2025-08-31 18:08:15.627 -03:00 [INF] 📊 PayloadJson carregado: 33 mensagens existentes
2025-08-31 18:08:15.628 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756674478970.mp3
2025-08-31 18:08:15.644 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 18:08:15.645 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 18:08:15.648 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 18:08:15.654 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756674478970.mp3, MimeType=audio/mpeg
2025-08-31 18:08:15.654 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 18:08:15.656 -03:00 [INF] 🔍 Verificando duplicata para MessageId: ae653582-2bc4-491c-9fcb-76591a845454
2025-08-31 18:08:15.656 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: ae653582-2bc4-491c-9fcb-76591a845454 (Total: 34 mensagens)
2025-08-31 18:08:16.555 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 19257718 chars, depois: 20094762 chars)
2025-08-31 18:08:28.531 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 34 mensagens no PayloadJson
2025-08-31 18:08:28.532 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 18:08:28.566 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 18:08:28.726 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 18:08:28.773 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 18:08:28.888 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756674478970.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 18:08:32.698 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 18:08:38.532 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 18:08:38.576 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 18:08:40.774 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 18:08:40.777 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 18:08:45.892 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 18:08:45.893 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 18:08:45.893 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 18:08:45.949 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 18:08:45.962 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 18:08:47.149 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 8616.5840ms
2025-08-31 18:08:52.690 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 18:08:52.701 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 18:08:53.653 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 18:08:53.658 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 18:08:53.660 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 18:08:54.454 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 8503.4370ms
2025-08-31 18:10:28.381 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988770987@c.us -> 5511949907658
2025-08-31 18:10:29.987 -03:00 [INF] 📞 ✅ Nova conversa WhatsApp criada para 5511988770987: "c0d2c101-08c6-43c3-9841-5000676323b4"
2025-08-31 18:10:29.990 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988770987
2025-08-31 18:10:30.181 -03:00 [INF] ❌ ChatLog NÃO ENCONTRADO para 5511988770987. Verificando por ChatId da conversa...
2025-08-31 18:10:33.717 -03:00 [INF] ❌ Nenhum ChatLog encontrado. Será criado novo ChatLog para 5511988770987
2025-08-31 18:10:35.838 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756674612732.mp3
2025-08-31 18:10:35.886 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 18:10:35.887 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 18:10:35.887 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 18:10:35.888 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756674612732.mp3, MimeType=audio/mpeg
2025-08-31 18:10:35.889 -03:00 [INF] 💾 MessageInfo criado para PayloadJson: Type=audio, Body_Length=390507, MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 18:10:38.253 -03:00 [INF] 📝 ✅ NOVO ChatLog criado para 5511988770987@c.us: ChatId="c0d2c101-08c6-43c3-9841-5000676323b4", ChatLogId="b2e20bff-829c-4ddd-bc69-e3b6c20271dd"
2025-08-31 18:10:38.266 -03:00 [INF] 📡 ✅ Evento chat.created emitido para ChatLog: "b2e20bff-829c-4ddd-bc69-e3b6c20271dd"
2025-08-31 18:10:38.294 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 18:10:38.497 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756674612732.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 18:10:40.895 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 18:11:27.986 -03:00 [INF] Request starting GET /api/chats/b2e20bff-829c-4ddd-bc69-e3b6c20271dd/messages
2025-08-31 18:11:28.014 -03:00 [INF] 🔍 Buscando mensagens para ID: b2e20bff-829c-4ddd-bc69-e3b6c20271dd
2025-08-31 18:11:28.216 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 18:11:28.221 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 18:11:28.278 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 18:11:28.280 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 18:11:28.281 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 18:11:28.323 -03:00 [INF] Request starting GET /api/chats/b2e20bff-829c-4ddd-bc69-e3b6c20271dd/messages
2025-08-31 18:11:28.324 -03:00 [INF] 🔍 Buscando mensagens para ID: b2e20bff-829c-4ddd-bc69-e3b6c20271dd
2025-08-31 18:11:28.333 -03:00 [INF] Request finished GET /api/chats/b2e20bff-829c-4ddd-bc69-e3b6c20271dd/messages - 200 in 346.6290ms
2025-08-31 18:11:28.383 -03:00 [INF] 📄 Busca por ID do ChatLog: Encontrado
2025-08-31 18:11:28.383 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 18:11:28.407 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 18:11:28.408 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 18:11:28.408 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 18:11:28.426 -03:00 [INF] Request finished GET /api/chats/b2e20bff-829c-4ddd-bc69-e3b6c20271dd/messages - 200 in 103.3340ms
2025-08-31 18:30:13.711 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1512097.2880ms
2025-08-31 18:30:13.711 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1512222.6040ms
2025-08-31 18:30:13.711 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1512112.7220ms
2025-08-31 18:30:13.711 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1512127.6140ms
2025-08-31 18:31:03.012 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 18:31:03.012 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:31:03.012 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:31:03.012 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:31:03.386 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:31:03.386 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:31:03.571 -03:00 [INF] Request finished GET /api/health - 200 in 552.0710ms
2025-08-31 18:31:03.583 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:31:03.585 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 199.4550ms
2025-08-31 18:31:03.587 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 200.8920ms
2025-08-31 18:31:03.587 -03:00 [INF] Request finished GET /api/health - 200 in 3.9250ms
2025-08-31 18:31:03.621 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:31:03.622 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:31:03.625 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 4.2100ms
2025-08-31 18:31:03.630 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 8.0580ms
2025-08-31 18:31:03.662 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:31:03.804 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:31:03.819 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:31:03.841 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:31:04.444 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 1432.9710ms
2025-08-31 18:31:04.450 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 18:31:04.472 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 22.3890ms
2025-08-31 18:31:12.705 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 9693.1560ms
2025-08-31 18:31:12.727 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:31:12.967 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 240.3950ms
2025-08-31 18:31:12.990 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:31:13.691 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 700.8440ms
2025-08-31 18:31:13.788 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:31:13.885 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 96.5270ms
2025-08-31 18:31:13.942 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:31:16.855 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2910.4390ms
2025-08-31 18:31:17.450 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:31:20.054 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2603.8400ms
2025-08-31 18:31:20.802 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:31:38.658 -03:00 [INF] Request finished GET /whatsappHub - 101 in 34816.6910ms
2025-08-31 18:31:38.658 -03:00 [INF] Request finished GET /whatsappHub - 101 in 34995.8710ms
2025-08-31 18:31:38.658 -03:00 [INF] Request finished GET /whatsappHub - 101 in 34838.6040ms
2025-08-31 18:31:38.657 -03:00 [INF] Request finished GET /whatsappHub - 101 in 34849.6540ms
2025-08-31 18:31:38.825 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:31:38.825 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:31:38.825 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:31:38.825 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:31:38.851 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.2750ms
2025-08-31 18:31:38.851 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.5210ms
2025-08-31 18:31:38.854 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 28.5280ms
2025-08-31 18:31:38.854 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 28.5800ms
2025-08-31 18:31:39.657 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:31:39.709 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:31:39.724 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:31:39.739 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:31:40.249 -03:00 [INF] Request finished GET /api/chats - 200 in 37238.0230ms
2025-08-31 18:31:40.347 -03:00 [INF] Request finished GET /api/chats - 200 in 19545.4020ms
2025-08-31 18:31:40.426 -03:00 [INF] Request finished GET /whatsappHub - 101 in 702.5870ms
2025-08-31 18:31:40.426 -03:00 [INF] Request finished GET /whatsappHub - 101 in 716.7420ms
2025-08-31 18:31:40.433 -03:00 [INF] Request finished GET /whatsappHub - 101 in 694.0900ms
2025-08-31 18:31:40.433 -03:00 [INF] Request finished GET /whatsappHub - 101 in 775.7010ms
2025-08-31 18:33:02.302 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 18:33:02.302 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:33:02.302 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:33:02.302 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:33:02.312 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:33:02.319 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:33:02.330 -03:00 [INF] Request finished GET /api/health - 200 in 27.8100ms
2025-08-31 18:33:02.332 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:33:02.332 -03:00 [INF] Request finished GET /api/health - 200 in 0.1430ms
2025-08-31 18:33:02.356 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 37.3360ms
2025-08-31 18:33:02.356 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 44.3870ms
2025-08-31 18:33:02.374 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:33:02.357 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:33:02.374 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.1280ms
2025-08-31 18:33:02.376 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 18.5950ms
2025-08-31 18:33:02.474 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 172.1080ms
2025-08-31 18:33:02.475 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 18:33:02.508 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 32.9050ms
2025-08-31 18:33:02.523 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:33:02.544 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:33:02.558 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:33:02.574 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:33:04.726 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2424.3500ms
2025-08-31 18:33:04.730 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:33:04.736 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 5.9780ms
2025-08-31 18:33:04.737 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:33:04.745 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 8.0680ms
2025-08-31 18:33:04.746 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:33:04.789 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 43.2400ms
2025-08-31 18:33:04.790 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:33:04.793 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3.3650ms
2025-08-31 18:33:04.794 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:33:04.798 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3.3600ms
2025-08-31 18:33:13.229 -03:00 [INF] Request finished GET /api/chats - 200 in 10926.5140ms
2025-08-31 18:49:23.727 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:49:23.727 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:49:23.727 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:49:23.725 -03:00 [INF] Request finished GET /whatsappHub - 101 in 981149.4570ms
2025-08-31 18:49:23.743 -03:00 [INF] Request finished GET /api/health - 200 in 15.7000ms
2025-08-31 18:49:23.764 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:49:23.769 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 4.7330ms
2025-08-31 18:49:23.787 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:49:26.252 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2517.1200ms
2025-08-31 18:49:33.501 -03:00 [INF] Request finished GET /api/chats - 200 in 9773.6110ms
2025-08-31 18:49:44.149 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 18:49:45.757 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 18:49:47.077 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 18:49:47.271 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 18:49:47.458 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 18:49:47.648 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 18:49:47.654 -03:00 [INF] Request finished GET /whatsappHub - 101 in 23867.0270ms
2025-08-31 18:49:47.659 -03:00 [INF] Request starting GET /api/chats
2025-08-31 18:49:47.659 -03:00 [INF] Request starting GET /api/health
2025-08-31 18:49:47.660 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 18:49:47.665 -03:00 [INF] Request finished GET /api/health - 200 in 5.5360ms
2025-08-31 18:49:47.680 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 18:49:47.681 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.7220ms
2025-08-31 18:49:47.693 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 18:49:47.831 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 18:49:47.833 -03:00 [INF] Processamento de batch iniciado
2025-08-31 18:49:47.869 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 18:49:48.072 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 412.1980ms
2025-08-31 18:49:49.342 -03:00 [INF] Request finished GET /api/chats - 200 in 1683.1920ms
2025-08-31 21:03:42.907 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 21:03:43.141 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 21:03:45.367 -03:00 [INF] Request starting POST /api/attendances/c0d2c101-08c6-43c3-9841-5000676323b4/assign
2025-08-31 21:03:49.060 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:03:49.634 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:03:49.634 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 21:03:49.652 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 21:03:49.652 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 21:03:49.652 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 21:03:49.673 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 21:03:49.677 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 21:03:49.680 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 6776.5020ms
2025-08-31 21:03:49.681 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:03:49.767 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:03:49.768 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 21:03:49.784 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 21:03:49.784 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 21:03:49.785 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 21:03:49.801 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 128.2480ms
2025-08-31 21:03:49.989 -03:00 [INF] Request finished POST /api/attendances/c0d2c101-08c6-43c3-9841-5000676323b4/assign - 200 in 4621.3520ms
2025-08-31 21:04:09.914 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 21:04:09.933 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 21:04:10.096 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:04:11.748 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 21:04:12.045 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 21:04:12.399 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:04:12.553 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:04:12.553 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 21:04:12.560 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 21:04:12.562 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 21:04:12.562 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 21:04:12.567 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 820.3130ms
2025-08-31 21:04:12.579 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 21:04:12.580 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 21:04:12.583 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:04:12.662 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:04:12.662 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 21:04:12.663 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 21:04:12.663 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 21:04:12.663 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 21:04:12.668 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 89.7250ms
2025-08-31 21:04:13.413 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:04:13.414 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 21:04:14.386 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 21:04:14.386 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 21:04:14.394 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 21:04:14.439 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 21:04:14.446 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 21:04:14.689 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:04:16.303 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 6388.9070ms
2025-08-31 21:04:16.505 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:04:16.505 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 21:04:19.498 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 21:04:19.503 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 21:04:19.506 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 21:04:20.500 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 21:04:20.506 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 21:04:20.596 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:04:20.915 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 6477.6820ms
2025-08-31 21:04:21.586 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:04:21.589 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 21:04:22.255 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 21:04:22.257 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 21:04:22.260 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 21:04:22.547 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 21:04:22.615 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 21:04:26.998 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:04:28.487 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 7983.8390ms
2025-08-31 21:04:31.734 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:04:31.738 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 21:04:31.856 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 21:04:31.857 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 21:04:31.858 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 21:04:31.898 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 21:04:31.906 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 21:04:31.960 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:04:32.091 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 9543.7350ms
2025-08-31 21:04:32.231 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:04:32.231 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 21:04:34.218 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 21:04:34.247 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 21:04:34.545 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 21:04:34.545 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 21:04:34.545 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 21:04:35.010 -03:00 [INF] 📄 Busca por ID do ChatLog: Não encontrado
2025-08-31 21:04:39.716 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 7812.0080ms
2025-08-31 21:04:46.058 -03:00 [INF] 📄 Busca por ChatId: Encontrado
2025-08-31 21:04:46.060 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 21:04:46.172 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 21:04:46.172 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 21:04:46.172 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 21:04:46.185 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 11966.6290ms
2025-08-31 21:09:51.766 -03:00 [INF] Request finished GET /whatsappHub - 101 in 8404063.5040ms
2025-08-31 21:09:51.815 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:09:51.815 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:09:51.815 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:09:51.865 -03:00 [INF] Request finished GET /api/health - 200 in 51.3550ms
2025-08-31 21:09:51.905 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:09:51.924 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 19.2320ms
2025-08-31 21:09:51.943 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:09:59.753 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 7938.4960ms
2025-08-31 21:10:08.181 -03:00 [INF] Request finished GET /api/chats - 200 in 16366.9310ms
2025-08-31 21:13:44.489 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:13:44.489 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:13:44.489 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:13:44.578 -03:00 [INF] Request finished GET /api/health - 200 in 90.8640ms
2025-08-31 21:13:44.591 -03:00 [INF] Request finished GET /whatsappHub - 101 in 232648.5280ms
2025-08-31 21:13:44.688 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:13:44.760 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 72.4180ms
2025-08-31 21:13:44.778 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:13:48.869 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 4381.6480ms
2025-08-31 21:14:00.401 -03:00 [INF] Request finished GET /api/chats - 200 in 15916.5680ms
2025-08-31 21:15:05.242 -03:00 [INF] Request finished GET /whatsappHub - 101 in 9722697.6010ms
2025-08-31 21:15:05.242 -03:00 [INF] Request finished GET /whatsappHub - 101 in 9722683.7050ms
2025-08-31 21:15:05.242 -03:00 [INF] Request finished GET /whatsappHub - 101 in 80464.2590ms
2025-08-31 21:15:05.248 -03:00 [INF] Request finished GET /whatsappHub - 101 in 9722725.7490ms
2025-08-31 21:15:05.314 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:15:05.314 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:15:05.314 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:15:05.314 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:15:05.335 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 21.1960ms
2025-08-31 21:15:05.336 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 21.9590ms
2025-08-31 21:15:05.336 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 22.3090ms
2025-08-31 21:15:05.336 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 22.0660ms
2025-08-31 21:15:05.742 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:15:05.770 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:15:05.784 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:15:05.801 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:15:06.271 -03:00 [INF] Request finished GET /whatsappHub - 101 in 487.0870ms
2025-08-31 21:15:06.271 -03:00 [INF] Request finished GET /whatsappHub - 101 in 529.1850ms
2025-08-31 21:15:06.271 -03:00 [INF] Request finished GET /whatsappHub - 101 in 501.6500ms
2025-08-31 21:15:06.271 -03:00 [INF] Request finished GET /whatsappHub - 101 in 469.9110ms
2025-08-31 21:15:42.626 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:15:42.728 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:15:42.626 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:15:42.626 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:15:42.626 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 21:15:42.728 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:15:43.149 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 417.9290ms
2025-08-31 21:15:43.148 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 417.9890ms
2025-08-31 21:15:45.332 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:15:45.332 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:15:43.283 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:15:43.322 -03:00 [INF] Request finished GET /api/health - 200 in 695.7230ms
2025-08-31 21:15:45.357 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 24.3020ms
2025-08-31 21:15:45.501 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:15:45.509 -03:00 [INF] Request finished GET /api/health - 200 in 7.3380ms
2025-08-31 21:15:45.520 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:15:45.526 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:15:45.527 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.4710ms
2025-08-31 21:15:45.540 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:15:47.145 -03:00 [WRN] As of ""2025-09-01T00:15:41.1488740+00:00"", the heartbeat has been running for ""00:00:02.3227465"" which is longer than ""00:00:01"". This could be caused by thread pool starvation.
2025-08-31 21:15:47.843 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 5217.1690ms
2025-08-31 21:15:47.865 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 21:15:52.006 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 4138.2600ms
2025-08-31 21:15:52.006 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 9377.3660ms
2025-08-31 21:15:52.064 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:15:52.432 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 368.1180ms
2025-08-31 21:15:52.444 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:15:52.493 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 49.3690ms
2025-08-31 21:15:52.502 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:15:52.551 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 48.5580ms
2025-08-31 21:15:52.553 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:15:52.589 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 36.1720ms
2025-08-31 21:15:52.594 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:15:52.603 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 8.7450ms
2025-08-31 21:16:04.882 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:16:21.043 -03:00 [INF] Request finished GET /api/chats - 200 in 38416.6510ms
2025-08-31 21:16:22.316 -03:00 [INF] Request finished GET /api/chats - 200 in 17434.4840ms
2025-08-31 21:44:38.656 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 21:44:40.848 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2193.6910ms
2025-08-31 21:45:00.186 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1754666.2010ms
2025-08-31 21:45:00.168 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1756885.3080ms
2025-08-31 21:45:00.192 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1754652.4650ms
2025-08-31 21:45:00.185 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1754840.1330ms
2025-08-31 21:45:03.211 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:45:03.211 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:45:03.212 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:45:03.214 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 21:45:03.228 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:45:03.229 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:45:03.249 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 20.1520ms
2025-08-31 21:45:03.251 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 23.4920ms
2025-08-31 21:45:03.254 -03:00 [INF] Request finished GET /api/health - 200 in 42.9930ms
2025-08-31 21:45:03.262 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:45:03.271 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:45:03.274 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:45:03.275 -03:00 [INF] Request finished GET /api/health - 200 in 3.5130ms
2025-08-31 21:45:03.276 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 2.3270ms
2025-08-31 21:45:03.281 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:45:03.285 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 4.1810ms
2025-08-31 21:45:03.299 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:45:03.318 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:45:03.339 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:45:05.357 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2142.1440ms
2025-08-31 21:45:05.369 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 21:45:06.916 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3703.1310ms
2025-08-31 21:45:07.241 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:45:07.350 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 109.3580ms
2025-08-31 21:45:07.386 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2016.9550ms
2025-08-31 21:45:08.172 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:45:08.172 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 21:45:08.236 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 63.2850ms
2025-08-31 21:45:09.575 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:45:09.724 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 148.9550ms
2025-08-31 21:45:09.737 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:45:09.773 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:45:09.781 -03:00 [INF] Request finished GET /api/health - 200 in 7.9810ms
2025-08-31 21:45:09.804 -03:00 [INF] Request finished GET /whatsappHub - 101 in 6464.5200ms
2025-08-31 21:45:09.817 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 80.1940ms
2025-08-31 21:45:09.824 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:45:09.847 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 23.5380ms
2025-08-31 21:45:10.130 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:45:10.254 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2083.8960ms
2025-08-31 21:45:10.472 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:45:10.476 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 21:45:10.493 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 362.7900ms
2025-08-31 21:45:10.495 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 22.8170ms
2025-08-31 21:45:10.630 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:45:12.489 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2012.3450ms
2025-08-31 21:45:24.893 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:45:25.617 -03:00 [INF] Request finished GET /api/chats - 200 in 22406.5880ms
2025-08-31 21:45:29.474 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:45:30.689 -03:00 [INF] Request finished GET /api/chats - 200 in 5795.6420ms
2025-08-31 21:45:33.572 -03:00 [INF] Request finished GET /api/chats - 200 in 4098.3170ms
2025-08-31 21:45:51.158 -03:00 [INF] Request finished GET /whatsappHub - 101 in 40522.1940ms
2025-08-31 21:45:51.158 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:45:51.158 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:45:51.158 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:45:51.202 -03:00 [INF] Request finished GET /api/health - 200 in 43.7860ms
2025-08-31 21:45:51.240 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:45:51.252 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 11.8710ms
2025-08-31 21:45:51.261 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:45:51.647 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 488.9660ms
2025-08-31 21:45:58.144 -03:00 [INF] Request finished GET /api/chats - 200 in 6985.7990ms
2025-08-31 21:47:37.492 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988770987@c.us -> 5511949907658
2025-08-31 21:47:41.119 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988770987
2025-08-31 21:47:41.371 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988770987: "b2e20bff-829c-4ddd-bc69-e3b6c20271dd" (criado em "2025-08-31T18:10:13.0000000")
2025-08-31 21:47:41.416 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "b2e20bff-829c-4ddd-bc69-e3b6c20271dd" para 5511988770987
2025-08-31 21:47:41.417 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 837147 chars)
2025-08-31 21:47:41.450 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 21:47:41.451 -03:00 [INF] 📊 PayloadJson carregado: 1 mensagens existentes
2025-08-31 21:47:41.451 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756687630379.mp3
2025-08-31 21:47:41.494 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 21:47:41.494 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 21:47:41.495 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 21:47:41.514 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756687630379.mp3, MimeType=audio/mpeg
2025-08-31 21:47:41.514 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 21:47:41.514 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 92fb95f2-df75-4923-bfe5-cfec3327c5d7
2025-08-31 21:47:41.514 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: 92fb95f2-df75-4923-bfe5-cfec3327c5d7 (Total: 2 mensagens)
2025-08-31 21:47:41.666 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 837147 chars, depois: 1674191 chars)
2025-08-31 21:47:43.229 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "b2e20bff-829c-4ddd-bc69-e3b6c20271dd" - 2 mensagens no PayloadJson
2025-08-31 21:47:43.230 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="c0d2c101-08c6-43c3-9841-5000676323b4", ChatLogId="b2e20bff-829c-4ddd-bc69-e3b6c20271dd"
2025-08-31 21:47:43.236 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "b2e20bff-829c-4ddd-bc69-e3b6c20271dd"
2025-08-31 21:47:43.417 -03:00 [INF] 🎫 AttendanceTicket criado: "3a9a5026-7522-4da6-8460-3ecd15184b3c"
2025-08-31 21:47:43.429 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 21:47:43.488 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756687630379.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 21:47:44.668 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 21:48:03.111 -03:00 [INF] Request finished GET /whatsappHub - 101 in 131847.1570ms
2025-08-31 21:48:03.138 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 21:48:03.138 -03:00 [INF] Request starting GET /api/chats
2025-08-31 21:48:03.138 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:48:03.149 -03:00 [INF] Request finished GET /api/health - 200 in 11.1250ms
2025-08-31 21:48:03.185 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:48:03.193 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.9450ms
2025-08-31 21:48:03.220 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:48:03.436 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 298.7960ms
2025-08-31 21:48:06.167 -03:00 [INF] Request finished GET /api/chats - 200 in 3028.7610ms
2025-08-31 21:48:06.897 -03:00 [INF] Request finished GET /whatsappHub - 101 in 3676.5480ms
2025-08-31 21:48:06.911 -03:00 [INF] Request starting GET /api/health
2025-08-31 21:48:06.914 -03:00 [INF] Request finished GET /api/health - 200 in 2.6490ms
2025-08-31 21:48:06.933 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:48:06.937 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 4.1730ms
2025-08-31 21:48:06.949 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:50:54.398 -03:00 [INF] Aplicação está sendo finalizada...
2025-08-31 21:50:54.510 -03:00 [INF] Request finished GET /whatsappHub - 101 in 351192.1280ms
2025-08-31 21:50:54.509 -03:00 [INF] Request finished GET /whatsappHub - 101 in 351210.1270ms
2025-08-31 21:50:54.509 -03:00 [INF] Request finished GET /whatsappHub - 101 in 351247.6160ms
2025-08-31 21:50:54.514 -03:00 [INF] Request finished GET /whatsappHub - 101 in 167564.1820ms
2025-08-31 21:50:54.634 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:50:54.635 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:50:54.635 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:50:54.635 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 21:50:54.642 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.1640ms
2025-08-31 21:50:54.642 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.0410ms
2025-08-31 21:50:54.643 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 7.9760ms
2025-08-31 21:50:54.643 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 8.2540ms
2025-08-31 21:50:54.671 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:50:54.687 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 21:51:25.996 -03:00 [INF] Request finished GET /whatsappHub - 101 in 31325.6730ms
2025-08-31 21:51:25.996 -03:00 [INF] Request finished GET /whatsappHub - 101 in 31306.4960ms
2025-08-31 21:51:26.058 -03:00 [INF] Desconectando do RabbitMQ...
2025-08-31 21:51:26.437 -03:00 [INF] Processamento de batch cancelado graciosamente
2025-08-31 21:51:26.437 -03:00 [INF] RabbitMQ Background Service cancelado graciosamente
2025-08-31 21:51:26.437 -03:00 [INF] Processamento de batch finalizado
2025-08-31 21:51:26.437 -03:00 [INF] RabbitMQ Background Service finalizado
2025-08-31 21:51:26.437 -03:00 [INF] Processamento de batch cancelado graciosamente
2025-08-31 21:51:26.437 -03:00 [INF] Processamento de batch finalizado
2025-08-31 21:51:26.442 -03:00 [INF] Aplicação foi finalizada
2025-08-31 21:52:40.484 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 21:52:40.752 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 21:52:40.753 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 21:52:42.957 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 21:52:44.284 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 21:52:44.477 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 21:52:44.856 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 21:52:46.935 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 21:52:46.982 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988770987@c.us -> 5511949907658
2025-08-31 21:52:47.124 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 21:52:47.124 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 21:52:47.129 -03:00 [INF] Processamento de batch iniciado
2025-08-31 21:52:49.440 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988770987
2025-08-31 21:52:49.579 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988770987: "b2e20bff-829c-4ddd-bc69-e3b6c20271dd" (criado em "2025-08-31T21:47:10.0000000")
2025-08-31 21:52:49.598 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "b2e20bff-829c-4ddd-bc69-e3b6c20271dd" para 5511988770987
2025-08-31 21:52:49.599 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 1674191 chars)
2025-08-31 21:52:49.627 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 21:52:49.627 -03:00 [INF] 📊 PayloadJson carregado: 2 mensagens existentes
2025-08-31 21:52:49.629 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756687630379.mp3
2025-08-31 21:52:49.632 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/77c7007e-7152-411f-b7f8-d533d92152ce.mp3
2025-08-31 21:52:49.632 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/77c7007e-7152-411f-b7f8-d533d92152ce.mp3
2025-08-31 21:52:49.633 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 21:52:49.635 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756687630379.mp3, MimeType=audio/mpeg
2025-08-31 21:52:49.635 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/77c7007e-7152-411f-b7f8-d533d92152ce.mp3
2025-08-31 21:52:49.636 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 92fb95f2-df75-4923-bfe5-cfec3327c5d7
2025-08-31 21:52:49.636 -03:00 [WRN] ⚠️ Mensagem DUPLICADA detectada, ignorando: 92fb95f2-df75-4923-bfe5-cfec3327c5d7
2025-08-31 21:52:49.652 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 21:52:49.716 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756687630379.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 21:52:52.019 -03:00 [ERR] Failed executing DbCommand (375ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:52:52.071 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:52:52.085 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:52:52.092 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:52:57.204 -03:00 [ERR] Failed executing DbCommand (67ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:52:57.227 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:52:57.233 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:52:57.238 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:02.346 -03:00 [ERR] Failed executing DbCommand (59ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:02.396 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:02.403 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:02.417 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:07.543 -03:00 [ERR] Failed executing DbCommand (69ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:07.560 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:07.565 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:07.573 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:12.757 -03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:12.778 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:12.783 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:12.787 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:17.864 -03:00 [ERR] Failed executing DbCommand (35ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:17.898 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:17.905 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:17.917 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:23.553 -03:00 [ERR] Failed executing DbCommand (159ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:23.584 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:23.591 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:23.601 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:28.860 -03:00 [ERR] Failed executing DbCommand (113ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:28.892 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:28.909 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:28.914 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:35.943 -03:00 [ERR] Failed executing DbCommand (53ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:35.978 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:35.994 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:36.006 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:41.155 -03:00 [ERR] Failed executing DbCommand (84ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:41.211 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:41.227 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:41.256 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:46.366 -03:00 [ERR] Failed executing DbCommand (46ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:46.380 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:46.389 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:46.396 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:52.682 -03:00 [ERR] Failed executing DbCommand (729ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:52.932 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:53.015 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:53.033 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:53:58.327 -03:00 [ERR] Failed executing DbCommand (42ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:53:58.710 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:53:58.946 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:53:59.431 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:04.962 -03:00 [ERR] Failed executing DbCommand (63ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:04.991 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:05.043 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:05.056 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:11.088 -03:00 [ERR] Failed executing DbCommand (41ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:11.102 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:11.109 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:11.117 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:16.211 -03:00 [ERR] Failed executing DbCommand (44ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:16.225 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:16.232 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:16.243 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:21.339 -03:00 [ERR] Failed executing DbCommand (52ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:21.392 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:21.438 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:21.448 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:26.568 -03:00 [ERR] Failed executing DbCommand (58ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:26.591 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:26.602 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:26.609 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:32.022 -03:00 [ERR] Failed executing DbCommand (297ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:32.028 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:32.075 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:32.080 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:37.202 -03:00 [ERR] Failed executing DbCommand (55ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:37.238 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:37.274 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:37.279 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:42.635 -03:00 [ERR] Failed executing DbCommand (71ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:42.676 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:42.700 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:42.719 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:47.960 -03:00 [ERR] Failed executing DbCommand (55ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:48.494 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:48.502 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:48.515 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:54:53.600 -03:00 [ERR] Failed executing DbCommand (52ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:54:53.617 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:54:53.622 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:54:53.629 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:00.070 -03:00 [ERR] Failed executing DbCommand (1,375ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:00.397 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:00.664 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:00.690 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:06.023 -03:00 [ERR] Failed executing DbCommand (43ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:06.052 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:06.075 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:06.084 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:11.323 -03:00 [ERR] Failed executing DbCommand (207ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:11.516 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:11.532 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:11.538 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:18.345 -03:00 [ERR] Failed executing DbCommand (1,445ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:19.388 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:19.399 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:19.411 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:25.843 -03:00 [ERR] Failed executing DbCommand (1,289ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:26.390 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:26.405 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:26.417 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:32.698 -03:00 [ERR] Failed executing DbCommand (796ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:32.943 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:32.961 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:32.978 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:39.379 -03:00 [ERR] Failed executing DbCommand (388ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:39.675 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:39.691 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:39.714 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:46.112 -03:00 [ERR] Failed executing DbCommand (1,074ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:46.392 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:46.414 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:46.432 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:55:55.021 -03:00 [ERR] Failed executing DbCommand (393ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:55:55.640 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:55:55.648 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:55:55.675 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:00.968 -03:00 [ERR] Failed executing DbCommand (152ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:00.995 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:01.000 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:01.018 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:07.103 -03:00 [ERR] Failed executing DbCommand (372ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:07.147 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:07.156 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:07.160 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:12.304 -03:00 [ERR] Failed executing DbCommand (70ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:12.324 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:12.332 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:12.344 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:17.421 -03:00 [ERR] Failed executing DbCommand (47ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:17.439 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:17.447 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:17.453 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:22.532 -03:00 [ERR] Failed executing DbCommand (47ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:22.550 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:22.562 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:22.568 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:29.508 -03:00 [ERR] Failed executing DbCommand (784ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:30.412 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:30.660 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:30.676 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:35.750 -03:00 [ERR] Failed executing DbCommand (47ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:35.763 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:35.771 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:35.777 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:41.210 -03:00 [ERR] Failed executing DbCommand (108ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:41.309 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:41.345 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:41.362 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:48.846 -03:00 [ERR] Failed executing DbCommand (91ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:48.878 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:48.888 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:48.907 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:56:53.976 -03:00 [ERR] Failed executing DbCommand (45ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:56:53.994 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:56:53.998 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:56:54.011 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:00.297 -03:00 [ERR] Failed executing DbCommand (606ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:00.462 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:00.475 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:00.499 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:05.645 -03:00 [ERR] Failed executing DbCommand (89ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:05.668 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:05.675 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:05.678 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:10.824 -03:00 [ERR] Failed executing DbCommand (88ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:10.848 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:10.852 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:10.861 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:16.158 -03:00 [ERR] Failed executing DbCommand (86ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:16.198 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:16.226 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:16.248 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:21.887 -03:00 [ERR] Failed executing DbCommand (609ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:21.902 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:21.908 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:21.921 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:27.501 -03:00 [ERR] Failed executing DbCommand (56ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:27.558 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:27.573 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:27.578 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:34.081 -03:00 [ERR] Failed executing DbCommand (1,119ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:34.128 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:34.141 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:34.147 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:39.449 -03:00 [ERR] Failed executing DbCommand (189ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:39.493 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:39.503 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:39.508 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:44.656 -03:00 [ERR] Failed executing DbCommand (75ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:45.053 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:45.067 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:45.076 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:50.529 -03:00 [ERR] Failed executing DbCommand (227ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:50.643 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:50.689 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:50.707 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:57:55.882 -03:00 [ERR] Failed executing DbCommand (88ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:57:55.983 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:57:56.005 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:57:56.017 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:58:03.579 -03:00 [ERR] Failed executing DbCommand (780ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:58:03.740 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:58:03.746 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:58:03.753 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:58:10.188 -03:00 [ERR] Failed executing DbCommand (1,053ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:58:10.328 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:58:10.333 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:58:10.338 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:58:15.843 -03:00 [ERR] Failed executing DbCommand (476ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:58:16.016 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:58:16.021 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:58:16.025 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:58:21.161 -03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (Size = 4000), @p2='?' (Size = 100), @p3='?' (Size = 255), @p4='?' (Size = 200), @p5='?' (Size = 50), @p6='?' (DbType = Guid), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 255), @p11='?' (Size = 255), @p12='?' (DbType = Boolean), @p13='?' (Size = 50), @p14='?' (Size = 100), @p15='?' (Size = 1000), @p16='?' (DbType = Boolean), @p17='?' (DbType = Decimal), @p18='?' (Size = 500), @p19='?' (DbType = Decimal), @p20='?' (Size = 1000), @p21='?' (Size = 4000), @p22='?' (Size = 100), @p23='?' (Size = -1), @p24='?' (Size = 100), @p25='?' (DbType = Guid), @p26='?' (DbType = Int64), @p27='?' (DbType = Int32), @p28='?' (Size = 4000), @p29='?' (Size = 1000), @p30='?' (DbType = Int32), @p31='?' (Size = 500)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`Id`, `Body`, `ChatId`, `ClientMessageId`, `ContactName`, `ContactPhone`, `ConversationId`, `CreatedAt`, `Direction`, `Duration`, `ExternalMessageId`, `FileName`, `FromMe`, `FromNormalized`, `FromOriginal`, `InternalNote`, `IsGroup`, `Latitude`, `LocationAddress`, `Longitude`, `MediaUrl`, `Metadata`, `MimeType`, `PayloadJson`, `SenderId`, `SessionId`, `Size`, `Status`, `Text`, `Thumbnail`, `Type`, `WhatsAppMessageId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
SELECT `UpdatedAt`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = @p0;
2025-08-31 21:58:21.192 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'Pregiato.Infrastructure.Data.PregiatoDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 21:58:21.196 -03:00 [ERR] ❌ Erro ao salvar mensagens em batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
2025-08-31 21:58:21.207 -03:00 [ERR] ❌ Erro no processamento de batch
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry 'c0d2c101-08c6-43c3-9841-5000676323b4-92fb95f2-df75-4923-bfe5-cfe' for key 'messages.IX_Messages_Unique_External'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1061
--- End of stack trace from previous location ---
   at Pregiato.API.Services.RabbitBackgroundService.<>c__DisplayClass49_2.<<ProcessMessageBatchAsync>b__0>d.MoveNext() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1076
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.ExecutionStrategyExtensions.<>c.<<ExecuteAsync>b__3_0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Pregiato.API.Services.RabbitBackgroundService.ProcessMessageBatchAsync(CancellationToken stoppingToken) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 1055
2025-08-31 21:58:22.763 -03:00 [INF] Aplicação está sendo finalizada...
2025-08-31 21:58:22.982 -03:00 [INF] Desconectando do RabbitMQ...
2025-08-31 21:58:23.538 -03:00 [INF] RabbitMQ Background Service cancelado graciosamente
2025-08-31 21:58:23.538 -03:00 [INF] RabbitMQ Background Service finalizado
2025-08-31 21:58:23.546 -03:00 [INF] Aplicação foi finalizada
2025-08-31 22:02:46.037 -03:00 [INF] Iniciando Pregiato API...
2025-08-31 22:02:46.508 -03:00 [INF] RabbitMQ Background Service iniciado
2025-08-31 22:02:46.510 -03:00 [INF] Tentando conectar ao RabbitMQ...
2025-08-31 22:02:48.994 -03:00 [INF] ✅ Conexão RabbitMQ estabelecida com amqps://mouse.rmq5.cloudamqp.com:5671
2025-08-31 22:02:50.418 -03:00 [INF] 📋 Filas RabbitMQ configuradas
2025-08-31 22:02:50.653 -03:00 [INF] 🎧 Consumidor de QR codes configurado
2025-08-31 22:02:50.844 -03:00 [INF] 🎧 Consumidor de mensagens WhatsApp configurado
2025-08-31 22:02:51.026 -03:00 [INF] 🎧 Consumidor de status da sessão configurado
2025-08-31 22:02:51.206 -03:00 [INF] 🎧 Consumidor de status de mensagens configurado
2025-08-31 22:02:51.208 -03:00 [INF] ✅ RabbitMQ conectado e configurado
2025-08-31 22:02:51.243 -03:00 [INF] Processamento de batch iniciado
2025-08-31 22:07:29.922 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:07:29.922 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 22:07:29.922 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:07:29.922 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:07:29.922 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:07:29.922 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:07:29.982 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 62.0780ms
2025-08-31 22:07:29.994 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:07:29.982 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 61.9330ms
2025-08-31 22:07:30.067 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:07:30.148 -03:00 [INF] Request finished GET /api/health - 200 in 229.2910ms
2025-08-31 22:07:30.162 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:07:30.166 -03:00 [INF] Request finished GET /api/health - 200 in 3.7110ms
2025-08-31 22:07:30.167 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:07:30.180 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:07:30.176 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 8.8570ms
2025-08-31 22:07:30.182 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.8220ms
2025-08-31 22:07:30.182 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:07:30.199 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:07:34.828 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 4908.6280ms
2025-08-31 22:07:34.864 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 22:07:36.881 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2017.2430ms
2025-08-31 22:07:37.272 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 7352.5780ms
2025-08-31 22:07:37.300 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:07:37.506 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 205.5670ms
2025-08-31 22:07:37.521 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:07:37.571 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 50.2450ms
2025-08-31 22:07:37.591 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:07:37.619 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 28.0020ms
2025-08-31 22:07:37.625 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:07:37.636 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 11.0380ms
2025-08-31 22:07:37.642 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:07:37.652 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 9.9370ms
2025-08-31 22:07:44.035 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:07:44.650 -03:00 [INF] Request finished GET /api/chats - 200 in 14730.8780ms
2025-08-31 22:07:45.330 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:07:45.331 -03:00 [INF] Request finished GET /api/health - 200 in 1.2480ms
2025-08-31 22:07:45.336 -03:00 [INF] Request finished GET /whatsappHub - 101 in 15136.3540ms
2025-08-31 22:07:45.349 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:07:45.350 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.2400ms
2025-08-31 22:07:45.356 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:07:45.458 -03:00 [INF] Request finished GET /api/chats - 200 in 1423.0570ms
2025-08-31 22:07:46.060 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:07:46.060 -03:00 [INF] Request finished GET /api/health - 200 in 0.5120ms
2025-08-31 22:07:46.066 -03:00 [INF] Request finished GET /whatsappHub - 101 in 709.9470ms
2025-08-31 22:07:46.068 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:07:46.069 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.7510ms
2025-08-31 22:07:46.082 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:11:36.118 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988770987@c.us -> 5511949907658
2025-08-31 22:11:37.397 -03:00 [INF] Request finished GET /whatsappHub - 101 in 231303.2490ms
2025-08-31 22:11:38.228 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:11:38.482 -03:00 [INF] Request finished GET /api/health - 200 in 235.8450ms
2025-08-31 22:11:41.538 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 22:11:41.735 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:11:43.891 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 2143.8000ms
2025-08-31 22:11:43.971 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:11:44.911 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988770987
2025-08-31 22:11:45.057 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 22:11:45.547 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:11:45.603 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:11:45.603 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988770987: "b2e20bff-829c-4ddd-bc69-e3b6c20271dd" (criado em "2025-08-31T21:47:10.0000000")
2025-08-31 22:11:45.604 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 22:11:45.651 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "b2e20bff-829c-4ddd-bc69-e3b6c20271dd" para 5511988770987
2025-08-31 22:11:45.652 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 1674191 chars)
2025-08-31 22:11:45.679 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 22:11:45.679 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 22:11:45.680 -03:00 [INF] 📊 PayloadJson carregado: 2 mensagens existentes
2025-08-31 22:11:45.680 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 22:11:45.680 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 22:11:45.682 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756689069372.mp3
2025-08-31 22:11:45.687 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 22:11:45.688 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 22:11:45.690 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:11:45.690 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:11:45.692 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 22:11:45.693 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756689069372.mp3, MimeType=audio/mpeg
2025-08-31 22:11:45.693 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:11:45.694 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 10986325-2078-4173-ab68-2209c27b4310
2025-08-31 22:11:45.694 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: 10986325-2078-4173-ab68-2209c27b4310 (Total: 3 mensagens)
2025-08-31 22:11:45.722 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 1674191 chars, depois: 2344854 chars)
2025-08-31 22:11:45.734 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 22:11:45.736 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 22:11:45.756 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 4218.5390ms
2025-08-31 22:11:45.767 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:11:45.788 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:11:45.788 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 22:11:45.804 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 22:11:45.805 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 22:11:45.806 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 22:11:45.807 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 22:11:45.808 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 22:11:45.840 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 106.0320ms
2025-08-31 22:11:48.557 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "b2e20bff-829c-4ddd-bc69-e3b6c20271dd" - 3 mensagens no PayloadJson
2025-08-31 22:11:48.565 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="c0d2c101-08c6-43c3-9841-5000676323b4", ChatLogId="b2e20bff-829c-4ddd-bc69-e3b6c20271dd"
2025-08-31 22:11:48.588 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "b2e20bff-829c-4ddd-bc69-e3b6c20271dd"
2025-08-31 22:11:48.742 -03:00 [INF] Request finished GET /whatsappHub - 101 in 4771.3050ms
2025-08-31 22:11:48.746 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:11:48.751 -03:00 [INF] Request finished GET /api/health - 200 in 5.6170ms
2025-08-31 22:11:48.755 -03:00 [INF] 🎫 AttendanceTicket criado: "3a9a5026-7522-4da6-8460-3ecd15184b3c"
2025-08-31 22:11:48.773 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 22:11:48.872 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756689069372.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 22:11:49.039 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:11:49.201 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 161.4930ms
2025-08-31 22:11:49.240 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:11:50.206 -03:00 [INF] Request starting GET /api/chats/b2e20bff-829c-4ddd-bc69-e3b6c20271dd/messages
2025-08-31 22:11:50.230 -03:00 [INF] 🔍 Buscando mensagens para ID: b2e20bff-829c-4ddd-bc69-e3b6c20271dd
2025-08-31 22:11:50.306 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Encontrado
2025-08-31 22:11:50.307 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 22:11:50.323 -03:00 [INF] PayloadJson no formato NOVO detectado: 3 mensagens
2025-08-31 22:11:50.328 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 3
2025-08-31 22:11:50.332 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 22:11:50.341 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 22:11:50.342 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:11:50.342 -03:00 [INF] ✅ Retornando 3 mensagens convertidas
2025-08-31 22:11:50.403 -03:00 [INF] Request starting GET /api/chats/b2e20bff-829c-4ddd-bc69-e3b6c20271dd/messages
2025-08-31 22:11:50.410 -03:00 [INF] 🔍 Buscando mensagens para ID: b2e20bff-829c-4ddd-bc69-e3b6c20271dd
2025-08-31 22:11:50.939 -03:00 [INF] Request finished GET /api/chats/b2e20bff-829c-4ddd-bc69-e3b6c20271dd/messages - 200 in 732.8040ms
2025-08-31 22:11:51.051 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Encontrado
2025-08-31 22:11:51.053 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 22:11:51.136 -03:00 [INF] PayloadJson no formato NOVO detectado: 3 mensagens
2025-08-31 22:11:51.136 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 3
2025-08-31 22:11:51.138 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 22:11:51.140 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 22:11:51.140 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:11:51.154 -03:00 [INF] ✅ Retornando 3 mensagens convertidas
2025-08-31 22:11:51.272 -03:00 [INF] Request finished GET /api/chats/b2e20bff-829c-4ddd-bc69-e3b6c20271dd/messages - 200 in 869.0660ms
2025-08-31 22:11:53.370 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 22:11:55.733 -03:00 [INF] Request finished GET /whatsappHub - 101 in 265739.2400ms
2025-08-31 22:11:55.737 -03:00 [INF] Request finished GET /whatsappHub - 101 in 265670.4470ms
2025-08-31 22:11:55.737 -03:00 [INF] Request finished GET /whatsappHub - 101 in 6497.5400ms
2025-08-31 22:11:55.738 -03:00 [INF] Request finished GET /whatsappHub - 101 in 265555.8250ms
2025-08-31 22:11:58.277 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:11:58.277 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:11:58.277 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:11:58.277 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 22:11:58.289 -03:00 [INF] Request finished GET /api/health - 200 in 12.1440ms
2025-08-31 22:11:58.294 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:11:58.294 -03:00 [INF] Request finished GET /api/health - 200 in 0.7070ms
2025-08-31 22:11:58.365 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:11:58.378 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:11:58.396 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 30.8590ms
2025-08-31 22:11:58.397 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 18.5280ms
2025-08-31 22:11:58.398 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:11:58.399 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.3910ms
2025-08-31 22:11:58.399 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:11:58.400 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.0990ms
2025-08-31 22:11:58.446 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:11:58.482 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:11:58.495 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:11:58.508 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:11:58.735 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 458.5270ms
2025-08-31 22:11:58.739 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:11:58.761 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 21.6240ms
2025-08-31 22:11:58.764 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:11:58.771 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 6.7570ms
2025-08-31 22:11:58.773 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:11:58.795 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 22.0830ms
2025-08-31 22:11:58.799 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:11:58.826 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 26.8780ms
2025-08-31 22:11:58.829 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:11:58.833 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 4.4340ms
2025-08-31 22:12:00.330 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2053.6690ms
2025-08-31 22:12:00.364 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 22:12:00.474 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:12:01.065 -03:00 [INF] Request finished GET /api/chats - 200 in 2787.7280ms
2025-08-31 22:12:02.076 -03:00 [INF] Request finished GET /whatsappHub - 101 in 3594.6320ms
2025-08-31 22:12:02.077 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:12:02.081 -03:00 [INF] Request finished GET /api/health - 200 in 4.2400ms
2025-08-31 22:12:02.100 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:12:02.100 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.7850ms
2025-08-31 22:12:02.107 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:12:02.299 -03:00 [INF] Request finished GET /api/chats - 200 in 1825.1330ms
2025-08-31 22:12:02.381 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2017.7150ms
2025-08-31 22:12:02.407 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:12:02.408 -03:00 [INF] Request finished GET /whatsappHub - 101 in 300.7900ms
2025-08-31 22:12:02.430 -03:00 [INF] Request finished GET /api/health - 200 in 22.9180ms
2025-08-31 22:12:02.443 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:12:02.444 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.3670ms
2025-08-31 22:12:02.446 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:12:06.059 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 22:12:06.292 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 22:12:06.581 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:12:09.235 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:12:09.267 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 22:12:09.339 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 22:12:09.372 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 22:12:09.435 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:12:09.523 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 22:12:09.524 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 22:12:09.524 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 22:12:09.526 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 22:12:09.526 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 22:12:09.526 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 22:12:09.526 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 22:12:09.527 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 22:12:09.527 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 22:12:09.528 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 22:12:09.528 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 22:12:09.529 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 22:12:09.543 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 22:12:09.543 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 22:12:09.546 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 22:12:09.546 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 22:12:09.546 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 22:12:09.547 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 22:12:09.547 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 22:12:09.547 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 22:12:09.547 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 22:12:09.548 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 22:12:09.550 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 22:12:09.550 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 22:12:09.577 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 22:12:09.578 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 22:12:09.578 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 22:12:09.580 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 22:12:09.580 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 22:12:09.580 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 22:12:09.580 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 22:12:09.581 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 22:12:09.587 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 22:12:09.588 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 22:12:09.608 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 22:12:09.615 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 22:12:09.672 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:12:09.721 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:12:09.721 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 22:12:09.722 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 22:12:09.722 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 22:12:09.722 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 22:12:09.727 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 388.5450ms
2025-08-31 22:12:09.731 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 22:12:09.732 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 22:12:09.740 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:12:09.744 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:12:09.744 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 22:12:09.744 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 22:12:09.744 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 22:12:09.745 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 22:12:09.745 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 14.7380ms
2025-08-31 22:12:10.415 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 22:12:10.548 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 22:12:10.569 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:12:10.583 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:12:10.583 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 22:12:10.585 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 22:12:10.585 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 22:12:10.586 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 22:12:10.589 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 173.7570ms
2025-08-31 22:12:10.592 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 22:12:10.593 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 22:12:10.604 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:12:10.612 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:12:10.614 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 22:12:10.615 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 22:12:10.615 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 22:12:10.615 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 22:12:10.616 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 23.9290ms
2025-08-31 22:12:10.790 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 4734.2390ms
2025-08-31 22:12:12.052 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:12:12.053 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 22:12:12.417 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 22:12:12.418 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 22:12:12.418 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 22:12:12.418 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 22:12:12.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 22:12:12.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 22:12:12.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 22:12:12.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 22:12:12.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 22:12:12.420 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 22:12:12.420 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 22:12:12.420 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 22:12:12.420 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 22:12:12.420 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 22:12:12.421 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 22:12:12.421 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 22:12:12.421 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 22:12:12.422 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 22:12:12.422 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 22:12:12.422 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 22:12:12.423 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 22:12:12.424 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 22:12:12.424 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 22:12:12.432 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 22:12:12.432 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 22:12:12.440 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 22:12:12.441 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 22:12:12.444 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 22:12:12.444 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 22:12:12.445 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 22:12:12.445 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 22:12:12.445 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 22:12:12.445 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 22:12:12.446 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 22:12:12.806 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 3197.4110ms
2025-08-31 22:12:13.589 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 22:12:13.613 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 22:12:13.624 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:12:13.651 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:12:13.652 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 22:12:13.670 -03:00 [INF] PayloadJson no formato NOVO detectado: 3 mensagens
2025-08-31 22:12:13.671 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 3
2025-08-31 22:12:13.671 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 22:12:13.671 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 22:12:13.676 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:12:13.676 -03:00 [INF] ✅ Retornando 3 mensagens convertidas
2025-08-31 22:12:13.692 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 22:12:13.695 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 22:12:13.700 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:12:13.727 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:12:13.727 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 22:12:13.737 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 147.9390ms
2025-08-31 22:12:13.754 -03:00 [INF] PayloadJson no formato NOVO detectado: 3 mensagens
2025-08-31 22:12:13.754 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 3
2025-08-31 22:12:13.754 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 22:12:13.754 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 22:12:13.754 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:12:13.755 -03:00 [INF] ✅ Retornando 3 mensagens convertidas
2025-08-31 22:12:13.781 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 88.7070ms
2025-08-31 22:13:53.385 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988770944@c.us -> 5511949907658
2025-08-31 22:13:53.740 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:13:53.764 -03:00 [INF] Request finished GET /api/health - 200 in 23.5300ms
2025-08-31 22:13:53.796 -03:00 [INF] Request finished GET /whatsappHub - 101 in 111350.5540ms
2025-08-31 22:13:54.202 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:13:54.247 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 44.6660ms
2025-08-31 22:13:54.283 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:13:56.220 -03:00 [INF] 📞 ✅ Nova conversa WhatsApp criada para 5511988770944: "fd199c42-a5a8-4e6e-9189-dbd7ab7074e6"
2025-08-31 22:13:56.225 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988770944
2025-08-31 22:13:56.250 -03:00 [INF] ❌ ChatLog NÃO ENCONTRADO para 5511988770944. Verificando por ChatId da conversa...
2025-08-31 22:13:58.365 -03:00 [INF] ❌ Nenhum ChatLog encontrado. Será criado novo ChatLog para 5511988770944
2025-08-31 22:13:58.441 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756689206034.mp3
2025-08-31 22:13:58.457 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:13:58.457 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:13:58.457 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 22:13:58.458 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756689206034.mp3, MimeType=audio/mpeg
2025-08-31 22:13:58.458 -03:00 [INF] 💾 MessageInfo criado para PayloadJson: Type=audio, Body_Length=390507, MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:13:59.470 -03:00 [INF] 📝 ✅ NOVO ChatLog criado para 5511988770944@c.us: ChatId="fd199c42-a5a8-4e6e-9189-dbd7ab7074e6", ChatLogId="4ac7748f-a561-4e21-b98e-379e2e7e8f0e"
2025-08-31 22:13:59.505 -03:00 [INF] 📡 ✅ Evento chat.created emitido para ChatLog: "4ac7748f-a561-4e21-b98e-379e2e7e8f0e"
2025-08-31 22:13:59.515 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 22:13:59.615 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756689206034.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 22:13:59.658 -03:00 [INF] Request finished GET /whatsappHub - 101 in 5374.7360ms
2025-08-31 22:13:59.658 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:13:59.664 -03:00 [INF] Request finished GET /api/health - 200 in 5.7700ms
2025-08-31 22:13:59.937 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:13:59.944 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 6.5110ms
2025-08-31 22:13:59.952 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:14:01.016 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 22:14:09.480 -03:00 [INF] Request starting GET /api/chats/4ac7748f-a561-4e21-b98e-379e2e7e8f0e/messages
2025-08-31 22:14:09.499 -03:00 [INF] 🔍 Buscando mensagens para ID: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e
2025-08-31 22:14:09.560 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Encontrado
2025-08-31 22:14:09.560 -03:00 [INF] ✅ Chat encontrado: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e, ContactPhoneE164: 5511988770944
2025-08-31 22:14:09.571 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 22:14:09.571 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 22:14:09.571 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:14:09.572 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 22:14:09.582 -03:00 [INF] Request starting GET /api/chats/4ac7748f-a561-4e21-b98e-379e2e7e8f0e/messages
2025-08-31 22:14:09.586 -03:00 [INF] 🔍 Buscando mensagens para ID: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e
2025-08-31 22:14:09.592 -03:00 [INF] Request finished GET /api/chats/4ac7748f-a561-4e21-b98e-379e2e7e8f0e/messages - 200 in 112.9390ms
2025-08-31 22:14:09.607 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Encontrado
2025-08-31 22:14:09.608 -03:00 [INF] ✅ Chat encontrado: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e, ContactPhoneE164: 5511988770944
2025-08-31 22:14:09.617 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 22:14:09.618 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 22:14:09.618 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:14:09.618 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 22:14:09.636 -03:00 [INF] Request finished GET /api/chats/4ac7748f-a561-4e21-b98e-379e2e7e8f0e/messages - 200 in 53.4940ms
2025-08-31 22:23:00.290 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:23:00.280 -03:00 [INF] Request finished GET /whatsappHub - 101 in 540320.5310ms
2025-08-31 22:23:00.290 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:23:00.290 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:23:00.337 -03:00 [INF] Request finished GET /api/health - 200 in 46.4590ms
2025-08-31 22:23:00.391 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:23:00.411 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 19.4120ms
2025-08-31 22:23:00.450 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:23:04.087 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3797.9070ms
2025-08-31 22:23:09.214 -03:00 [INF] Request finished GET /api/chats - 200 in 8924.8480ms
2025-08-31 22:23:10.638 -03:00 [INF] Request finished GET /whatsappHub - 101 in 10188.0110ms
2025-08-31 22:23:10.646 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:23:10.647 -03:00 [INF] Request finished GET /api/health - 200 in 4.1790ms
2025-08-31 22:23:10.667 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:23:10.678 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 11.5140ms
2025-08-31 22:23:10.688 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:25:13.795 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988770944@c.us -> 5511949907658
2025-08-31 22:25:14.798 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988770944
2025-08-31 22:25:14.858 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988770944: "4ac7748f-a561-4e21-b98e-379e2e7e8f0e" (criado em "2025-08-31T22:13:26.0000000")
2025-08-31 22:25:14.885 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "4ac7748f-a561-4e21-b98e-379e2e7e8f0e" para 5511988770944
2025-08-31 22:25:14.886 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 781687 chars)
2025-08-31 22:25:14.906 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 22:25:14.908 -03:00 [INF] 📊 PayloadJson carregado: 1 mensagens existentes
2025-08-31 22:25:14.910 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_1756689887571.mp3
2025-08-31 22:25:14.955 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 22:25:14.956 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 22:25:14.956 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (390507 chars)
2025-08-31 22:25:14.985 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=390507, FileName=audio_1756689887571.mp3, MimeType=audio/mpeg
2025-08-31 22:25:14.988 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=390507, MediaUrl=/media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 22:25:14.989 -03:00 [INF] 🔍 Verificando duplicata para MessageId: 22b0e23b-ed3c-4541-bdfd-d92871781725
2025-08-31 22:25:14.991 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: 22b0e23b-ed3c-4541-bdfd-d92871781725 (Total: 2 mensagens)
2025-08-31 22:25:15.144 -03:00 [INF] Request finished GET /whatsappHub - 101 in 124453.7520ms
2025-08-31 22:25:15.149 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:25:15.179 -03:00 [INF] Request finished GET /api/health - 200 in 29.9330ms
2025-08-31 22:25:15.214 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:25:15.224 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 9.8370ms
2025-08-31 22:25:15.246 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 781687 chars, depois: 1563271 chars)
2025-08-31 22:25:15.250 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:25:15.713 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "4ac7748f-a561-4e21-b98e-379e2e7e8f0e" - 2 mensagens no PayloadJson
2025-08-31 22:25:15.714 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="fd199c42-a5a8-4e6e-9189-dbd7ab7074e6", ChatLogId="4ac7748f-a561-4e21-b98e-379e2e7e8f0e"
2025-08-31 22:25:15.714 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "4ac7748f-a561-4e21-b98e-379e2e7e8f0e"
2025-08-31 22:25:15.829 -03:00 [INF] 🎫 AttendanceTicket criado: "a12006e2-6b9f-489c-bbd5-7c464587bcba"
2025-08-31 22:25:15.836 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 22:25:15.861 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_1756689887571.mp3' (23 chars), MimeType='audio/mpeg'
2025-08-31 22:25:16.036 -03:00 [INF] Request finished GET /whatsappHub - 101 in 786.1520ms
2025-08-31 22:25:16.038 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:25:16.038 -03:00 [INF] Request finished GET /api/health - 200 in 0.2900ms
2025-08-31 22:25:16.044 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:25:16.045 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.5900ms
2025-08-31 22:25:16.050 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:25:16.118 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 22:29:56.694 -03:00 [INF] Request starting GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages
2025-08-31 22:29:56.829 -03:00 [INF] 🔍 Buscando mensagens para ID: fd199c42-a5a8-4e6e-9189-dbd7ab7074e6
2025-08-31 22:29:58.390 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:29:58.484 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:29:58.484 -03:00 [INF] ✅ Chat encontrado: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e, ContactPhoneE164: 5511988770944
2025-08-31 22:29:58.514 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 22:29:58.515 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 22:29:58.515 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:29:58.516 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 22:29:58.516 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 22:29:58.543 -03:00 [INF] Request starting GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages
2025-08-31 22:29:58.559 -03:00 [INF] 🔍 Buscando mensagens para ID: fd199c42-a5a8-4e6e-9189-dbd7ab7074e6
2025-08-31 22:29:58.569 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:29:58.592 -03:00 [INF] Request finished GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages - 200 in 1897.9490ms
2025-08-31 22:29:58.629 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:29:58.629 -03:00 [INF] ✅ Chat encontrado: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e, ContactPhoneE164: 5511988770944
2025-08-31 22:29:58.778 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 22:29:58.790 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 22:29:58.790 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:29:58.791 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 22:29:58.791 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 22:29:58.899 -03:00 [INF] Request finished GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages - 200 in 355.5000ms
2025-08-31 22:34:03.984 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1325467.1230ms
2025-08-31 22:34:04.162 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1325716.0520ms
2025-08-31 22:34:04.162 -03:00 [INF] Request finished GET /whatsappHub - 101 in 528112.4730ms
2025-08-31 22:34:04.165 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1325669.7190ms
2025-08-31 22:34:06.262 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:34:06.262 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 22:34:06.262 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:34:06.262 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:34:06.307 -03:00 [INF] Request finished GET /api/health - 200 in 44.9290ms
2025-08-31 22:34:06.321 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:34:06.326 -03:00 [INF] Request finished GET /api/health - 200 in 4.6360ms
2025-08-31 22:34:06.438 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:34:06.439 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:34:06.439 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:34:06.443 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:34:06.464 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 25.3620ms
2025-08-31 22:34:06.466 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 22.8820ms
2025-08-31 22:34:06.468 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 29.4120ms
2025-08-31 22:34:06.468 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 29.0510ms
2025-08-31 22:34:06.507 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:34:06.567 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:34:06.584 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:34:06.600 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:34:07.044 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 781.7090ms
2025-08-31 22:34:07.046 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:34:07.052 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 6.4270ms
2025-08-31 22:34:07.053 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:34:07.059 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 5.9720ms
2025-08-31 22:34:07.062 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:34:07.078 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 15.8850ms
2025-08-31 22:34:07.080 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:34:07.102 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 21.6570ms
2025-08-31 22:34:07.103 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:34:07.109 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 6.1110ms
2025-08-31 22:34:08.173 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:34:08.506 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2243.9890ms
2025-08-31 22:34:08.508 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 22:34:09.528 -03:00 [INF] Request finished GET /api/chats - 200 in 3265.8470ms
2025-08-31 22:34:10.199 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:34:10.200 -03:00 [INF] Request finished GET /whatsappHub - 101 in 3692.7610ms
2025-08-31 22:34:10.205 -03:00 [INF] Request finished GET /api/health - 200 in 5.8830ms
2025-08-31 22:34:10.259 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:34:10.271 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 12.0040ms
2025-08-31 22:34:10.289 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:34:10.534 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2026.5040ms
2025-08-31 22:34:10.636 -03:00 [INF] Request finished GET /api/chats - 200 in 2462.8660ms
2025-08-31 22:34:11.132 -03:00 [INF] Request finished GET /whatsappHub - 101 in 843.1580ms
2025-08-31 22:34:11.133 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:34:11.135 -03:00 [INF] Request finished GET /api/health - 200 in 1.8820ms
2025-08-31 22:34:11.191 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:34:11.205 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 20.1870ms
2025-08-31 22:34:11.230 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:34:13.263 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 22:34:13.280 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 22:34:13.341 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:34:13.456 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:34:13.456 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 22:34:13.487 -03:00 [INF] PayloadJson no formato NOVO detectado: 3 mensagens
2025-08-31 22:34:13.487 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 3
2025-08-31 22:34:13.487 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 22:34:13.488 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 22:34:13.488 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:34:13.488 -03:00 [INF] ✅ Retornando 3 mensagens convertidas
2025-08-31 22:34:13.497 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 22:34:13.499 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 22:34:13.502 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:34:13.511 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:34:13.511 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 22:34:13.534 -03:00 [INF] PayloadJson no formato NOVO detectado: 3 mensagens
2025-08-31 22:34:13.534 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 3
2025-08-31 22:34:13.534 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 22:34:13.535 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 22:34:13.535 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 22:34:13.535 -03:00 [INF] ✅ Retornando 3 mensagens convertidas
2025-08-31 22:34:13.556 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 58.8930ms
2025-08-31 22:34:13.558 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 295.1730ms
2025-08-31 22:34:14.716 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 22:34:14.738 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 22:34:14.756 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:34:14.762 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:34:14.762 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 22:34:14.763 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 22:34:14.763 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 22:34:14.763 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 22:34:14.765 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 49.1720ms
2025-08-31 22:34:14.767 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 22:34:14.768 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 22:34:14.776 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:34:14.785 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:34:14.785 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 22:34:14.785 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 22:34:14.786 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 22:34:14.786 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 22:34:14.786 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 18.9030ms
2025-08-31 22:34:15.699 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 22:34:15.700 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 22:34:15.703 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:34:16.590 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:34:16.591 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 22:34:16.813 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 22:34:16.813 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 22:34:16.813 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 22:34:16.813 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 22:34:16.813 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 22:34:16.813 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 22:34:16.813 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 22:34:16.814 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 22:34:16.814 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 22:34:16.814 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 22:34:16.814 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 22:34:16.814 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 22:34:16.814 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 22:34:16.815 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 22:34:16.815 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 22:34:16.815 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 22:34:16.815 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 22:34:16.816 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 22:34:16.816 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 22:34:16.816 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 22:34:16.816 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 22:34:16.816 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 22:34:16.816 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 22:34:16.816 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 22:34:16.817 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 22:34:16.817 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 22:34:16.817 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 22:34:16.817 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 22:34:16.817 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 22:34:16.818 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 22:34:16.822 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 22:34:16.822 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 22:34:16.824 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 22:34:16.824 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 22:34:16.831 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 22:34:16.833 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 22:34:16.837 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:34:17.244 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 1544.7740ms
2025-08-31 22:34:17.767 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:34:17.768 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 22:34:18.145 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 22:34:18.146 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 22:34:18.146 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 22:34:18.147 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 22:34:18.147 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 22:34:18.147 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 22:34:18.147 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 22:34:18.148 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 22:34:18.148 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 22:34:18.148 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 22:34:18.148 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 22:34:18.148 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 22:34:18.149 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 22:34:18.149 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 22:34:18.151 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 22:34:18.153 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 22:34:18.154 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 22:34:18.154 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 22:34:18.154 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 22:34:18.154 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 22:34:18.154 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 22:34:18.155 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 22:34:18.155 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 22:34:18.155 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 22:34:18.155 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 22:34:18.155 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 22:34:18.155 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 22:34:18.156 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 22:34:18.156 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 22:34:18.156 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 22:34:18.156 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 22:34:18.161 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 22:34:18.161 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 22:34:18.171 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 22:34:18.792 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 1961.3930ms
2025-08-31 22:35:49.077 -03:00 [INF] Request starting GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages
2025-08-31 22:35:49.138 -03:00 [INF] 🔍 Buscando mensagens para ID: fd199c42-a5a8-4e6e-9189-dbd7ab7074e6
2025-08-31 22:35:49.651 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:35:50.453 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:35:50.456 -03:00 [INF] ✅ Chat encontrado: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e, ContactPhoneE164: 5511988770944
2025-08-31 22:35:50.515 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 22:35:50.516 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 22:35:50.516 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:35:50.518 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 22:35:50.518 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 22:35:50.557 -03:00 [INF] Request starting GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages
2025-08-31 22:35:50.586 -03:00 [INF] 🔍 Buscando mensagens para ID: fd199c42-a5a8-4e6e-9189-dbd7ab7074e6
2025-08-31 22:35:50.624 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:35:50.627 -03:00 [INF] Request finished GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages - 200 in 1550.5310ms
2025-08-31 22:35:50.814 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:35:50.816 -03:00 [INF] ✅ Chat encontrado: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e, ContactPhoneE164: 5511988770944
2025-08-31 22:35:50.831 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 22:35:50.832 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 22:35:50.832 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 22:35:50.832 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 22:35:50.833 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 22:35:50.874 -03:00 [INF] Request finished GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages - 200 in 316.5290ms
2025-08-31 22:35:54.743 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 22:35:54.758 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 22:35:54.785 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:35:54.819 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:35:54.820 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 22:35:54.824 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 22:35:54.824 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 22:35:54.830 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 22:35:54.836 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 22:35:54.838 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 95.7930ms
2025-08-31 22:35:54.845 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 22:35:54.905 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 22:35:54.971 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 22:35:54.972 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 22:35:54.974 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 22:35:54.974 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 22:35:54.980 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 22:35:54.983 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 146.5940ms
2025-08-31 22:49:03.067 -03:00 [INF] Request finished GET /whatsappHub - 101 in 896468.2250ms
2025-08-31 22:49:03.067 -03:00 [INF] Request finished GET /whatsappHub - 101 in 896485.7580ms
2025-08-31 22:49:03.067 -03:00 [INF] Request finished GET /whatsappHub - 101 in 891822.7940ms
2025-08-31 22:49:03.066 -03:00 [INF] Request finished GET /whatsappHub - 101 in 896453.1280ms
2025-08-31 22:49:06.165 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:49:06.165 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 22:49:06.165 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:49:06.165 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:49:06.184 -03:00 [INF] Request finished GET /api/health - 200 in 18.8170ms
2025-08-31 22:49:06.188 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:49:06.189 -03:00 [INF] Request finished GET /api/health - 200 in 1.3720ms
2025-08-31 22:49:06.243 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:49:06.244 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:49:06.260 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 16.2400ms
2025-08-31 22:49:06.260 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 16.1010ms
2025-08-31 22:49:06.318 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:49:06.318 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.4710ms
2025-08-31 22:49:06.319 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:49:06.322 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:49:06.322 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.2250ms
2025-08-31 22:49:06.368 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:49:06.384 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:49:06.399 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:49:08.278 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2112.3750ms
2025-08-31 22:49:08.286 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 22:49:09.169 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3003.9950ms
2025-08-31 22:49:09.172 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:49:09.274 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 101.9300ms
2025-08-31 22:49:09.279 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:49:09.375 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 96.4020ms
2025-08-31 22:49:09.431 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:49:09.471 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 40.0590ms
2025-08-31 22:49:09.474 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:49:09.490 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 16.4650ms
2025-08-31 22:49:09.493 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 22:49:09.509 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 15.8320ms
2025-08-31 22:49:10.301 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2014.8150ms
2025-08-31 22:49:15.380 -03:00 [INF] Request starting GET /api/chats
2025-08-31 22:49:16.547 -03:00 [INF] Request finished GET /api/chats - 200 in 10381.3630ms
2025-08-31 22:49:17.479 -03:00 [INF] Request finished GET /whatsappHub - 101 in 11110.9050ms
2025-08-31 22:49:17.501 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:49:17.506 -03:00 [INF] Request finished GET /api/health - 200 in 4.4920ms
2025-08-31 22:49:17.534 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:49:17.540 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 5.3490ms
2025-08-31 22:49:17.564 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 22:49:18.332 -03:00 [INF] Request finished GET /api/chats - 200 in 2952.4850ms
2025-08-31 22:49:19.215 -03:00 [INF] Request starting GET /api/health
2025-08-31 22:49:19.216 -03:00 [INF] Request finished GET /api/health - 200 in 0.4020ms
2025-08-31 22:49:19.216 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1651.5610ms
2025-08-31 22:49:19.241 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 22:49:19.242 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.5440ms
2025-08-31 22:49:19.245 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:00:34.308 -03:00 [INF] Request starting GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages
2025-08-31 23:00:34.660 -03:00 [INF] 🔍 Buscando mensagens para ID: fd199c42-a5a8-4e6e-9189-dbd7ab7074e6
2025-08-31 23:00:37.203 -03:00 [INF] Request starting POST /api/attendances/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/assign
2025-08-31 23:00:37.908 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 23:00:37.916 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 23:00:38.633 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 23:00:38.635 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 23:00:39.464 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 23:00:39.494 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 23:00:40.476 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 23:00:40.609 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 23:00:42.860 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:42.860 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:42.860 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:42.860 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:42.860 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:43.171 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:43.172 -03:00 [INF] ✅ Chat encontrado: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e, ContactPhoneE164: 5511988770944
2025-08-31 23:00:43.231 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 23:00:43.233 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 23:00:43.233 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 23:00:43.237 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 23:00:43.238 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 23:00:43.386 -03:00 [INF] Request finished GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages - 200 in 9078.7570ms
2025-08-31 23:00:43.413 -03:00 [INF] Request starting GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages
2025-08-31 23:00:43.417 -03:00 [INF] 🔍 Buscando mensagens para ID: fd199c42-a5a8-4e6e-9189-dbd7ab7074e6
2025-08-31 23:00:43.426 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:43.749 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:43.750 -03:00 [INF] ✅ Chat encontrado: 4ac7748f-a561-4e21-b98e-379e2e7e8f0e, ContactPhoneE164: 5511988770944
2025-08-31 23:00:43.937 -03:00 [INF] PayloadJson no formato NOVO detectado: 2 mensagens
2025-08-31 23:00:43.937 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 2
2025-08-31 23:00:43.938 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cebe853f-7bf7-4b5b-9441-ea8c4fe0820b.mp3
2025-08-31 23:00:43.938 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c6478675-a7f3-41e7-8c10-8dd050ed952e.mp3
2025-08-31 23:00:43.938 -03:00 [INF] ✅ Retornando 2 mensagens convertidas
2025-08-31 23:00:44.246 -03:00 [INF] Request finished GET /api/chats/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/messages - 200 in 832.0460ms
2025-08-31 23:00:44.344 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:44.346 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 23:00:44.348 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 23:00:44.348 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 23:00:44.348 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 23:00:44.352 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 4888.1160ms
2025-08-31 23:00:44.362 -03:00 [INF] Request starting GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages
2025-08-31 23:00:44.362 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:44.362 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 23:00:44.363 -03:00 [INF] 🔍 Buscando mensagens para ID: 28dff706-3010-44ac-9b4c-63e2dce394c8
2025-08-31 23:00:44.365 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 23:00:44.367 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 23:00:44.371 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 23:00:44.372 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:44.376 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 3900.3530ms
2025-08-31 23:00:44.379 -03:00 [INF] Request starting GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages
2025-08-31 23:00:44.387 -03:00 [INF] 🔍 Buscando mensagens para ID: 78f4cbd4-4bb5-4153-90c6-99c884fab258
2025-08-31 23:00:44.392 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:44.476 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:44.479 -03:00 [INF] ✅ Chat encontrado: e3284cd6-fec3-4726-bb5f-c19f84a3ed9e, ContactPhoneE164: 5511999887766
2025-08-31 23:00:44.479 -03:00 [INF] PayloadJson no formato NOVO detectado: 1 mensagens
2025-08-31 23:00:44.479 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 1
2025-08-31 23:00:44.479 -03:00 [INF] ✅ Retornando 1 mensagens convertidas
2025-08-31 23:00:44.481 -03:00 [INF] Request finished GET /api/chats/28dff706-3010-44ac-9b4c-63e2dce394c8/messages - 200 in 118.9820ms
2025-08-31 23:00:44.539 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:44.539 -03:00 [INF] ✅ Chat encontrado: c693e781-b136-4c1d-9095-6d321c3c5738, ContactPhoneE164: 
2025-08-31 23:00:44.546 -03:00 [INF] PayloadJson no formato NOVO detectado: 16 mensagens
2025-08-31 23:00:44.546 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 16
2025-08-31 23:00:44.546 -03:00 [INF] ✅ Retornando 16 mensagens convertidas
2025-08-31 23:00:44.548 -03:00 [INF] Request finished GET /api/chats/78f4cbd4-4bb5-4153-90c6-99c884fab258/messages - 200 in 168.9160ms
2025-08-31 23:00:44.735 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:44.737 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 23:00:44.912 -03:00 [INF] PayloadJson no formato NOVO detectado: 3 mensagens
2025-08-31 23:00:44.912 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 3
2025-08-31 23:00:44.912 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 23:00:44.912 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 23:00:44.912 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 23:00:44.914 -03:00 [INF] ✅ Retornando 3 mensagens convertidas
2025-08-31 23:00:44.979 -03:00 [INF] Request starting GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages
2025-08-31 23:00:44.985 -03:00 [INF] 🔍 Buscando mensagens para ID: c0d2c101-08c6-43c3-9841-5000676323b4
2025-08-31 23:00:45.006 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:45.264 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 7355.9010ms
2025-08-31 23:00:45.394 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:45.394 -03:00 [INF] ✅ Chat encontrado: b2e20bff-829c-4ddd-bc69-e3b6c20271dd, ContactPhoneE164: 5511988770987
2025-08-31 23:00:45.442 -03:00 [INF] PayloadJson no formato NOVO detectado: 3 mensagens
2025-08-31 23:00:45.443 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 3
2025-08-31 23:00:45.443 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/d06de1f6-00ac-4c0a-b945-b8f4d741e687.mp3
2025-08-31 23:00:45.444 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fbad0ffa-6160-49d0-b583-b7c34b230bfc.mp3
2025-08-31 23:00:45.482 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8f5dea7c-b93c-43d8-a933-5a8e24a0e4d9.mp3
2025-08-31 23:00:45.482 -03:00 [INF] ✅ Retornando 3 mensagens convertidas
2025-08-31 23:00:45.719 -03:00 [INF] Request finished POST /api/attendances/fd199c42-a5a8-4e6e-9189-dbd7ab7074e6/assign - 200 in 8515.8430ms
2025-08-31 23:00:45.801 -03:00 [INF] Request finished GET /api/chats/c0d2c101-08c6-43c3-9841-5000676323b4/messages - 200 in 822.4820ms
2025-08-31 23:00:48.204 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:48.208 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 23:00:51.411 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 23:00:51.418 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 23:00:51.418 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 23:00:51.418 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 23:00:51.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 23:00:51.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 23:00:51.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 23:00:51.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 23:00:51.419 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 23:00:51.420 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 23:00:51.420 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 23:00:51.427 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 23:00:51.427 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 23:00:51.427 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 23:00:51.428 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 23:00:51.429 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 23:00:51.429 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 23:00:51.429 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 23:00:51.429 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 23:00:51.430 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 23:00:51.430 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 23:00:51.430 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 23:00:51.430 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 23:00:51.430 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 23:00:51.430 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 23:00:51.430 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 23:00:51.431 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 23:00:51.431 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 23:00:51.431 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 23:00:51.431 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 23:00:51.431 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 23:00:51.432 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 23:00:51.432 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 23:00:51.432 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 23:00:51.498 -03:00 [INF] Request starting GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages
2025-08-31 23:00:51.524 -03:00 [INF] 🔍 Buscando mensagens para ID: d6527602-3127-49f3-bf3f-08da7a923616
2025-08-31 23:00:51.766 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Não encontrado
2025-08-31 23:00:52.886 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 14252.3830ms
2025-08-31 23:00:53.758 -03:00 [INF] 📄 Busca por ChatId como GUID: Encontrado
2025-08-31 23:00:53.764 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 23:00:54.590 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 23:00:55.045 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 34
2025-08-31 23:00:55.045 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 23:00:55.046 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 23:00:55.046 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 23:00:55.047 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 23:00:55.047 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 23:00:55.047 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 23:00:55.047 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 23:00:55.842 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 23:00:57.005 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 23:00:58.494 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 23:00:58.496 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 23:00:58.671 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 23:00:58.672 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 23:00:58.672 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 23:00:58.672 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 23:00:58.672 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 23:00:58.688 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 23:00:58.688 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 23:00:58.688 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 23:00:58.688 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 23:00:58.688 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 23:00:58.705 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 23:00:58.705 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 23:00:58.705 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 23:00:58.705 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 23:00:58.706 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 23:00:58.706 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 23:00:58.706 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 23:00:58.706 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 23:00:58.713 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 23:00:58.713 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 23:00:58.746 -03:00 [INF] ✅ Retornando 34 mensagens convertidas
2025-08-31 23:01:00.479 -03:00 [INF] Request finished GET /api/chats/d6527602-3127-49f3-bf3f-08da7a923616/messages - 200 in 8981.1020ms
2025-08-31 23:13:09.418 -03:00 [INF] Request starting POST /api/whatsapp/session/updated
2025-08-31 23:13:09.996 -03:00 [INF] 📥 Webhook session/updated: connected=false number=null validated=false (mudança detectada)
2025-08-31 23:13:10.192 -03:00 [INF] Request finished POST /api/whatsapp/session/updated - 200 in 774.4380ms
2025-08-31 23:14:08.382 -03:00 [INF] 📨 Mensagem WhatsApp recebida via RabbitMQ: 5511988776655@c.us -> 
2025-08-31 23:14:09.086 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:14:09.094 -03:00 [INF] Request finished GET /api/health - 200 in 6.7060ms
2025-08-31 23:14:09.111 -03:00 [INF] Request finished GET /whatsappHub - 101 in 1489866.4190ms
2025-08-31 23:14:09.141 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:14:09.156 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 15.2880ms
2025-08-31 23:14:09.177 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:14:09.483 -03:00 [INF] 📞 ✅ Nova conversa WhatsApp criada para 5511988776655: "43b1d6af-b60c-4782-8b7a-c72936c80405"
2025-08-31 23:14:09.484 -03:00 [INF] 🔍 Buscando ChatLog existente para 5511988776655
2025-08-31 23:14:10.144 -03:00 [INF] ✅ ChatLog ENCONTRADO para 5511988776655: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" (criado em "2025-08-31T18:07:59.0000000")
2025-08-31 23:14:10.200 -03:00 [INF] 🔄 INCREMENTANDO mensagem ao ChatLog existente "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" para 5511988776655
2025-08-31 23:14:10.205 -03:00 [INF] 📋 Deserializando PayloadJson existente (tamanho: 20094762 chars)
2025-08-31 23:14:10.442 -03:00 [INF] PayloadJson no formato NOVO detectado: 34 mensagens
2025-08-31 23:14:10.442 -03:00 [INF] 📊 PayloadJson carregado: 34 mensagens existentes
2025-08-31 23:14:10.442 -03:00 [INF] 🎬 Iniciando armazenamento de mídia: audio/mpeg, audio_test.mp3
2025-08-31 23:14:10.452 -03:00 [INF] ✅ Mídia armazenada com sucesso: /media/a1f3badf-7377-490b-87aa-b68f3c2da008.mp3
2025-08-31 23:14:10.452 -03:00 [INF] 🎬 Mídia processada e armazenada: /media/a1f3badf-7377-490b-87aa-b68f3c2da008.mp3
2025-08-31 23:14:10.452 -03:00 [INF] 🎵 ÁUDIO: Body populado com base64 (283 chars)
2025-08-31 23:14:10.452 -03:00 [INF] 📝 MessageInfo COMPLETO criado: Type=audio, Body_Length=283, FileName=audio_test.mp3, MimeType=audio/mpeg
2025-08-31 23:14:10.452 -03:00 [INF] 💾 MessageInfo criado para chat existente: Type=audio, Body_Length=283, MediaUrl=/media/a1f3badf-7377-490b-87aa-b68f3c2da008.mp3
2025-08-31 23:14:10.452 -03:00 [INF] 🔍 Verificando duplicata para MessageId: test-audio-1756692847655
2025-08-31 23:14:10.452 -03:00 [INF] 📝 ✅ Nova mensagem ADICIONADA ao PayloadJson: test-audio-1756692847655 (Total: 35 mensagens)
2025-08-31 23:14:10.895 -03:00 [INF] 💾 Atualizando PayloadJson (antes: 20094762 chars, depois: 18764803 chars)
2025-08-31 23:14:18.608 -03:00 [INF] ✅ ChatLog atualizado com SUCESSO: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5" - 35 mensagens no PayloadJson
2025-08-31 23:14:18.609 -03:00 [INF] 📝 ✅ Mensagem adicionada ao ChatLog existente: ChatId="d6527602-3127-49f3-bf3f-08da7a923616", ChatLogId="f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 23:14:18.624 -03:00 [INF] 📡 ✅ Evento chat.updated emitido para ChatLog: "f0c45bfb-bbe0-496d-abaf-03d44850bdc5"
2025-08-31 23:14:18.699 -03:00 [INF] 🎫 AttendanceTicket criado: "0bf00b48-f881-436e-90f1-c41de304b18d"
2025-08-31 23:14:18.708 -03:00 [ERR] Erro ao sanitizar mensagem com serviço de resiliência, usando fallback
System.TypeInitializationException: The type initializer for 'Pregiato.Application.Services.EmojiResilienceService' threw an exception.
 ---> System.Text.RegularExpressions.RegexParseException: Invalid pattern '[\uD83C\uDF00-\uD83C\uDFFF]|[\uD83D\uDC00-\uD83D\uDDFF]|[\uD83D\uDE00-\uD83D\uDE4F]|[\uD83D\uDE80-\uD83D\uDEFF]|[\uD83C\uDDE0-\uD83C\uDDFF]|[\u2600-\u26FF]|[\u2700-\u27BF]' at offset 20. [x-y] range in reverse order.
   at System.Text.RegularExpressions.RegexParser.ScanCharClass(Boolean caseInsensitive, Boolean scanOnly)
   at System.Text.RegularExpressions.RegexParser.ScanRegex()
   at System.Text.RegularExpressions.RegexParser.Parse(String pattern, RegexOptions options, CultureInfo culture)
   at System.Text.RegularExpressions.Regex..ctor(String pattern, RegexOptions options, TimeSpan matchTimeout, CultureInfo culture)
   at Pregiato.Application.Services.EmojiResilienceService..cctor() in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 30
   --- End of inner exception stack trace ---
   at Pregiato.Application.Services.EmojiResilienceService.HasEmojis(String text) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 298
   at Pregiato.Application.Services.EmojiResilienceService.ProcessText(String text, EmojiProcessingStrategy strategy) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.Application/Services/EmojiResilienceService.cs:line 55
   at Pregiato.API.Services.RabbitBackgroundService.SanitizeMessageBody(String body) in /Users/worldgames/Documents/PREGIATO/My_pregiato /mypregiato/back/Pregiato.API/Services/RabbitBackgroundService.cs:line 863
2025-08-31 23:14:18.743 -03:00 [INF] 📎 Attachment processado com sucesso: FileName='audio_test.mp3' (14 chars), MimeType='audio/mpeg'
2025-08-31 23:14:19.025 -03:00 [INF] Request finished GET /whatsappHub - 101 in 9848.1920ms
2025-08-31 23:14:19.040 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:14:19.043 -03:00 [INF] Request finished GET /api/health - 200 in 2.1010ms
2025-08-31 23:14:19.055 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:14:19.057 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 2.4830ms
2025-08-31 23:14:19.068 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:14:19.892 -03:00 [INF] ✅ Salvas 1 mensagens em batch
2025-08-31 23:18:03.971 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 23:18:04.104 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 23:18:06.318 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Encontrado
2025-08-31 23:18:06.319 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 23:18:07.211 -03:00 [INF] PayloadJson no formato NOVO detectado: 35 mensagens
2025-08-31 23:18:07.211 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 35
2025-08-31 23:18:07.212 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 23:18:07.212 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 23:18:07.212 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 23:18:07.212 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 23:18:07.212 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 23:18:07.212 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 23:18:07.213 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 23:18:07.213 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 23:18:07.213 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 23:18:07.213 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 23:18:07.213 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 23:18:07.213 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 23:18:07.214 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 23:18:07.215 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 23:18:07.215 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 23:18:07.245 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 23:18:07.245 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 23:18:07.249 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 23:18:07.249 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 23:18:07.249 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 23:18:07.249 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 23:18:07.249 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 23:18:07.250 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=283, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAABVFRJVDIAAAAOAAA..., MediaUrl=/media/a1f3badf-7377-490b-87aa-b68f3c2da008.mp3
2025-08-31 23:18:07.251 -03:00 [INF] ✅ Retornando 35 mensagens convertidas
2025-08-31 23:18:07.268 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 23:18:07.278 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 23:18:07.807 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 3835.7150ms
2025-08-31 23:18:08.633 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Encontrado
2025-08-31 23:18:08.634 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 23:18:08.890 -03:00 [INF] PayloadJson no formato NOVO detectado: 35 mensagens
2025-08-31 23:18:08.891 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 35
2025-08-31 23:18:08.891 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 23:18:08.891 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 23:18:08.891 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 23:18:08.891 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 23:18:08.892 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 23:18:08.892 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 23:18:08.892 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 23:18:08.892 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 23:18:08.893 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 23:18:08.893 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 23:18:08.893 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 23:18:08.893 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 23:18:08.893 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 23:18:08.894 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 23:18:08.895 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 23:18:08.895 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 23:18:08.895 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 23:18:08.900 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 23:18:08.900 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 23:18:08.903 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 23:18:08.903 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 23:18:08.903 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 23:18:08.903 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=283, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAABVFRJVDIAAAAOAAA..., MediaUrl=/media/a1f3badf-7377-490b-87aa-b68f3c2da008.mp3
2025-08-31 23:18:08.904 -03:00 [INF] ✅ Retornando 35 mensagens convertidas
2025-08-31 23:18:08.924 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 23:18:08.926 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 23:18:09.223 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Encontrado
2025-08-31 23:18:09.224 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 23:18:09.276 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 2008.2260ms
2025-08-31 23:18:09.605 -03:00 [INF] PayloadJson no formato NOVO detectado: 35 mensagens
2025-08-31 23:18:09.605 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 35
2025-08-31 23:18:09.605 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 23:18:09.605 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 23:18:09.605 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 23:18:09.605 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 23:18:09.605 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 23:18:09.605 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 23:18:09.606 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 23:18:09.606 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 23:18:09.606 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 23:18:09.606 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 23:18:09.606 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 23:18:09.606 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 23:18:09.606 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 23:18:09.607 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 23:18:09.607 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 23:18:09.607 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 23:18:09.608 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 23:18:09.608 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 23:18:09.608 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 23:18:09.608 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 23:18:09.608 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 23:18:09.608 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 23:18:09.608 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 23:18:09.609 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 23:18:09.609 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 23:18:09.609 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 23:18:09.609 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 23:18:09.609 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 23:18:09.610 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 23:18:09.610 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 23:18:09.617 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 23:18:09.618 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=283, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAABVFRJVDIAAAAOAAA..., MediaUrl=/media/a1f3badf-7377-490b-87aa-b68f3c2da008.mp3
2025-08-31 23:18:09.621 -03:00 [INF] ✅ Retornando 35 mensagens convertidas
2025-08-31 23:18:09.629 -03:00 [INF] Request starting GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages
2025-08-31 23:18:09.629 -03:00 [INF] 🔍 Buscando mensagens para ID: f0c45bfb-bbe0-496d-abaf-03d44850bdc5
2025-08-31 23:18:09.795 -03:00 [INF] 📄 Busca por GUID ID do ChatLog: Encontrado
2025-08-31 23:18:09.795 -03:00 [INF] ✅ Chat encontrado: f0c45bfb-bbe0-496d-abaf-03d44850bdc5, ContactPhoneE164: 5511988776655
2025-08-31 23:18:10.505 -03:00 [INF] PayloadJson no formato NOVO detectado: 35 mensagens
2025-08-31 23:18:10.826 -03:00 [INF] 📊 Mensagens encontradas no PayloadJson: 35
2025-08-31 23:18:10.826 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/3959f073-352e-421a-8a96-18e419991de1.mp3
2025-08-31 23:18:10.827 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/7b0e5b34-197f-4c17-8e12-efa4da007eb2.mp3
2025-08-31 23:18:10.828 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/52b1451d-8fd8-4a84-accf-7eef2cef6dc3.mp3
2025-08-31 23:18:10.828 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/43f07847-b9f1-4ab0-bd90-4ef3797f450f.mp3
2025-08-31 23:18:10.828 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/615be964-565b-402d-9e90-d4d3ad411fdf.mp3
2025-08-31 23:18:10.828 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/de8d2bfd-d6b1-4559-a34e-d5c7dce4a2e6.mp3
2025-08-31 23:18:10.828 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=0, Body_Preview=, MediaUrl=/media/d9c5d29c-68da-44f8-bdf5-18aa20d34930.mp3
2025-08-31 23:18:10.829 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/fc817c65-e73b-462f-9f95-d9d73bd9dfc3.mp3
2025-08-31 23:18:10.829 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/6f25012b-e6a8-4c13-850e-024288d02dad.mp3
2025-08-31 23:18:10.829 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/2345e4ab-a2a3-46f1-8bbd-f57bac24bce2.mp3
2025-08-31 23:18:10.829 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/70d6e9b5-e12a-4cc6-b0b2-67c6dd15ad0c.mp3
2025-08-31 23:18:10.829 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9ae2a8b3-4ba6-4257-882c-34dd04912824.mp3
2025-08-31 23:18:10.829 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/90df1b8f-ff31-4860-a65e-42bd24446f56.mp3
2025-08-31 23:18:10.830 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/db36c558-c757-405b-a430-fb58274ba0b7.mp3
2025-08-31 23:18:10.831 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/503ab05b-6cb2-4852-b043-a0fd383aaacc.mp3
2025-08-31 23:18:10.831 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/b787e8ee-017e-4fd4-ab16-6fd0d2f18eae.mp3
2025-08-31 23:18:10.832 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/e0cec38c-c42b-4020-8f51-273cecd67a42.mp3
2025-08-31 23:18:10.832 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/f3354794-b71b-4f39-b104-396b425ed2f0.mp3
2025-08-31 23:18:10.835 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/cdab5691-a61e-4bf6-a7f5-36de6c7f87eb.mp3
2025-08-31 23:18:10.837 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/5afb5e0e-4092-4de8-91b3-acfdd9238611.mp3
2025-08-31 23:18:10.839 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/03db8b3f-424a-4760-b27b-eae5da5f21c4.mp3
2025-08-31 23:18:10.839 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c77155e2-08d5-4a85-8179-5df0ab8f8477.mp3
2025-08-31 23:18:10.839 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/394d9336-2f75-492c-9f38-edc0bcacf888.mp3
2025-08-31 23:18:10.840 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/05cc2845-8437-48eb-a0e4-da34eb26ea07.mp3
2025-08-31 23:18:10.840 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/9c7a0cda-ed6f-4704-8fbb-c830222b6738.mp3
2025-08-31 23:18:10.841 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/0f817e14-f9c8-46bf-9179-db7a238ccb1d.mp3
2025-08-31 23:18:10.841 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ccc84e35-f61c-4758-b3a6-a06093ed1c5b.mp3
2025-08-31 23:18:10.841 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/22557481-333f-483b-aeab-6124a5499795.mp3
2025-08-31 23:18:10.842 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/8c172c8e-e986-4f8a-ac36-4596e635ab10.mp3
2025-08-31 23:18:10.842 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/ac98c4ac-9b12-40da-93e4-0f3996f0fe56.mp3
2025-08-31 23:18:10.842 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=390507, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAAASFRMRU4AAAAHAAA..., MediaUrl=/media/c4522bf6-f551-4ac8-b1a1-957c70bd450f.mp3
2025-08-31 23:18:10.842 -03:00 [INF] 🎵 DEBUG ÁUDIO: Type=audio, Body_Length=283, Body_Preview=data:audio/mpeg;base64,SUQzBAAAAAABVFRJVDIAAAAOAAA..., MediaUrl=/media/a1f3badf-7377-490b-87aa-b68f3c2da008.mp3
2025-08-31 23:18:10.842 -03:00 [INF] ✅ Retornando 35 mensagens convertidas
2025-08-31 23:18:10.898 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 1974.5500ms
2025-08-31 23:18:11.346 -03:00 [INF] Request finished GET /api/chats/f0c45bfb-bbe0-496d-abaf-03d44850bdc5/messages - 200 in 1717.2750ms
2025-08-31 23:29:24.854 -03:00 [INF] Request starting GET /api/chats
2025-08-31 23:29:24.883 -03:00 [INF] Request finished GET /whatsappHub - 101 in 905806.4880ms
2025-08-31 23:29:24.854 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:29:24.854 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 23:29:25.064 -03:00 [INF] Request finished GET /api/health - 200 in 214.2780ms
2025-08-31 23:29:25.262 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:29:25.837 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 534.9710ms
2025-08-31 23:29:25.934 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:29:33.412 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 8561.4860ms
2025-08-31 23:29:40.265 -03:00 [INF] Request finished GET /api/chats - 200 in 15414.8780ms
2025-08-31 23:29:40.677 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:29:40.680 -03:00 [INF] Request finished GET /whatsappHub - 101 in 14746.2700ms
2025-08-31 23:29:40.682 -03:00 [INF] Request finished GET /api/health - 200 in 4.5920ms
2025-08-31 23:29:40.703 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:29:40.709 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 6.4450ms
2025-08-31 23:29:40.722 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:33:12.403 -03:00 [INF] Request finished GET /whatsappHub - 101 in 211672.5040ms
2025-08-31 23:33:12.421 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:33:12.421 -03:00 [INF] Request starting GET /api/chats
2025-08-31 23:33:12.421 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 23:33:12.703 -03:00 [INF] Request finished GET /api/health - 200 in 282.8610ms
2025-08-31 23:33:12.730 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:33:12.741 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 11.3510ms
2025-08-31 23:33:12.759 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:33:15.772 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 3349.5480ms
2025-08-31 23:33:20.626 -03:00 [INF] Request finished GET /api/chats - 200 in 8205.1740ms
2025-08-31 23:33:21.620 -03:00 [INF] Request finished GET /whatsappHub - 101 in 8860.7590ms
2025-08-31 23:33:21.620 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:33:21.624 -03:00 [INF] Request finished GET /api/health - 200 in 3.4550ms
2025-08-31 23:33:21.628 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:33:21.632 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 4.7790ms
2025-08-31 23:33:21.636 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:37:37.137 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:37:37.137 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:37:37.137 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:37:37.137 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:37:37.187 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 54.4400ms
2025-08-31 23:37:37.187 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 53.9740ms
2025-08-31 23:37:37.187 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 54.2430ms
2025-08-31 23:37:37.187 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 56.0650ms
2025-08-31 23:37:37.240 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:37:37.265 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:37:37.284 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:37:37.299 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:37:37.436 -03:00 [INF] Request finished GET /whatsappHub - 101 in 2911036.6520ms
2025-08-31 23:37:37.448 -03:00 [INF] Request finished GET /whatsappHub - 101 in 2911064.1320ms
2025-08-31 23:37:37.448 -03:00 [INF] Request finished GET /whatsappHub - 101 in 2911128.5070ms
2025-08-31 23:37:37.452 -03:00 [INF] Request finished GET /whatsappHub - 101 in 255815.4800ms
2025-08-31 23:37:37.921 -03:00 [INF] Request finished GET /whatsappHub - 101 in 621.3490ms
2025-08-31 23:37:37.922 -03:00 [INF] Request finished GET /whatsappHub - 101 in 634.5370ms
2025-08-31 23:37:37.921 -03:00 [INF] Request finished GET /whatsappHub - 101 in 681.4230ms
2025-08-31 23:37:37.931 -03:00 [INF] Request finished GET /whatsappHub - 101 in 666.0510ms
2025-08-31 23:53:18.892 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 23:53:18.892 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 23:53:18.892 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:53:18.892 -03:00 [INF] Request starting GET /api/chats
2025-08-31 23:53:18.929 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:53:18.931 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:53:18.932 -03:00 [INF] Request finished GET /api/health - 200 in 40.3360ms
2025-08-31 23:53:18.934 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 4.5800ms
2025-08-31 23:53:18.935 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 3.5850ms
2025-08-31 23:53:18.935 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:53:18.942 -03:00 [INF] Request finished GET /api/health - 200 in 7.7090ms
2025-08-31 23:53:18.950 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:53:18.951 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.3850ms
2025-08-31 23:53:19.163 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:53:19.164 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 1.4180ms
2025-08-31 23:53:19.187 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:53:19.203 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:53:19.222 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:53:19.242 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:53:20.472 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 1580.0930ms
2025-08-31 23:53:20.513 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 23:53:20.601 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 87.9700ms
2025-08-31 23:53:20.603 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 23:53:20.615 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 12.0460ms
2025-08-31 23:53:20.617 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 23:53:20.633 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 16.5160ms
2025-08-31 23:53:20.634 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 23:53:20.637 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 2.6040ms
2025-08-31 23:53:20.638 -03:00 [INF] Request starting GET /api/users/by-email/jonathanfrnnd3@gmail.com
2025-08-31 23:53:20.667 -03:00 [INF] Request finished GET /api/users/by-email/jonathanfrnnd3@gmail.com - 200 in 29.1680ms
2025-08-31 23:53:21.049 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2157.8610ms
2025-08-31 23:53:21.065 -03:00 [INF] Request starting GET /api/whatsapp/status
2025-08-31 23:53:23.089 -03:00 [INF] Request finished GET /api/whatsapp/status - 200 in 2024.3130ms
2025-08-31 23:53:23.300 -03:00 [INF] Request starting GET /api/chats
2025-08-31 23:53:24.482 -03:00 [INF] Request finished GET /api/chats - 200 in 5589.9670ms
2025-08-31 23:53:25.631 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:53:25.633 -03:00 [INF] Request finished GET /api/health - 200 in 2.5250ms
2025-08-31 23:53:25.635 -03:00 [INF] Request finished GET /whatsappHub - 101 in 6393.5030ms
2025-08-31 23:53:25.698 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:53:25.708 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 10.1680ms
2025-08-31 23:53:25.713 -03:00 [INF] Request starting GET /whatsappHub
2025-08-31 23:53:25.910 -03:00 [INF] Request finished GET /api/chats - 200 in 2609.7870ms
2025-08-31 23:53:26.054 -03:00 [INF] Request starting GET /api/health
2025-08-31 23:53:26.055 -03:00 [INF] Request finished GET /whatsappHub - 101 in 342.0540ms
2025-08-31 23:53:26.056 -03:00 [INF] Request finished GET /api/health - 200 in 2.4990ms
2025-08-31 23:53:26.062 -03:00 [INF] Request starting POST /whatsappHub/negotiate
2025-08-31 23:53:26.063 -03:00 [INF] Request finished POST /whatsappHub/negotiate - 200 in 0.5580ms
2025-08-31 23:53:26.065 -03:00 [INF] Request starting GET /whatsappHub
